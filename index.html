<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[pWR] Alliance Command Center</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <!-- Other Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
/* =================================================================
   POWEr ALLIANCE COMMAND CENTER THEME - LIGHT INTERFACE
   ================================================================= */

   @import url('https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700&family=Cairo:wght@400;600;700&display=swap');

* { margin: 0; padding: 0; box-sizing: border-box; }

/* ===== RTL SUPPORT ===== */
[dir="rtl"] {
    text-align: right;
}

[dir="rtl"] .header {
    direction: rtl;
}

[dir="rtl"] .week-controls {
    direction: rtl;
}

[dir="rtl"] .control-buttons {
    direction: rtl;
}

[dir="rtl"] .data-table {
    direction: rtl;
}

[dir="rtl"] .modal-content {
    direction: rtl;
    text-align: right;
}

[dir="rtl"] .search-bar {
    text-align: right;
}

[dir="rtl"] #languageToggle {
    left: 20px;
    right: auto;
}

/* ===== APOCALYPTIC BACKGROUND ===== */
body {
    font-family: 'Rajdhani', sans-serif;
    background: linear-gradient(135deg, #0d0d0d 0%, #1a1410 50%, #1f1a15 100%);
    background-image: 
        radial-gradient(ellipse at top, rgba(139, 69, 0, 0.1), transparent),
        radial-gradient(ellipse at bottom, rgba(200, 50, 0, 0.05), transparent);
    color: #d4d4d4;
    min-height: 100vh;
    padding: 20px;
}

.dashboard-container { max-width: 1600px; margin: 0 auto; }
.tabs-container { max-width: 1650px; margin: 0 auto; }
.global-bar {
    max-width: 1650px;
    margin: 0 auto 20px;
    padding: 14px 20px;
    background: linear-gradient(135deg, rgba(40, 35, 25, 0.95), rgba(25, 20, 15, 0.95));
    border: 2px solid #6b5a3d;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.45);
}
.brand {
    display: flex;
    align-items: center;
    gap: 14px;
}
.alliance-logo.mini {
    font-size: 2rem;
    padding: 10px 16px;
    letter-spacing: 4px;
}
.brand-text { line-height: 1.2; }
.brand-title {
    font-family: 'Oswald', sans-serif;
    font-size: 1.2rem;
    color: #ffaa33;
    letter-spacing: 1px;
}
.brand-sub {
    font-size: 0.95rem;
    color: #9a8970;
}
.global-actions {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: flex-end;
}
.global-actions .action-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: 40px;
    line-height: 1;
}
.lootbar-cta {
    margin-top: 12px;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 10px 16px;
    border-radius: 6px;
    border: 1px solid var(--border);
    background: var(--surface-muted);
    color: var(--text);
    text-decoration: none;
    font-weight: 600;
    box-shadow: var(--shadow-sm);
}
.lootbar-cta:hover {
    border-color: var(--accent);
    box-shadow: var(--shadow-sm);
}
.lootbar-icon {
    width: 32px !important;
    height: 32px !important;
    max-width: 32px !important;
    max-height: 32px !important;
    object-fit: contain;
}
.guides-header-actions {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    margin-top: 8px;
}
.action-btn.compact {
    padding: 10px 14px;
    font-size: 0.9rem;
}
.tab-buttons {
    display: flex;
    gap: 10px;
    margin: 0 auto 15px;
    justify-content: center;
    flex-wrap: wrap;
}
.tab-btn {
    padding: 12px 20px;
    background: linear-gradient(135deg, #2a2515, #1f1910);
    border: 2px solid #6b5a3d;
    border-radius: 6px;
    color: #d4a765;
    font-family: 'Teko', sans-serif;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    letter-spacing: 1px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}
.tab-btn:hover { border-color: #ff9933; color: #ffcc66; box-shadow: 0 0 15px rgba(255, 153, 51, 0.4); transform: translateY(-2px); }
.tab-btn.active { background: linear-gradient(135deg, #ff6600, #cc5200); color: #fff; border-color: #ff9933; box-shadow: 0 0 20px rgba(255, 102, 0, 0.6); }
.tab-panel { display: none; }
.tab-panel.active { display: block; }

/* ===== MILITARY HEADER ===== */
.header {
    text-align: center;
    margin-bottom: 30px;
    padding: 30px 20px;
    background: linear-gradient(135deg, rgba(40, 30, 20, 0.9), rgba(30, 25, 20, 0.9));
    border: 3px solid #8b5a00;
    border-radius: 10px;
    box-shadow: 0 0 40px rgba(200, 100, 0, 0.3), inset 0 0 20px rgba(0, 0, 0, 0.5);
    position: relative;
}

/* Scanline Effect */
.header::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0, 0, 0, 0.1) 2px,
        rgba(0, 0, 0, 0.1) 4px
    );
    pointer-events: none;
}

/* Alliance Logo - Burning Effect */
.alliance-logo {
    font-family: 'Oswald', sans-serif;
    font-size: 4rem;
    font-weight: 700;
    color: #ff6600;
    text-shadow: 
        0 0 10px #ff6600,
        0 0 20px #cc3300,
        2px 2px 4px #000,
        -2px -2px 4px #000;
    padding: 20px;
    border: 3px solid #8b5a00;
    background: linear-gradient(135deg, rgba(60, 40, 20, 0.8), rgba(40, 30, 15, 0.8));
    border-radius: 10px;
    display: inline-block;
    animation: flickerGlow 3s infinite;
    letter-spacing: 8px;
}

@keyframes flickerGlow {
    0%, 100% { 
        box-shadow: 0 0 20px rgba(255, 102, 0, 0.5), 
                   inset 0 0 10px rgba(255, 102, 0, 0.2);
    }
    50% { 
        box-shadow: 0 0 30px rgba(255, 102, 0, 0.8), 
                   inset 0 0 15px rgba(255, 102, 0, 0.3);
    }
}

.header h1 {
    font-family: 'Oswald', sans-serif;
    font-size: 2.5rem;
    font-weight: 700;
    color: #ffaa00;
    text-shadow: 2px 2px 4px #000, 0 0 10px #ff6600;
    margin: 15px 0 5px 0;
    letter-spacing: 3px;
}

.alliance-name {
    font-family: 'Teko', sans-serif;
    font-size: 1.6rem;
    color: #ff9933;
    margin: 8px 0;
    letter-spacing: 4px;
    text-transform: uppercase;
    text-shadow: 1px 1px 2px #000;
}

.event-subtitle {
    font-size: 1.1rem;
    color: #cc6633;
    margin: 5px 0;
    letter-spacing: 2px;
    font-weight: 600;
    text-shadow: 1px 1px 2px #000;
}

/* ===== MILITARY CONTROLS ===== */
.week-controls {
    display: flex;
    justify-content: space-between;
    gap: 15px;
    margin-bottom: 25px;
    padding: 20px;
    background: linear-gradient(135deg, rgba(40, 35, 25, 0.9), rgba(30, 25, 20, 0.9));
    border: 2px solid #6b5a3d;
    border-radius: 8px;
    flex-wrap: wrap;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
}

.week-selector { display: flex; gap: 10px; flex-wrap: wrap; }

.week-btn, .action-btn {
    padding: 12px 20px;
    background: linear-gradient(135deg, #3a3020, #2a2515);
    border: 2px solid #6b5a3d;
    border-radius: 6px;
    color: #d4a765;
    font-family: 'Teko', sans-serif;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}

.week-btn:hover, .action-btn:hover {
    border-color: #ff9933;
    color: #ffcc66;
    box-shadow: 0 0 15px rgba(255, 153, 51, 0.4);
    transform: translateY(-2px);
    background: linear-gradient(135deg, #4a4030, #3a3025);
}

.week-btn.active {
    background: linear-gradient(135deg, #ff6600, #cc5200);
    border-color: #ff9933;
    color: #ffffff;
    box-shadow: 0 0 20px rgba(255, 102, 0, 0.6);
    text-shadow: 0 0 5px #000;
}

.upload-btn {
    padding: 12px 25px;
    background: linear-gradient(135deg, #cc5200, #993d00);
    border: 2px solid #ff6600;
    border-radius: 6px;
    color: #ffffff;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(255, 102, 0, 0.3);
    font-family: 'Teko', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 1px;
}

.upload-btn:hover {
    background: linear-gradient(135deg, #ff6600, #cc5200);
    box-shadow: 0 6px 20px rgba(255, 102, 0, 0.5);
    transform: translateY(-2px);
}

.control-buttons { display: flex; gap: 10px; flex-wrap: wrap; }

/* ===== RESOURCE CARDS (KPIs) ===== */
.kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.kpi-card {
    background: linear-gradient(135deg, rgba(50, 40, 25, 0.9), rgba(35, 28, 18, 0.9));
    border: 2px solid #6b5a3d;
    border-left: 4px solid #ff6600;
    border-radius: 8px;
    padding: 25px;
    text-align: center;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

.kpi-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(255, 102, 0, 0.3);
    border-color: #ff9933;
}

.kpi-label {
    font-size: 0.9rem;
    color: #997755;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 10px;
    font-weight: 600;
}

.kpi-value {
    font-family: 'Oswald', sans-serif;
    font-size: 2.2rem;
    font-weight: 700;
    color: #ffaa33;
    text-shadow: 0 0 10px rgba(255, 170, 51, 0.5), 2px 2px 4px #000;
}

.kpi-subtext {
    font-size: 0.85rem;
    color: #7a6a50;
    margin-top: 5px;
}

/* ===== COMBAT STATS ===== */
.movement-section { margin: 30px 0; }

.section-title {
    font-family: 'Oswald', sans-serif;
    font-size: 1.8rem;
    text-align: center;
    color: #ffaa33;
    text-shadow: 2px 2px 4px #000, 0 0 10px #ff6600;
    margin-bottom: 25px;
    text-transform: uppercase;
    letter-spacing: 3px;
}

.movement-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.movement-card {
    background: linear-gradient(135deg, rgba(40, 35, 25, 0.9), rgba(30, 25, 20, 0.9));
    border: 2px solid #6b5a3d;
    border-radius: 8px;
    padding: 25px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

.movement-icon { font-size: 3rem; margin-bottom: 10px; filter: drop-shadow(2px 2px 4px #000); }
.movement-title { font-size: 0.9rem; color: #997755; text-transform: uppercase; margin-bottom: 10px; font-weight: 600; }
.movement-player { font-family: 'Oswald', sans-serif; font-size: 1.3rem; color: #ffaa33; margin-bottom: 5px; text-shadow: 1px 1px 2px #000; }
.movement-stats { font-size: 0.9rem; color: #7a6a50; }

/* ===== CHARTS ===== */
.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
}

.chart-card {
    background: linear-gradient(135deg, rgba(40, 35, 25, 0.9), rgba(30, 25, 20, 0.9));
    border: 2px solid #6b5a3d;
    border-radius: 8px;
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
}

.chart-title {
    font-family: 'Oswald', sans-serif;
    font-size: 1.2rem;
    color: #ffaa33;
    margin-bottom: 20px;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 1px 1px 2px #000;
}

/* ===== DIVISION SYSTEM ===== */
.division-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.division-card {
    background: linear-gradient(135deg, rgba(40, 35, 25, 0.9), rgba(30, 25, 20, 0.9));
    border: 2px solid #6b5a3d;
    border-radius: 8px;
    padding: 25px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

.division-card.elite { 
    border-color: #d4af37; 
    border-width: 3px;
    box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
}
.division-card.master { 
    border-color: #99cc33;
    box-shadow: 0 0 15px rgba(153, 204, 51, 0.2);
}
.division-card.warrior { 
    border-color: #cc6633;
    box-shadow: 0 0 15px rgba(204, 102, 51, 0.2);
}

.division-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.division-icon { font-size: 2rem; filter: drop-shadow(2px 2px 3px #000); }
.division-name { font-family: 'Oswald', sans-serif; font-size: 1.2rem; color: #ffcc66; flex: 1; margin: 0 10px; letter-spacing: 1px; }
.division-req { font-size: 0.85rem; color: #997755; }
.division-count { font-size: 1.1rem; color: #ffaa33; margin-bottom: 10px; font-weight: 600; }
.division-players { font-size: 0.9rem; color: #9a8970; line-height: 1.6; }

/* ===== LEADERBOARD TABLE ===== */
.table-container {
    background: linear-gradient(135deg, rgba(40, 35, 25, 0.9), rgba(30, 25, 20, 0.9));
    border: 2px solid #6b5a3d;
    border-radius: 8px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
}

.search-bar {
    width: 100%;
    padding: 15px 20px;
    margin-bottom: 20px;
    background: rgba(20, 18, 15, 0.8);
    border: 2px solid #6b5a3d;
    border-radius: 6px;
    color: #d4d4d4;
    font-size: 1rem;
    font-family: 'Rajdhani', sans-serif;
}

.search-bar:focus {
    outline: none;
    border-color: #ff9933;
    box-shadow: 0 0 15px rgba(255, 153, 51, 0.3);
}

.table-wrapper {
    max-height: 600px;
    overflow-y: auto;
    border-radius: 8px;
}

.table-wrapper::-webkit-scrollbar { width: 12px; }
.table-wrapper::-webkit-scrollbar-track { background: rgba(20, 18, 15, 0.8); border-radius: 8px; }
.table-wrapper::-webkit-scrollbar-thumb { 
    background: linear-gradient(135deg, #ff6600, #cc5200); 
    border-radius: 8px;
    border: 2px solid rgba(20, 18, 15, 0.8);
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}

.data-table thead {
    position: sticky;
    top: 0;
    z-index: 10;
    background: linear-gradient(135deg, #ff6600, #cc5200);
}

.data-table th {
    padding: 15px;
    text-align: left;
    font-weight: 700;
    text-transform: uppercase;
    font-size: 0.9rem;
    color: #ffffff;
    text-shadow: 1px 1px 2px #000;
    font-family: 'Teko', sans-serif;
    letter-spacing: 1px;
}

.data-table tbody tr {
    border-bottom: 1px solid rgba(107, 90, 61, 0.3);
    transition: all 0.3s ease;
}

.data-table tbody tr:hover {
    background: rgba(255, 102, 0, 0.1);
}

.data-table td {
    padding: 12px 15px;
    color: #c4b5a0;
}

/* ===== RANK BADGES - MILITARY STYLE ===== */
.rank-badge {
    display: inline-block;
    padding: 5px 12px;
    border-radius: 4px;
    font-weight: 700;
    font-size: 0.85rem;
    font-family: 'Oswald', sans-serif;
    letter-spacing: 1px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
}

.rank-1 { 
    background: linear-gradient(135deg, #d4af37, #f4d03f); 
    color: #000;
    box-shadow: 0 0 15px rgba(212, 175, 55, 0.6);
    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
}
.rank-2 { 
    background: linear-gradient(135deg, #c0c0c0, #e8e8e8); 
    color: #000;
    box-shadow: 0 0 12px rgba(192, 192, 192, 0.5);
}
.rank-3 { 
    background: linear-gradient(135deg, #cd7f32, #e6a157); 
    color: #000;
    box-shadow: 0 0 12px rgba(205, 127, 50, 0.5);
}
.rank-top10 { background: rgba(255, 153, 51, 0.3); color: #ffaa33; border: 1px solid #ff9933; }
.rank-default { background: rgba(80, 70, 60, 0.3); color: #9a8970; border: 1px solid #6b5a3d; }

.rank-movement {
    display: inline-flex;
    align-items: center;
    font-weight: 700;
    font-size: 1.1rem;
}

.rank-movement.up { color: #99cc33; text-shadow: 0 0 5px #99cc33; }
.rank-movement.down { color: #cc3300; text-shadow: 0 0 5px #cc3300; }
.rank-movement.same { color: #7a6a50; }

.achievement-badge {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
    margin: 2px;
    background: rgba(255, 153, 51, 0.2);
    border: 1px solid rgba(255, 153, 51, 0.5);
}

.view-profile-btn {
    padding: 6px 12px;
    background: rgba(204, 82, 0, 0.4);
    border: 1px solid #cc5200;
    border-radius: 4px;
    color: #ffaa33;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: 'Teko', sans-serif;
}

.view-profile-btn:hover {
    background: rgba(255, 102, 0, 0.6);
    color: #ffffff;
    box-shadow: 0 0 10px rgba(255, 102, 0, 0.4);
}

/* ===== FOOTER ===== */
.footer {
    text-align: center;
    margin-top: 40px;
    padding: 30px 20px;
    background: linear-gradient(135deg, rgba(40, 35, 25, 0.9), rgba(30, 25, 20, 0.9));
    border: 2px solid #6b5a3d;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
}

.creator-tag {
    font-family: 'Oswald', sans-serif;
    font-weight: 700;
    color: #ff9933;
    font-size: 1.3rem;
    letter-spacing: 2px;
    text-shadow: 0 0 10px rgba(255, 153, 51, 0.5), 2px 2px 4px #000;
}

/* ===== MODAL ===== */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(10px);
}

.modal-content {
    background: linear-gradient(135deg, rgba(40, 35, 25, 0.95), rgba(30, 25, 20, 0.95));
    margin: 5% auto;
    padding: 0;
    border: 3px solid #6b5a3d;
    border-radius: 8px;
    width: 90%;
    max-width: 900px;
    box-shadow: 0 10px 50px rgba(255, 102, 0, 0.3);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    padding: 25px;
    background: linear-gradient(135deg, #ff6600, #cc5200);
    border-radius: 5px 5px 0 0;
}

.modal-header h2 {
    font-family: 'Oswald', sans-serif;
    color: #ffffff;
    margin: 0;
    text-shadow: 2px 2px 4px #000;
}

.modal-close {
    color: #ffffff;
    font-size: 2rem;
    cursor: pointer;
    text-shadow: 2px 2px 4px #000;
}

.modal-body { padding: 25px; }
.modal-body.scrollable {
    max-height: 70vh;
    overflow: auto;
}

.profile-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
}

.profile-stat {
    background: rgba(20, 18, 15, 0.8);
    border: 2px solid #6b5a3d;
    border-radius: 6px;
    padding: 15px;
    text-align: center;
}

.stat-label { font-size: 0.85rem; color: #997755; margin-bottom: 8px; }
.stat-value { font-family: 'Oswald', sans-serif; font-size: 1.5rem; color: #ffaa33; font-weight: 700; text-shadow: 0 0 8px rgba(255, 170, 51, 0.4); }

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
    .header h1 { font-size: 1.8rem; }
    .alliance-logo { font-size: 2.5rem; padding: 15px; }
    .charts-grid, .kpi-grid { grid-template-columns: 1fr; }
    .week-controls { flex-direction: column; }
}

/* =================================================================
   LIGHT COMMAND CENTER THEME OVERRIDES
   ================================================================= */
:root {
    --font-body: 'Sora', 'Cairo', sans-serif;
    --font-display: 'Sora', 'Cairo', sans-serif;
    --bg: #eee7df;
    --bg-accent: #f3ede6;
    --surface: #f6f0ea;
    --surface-muted: #ede4db;
    --surface-strong: #f4dfcb;
    --border: #ded2c7;
    --text: #2c241e;
    --text-muted: #6f655b;
    --accent: #d06b2f;
    --accent-strong: #b8571d;
    --accent-soft: #f0ccb0;
    --teal: #1f8a83;
    --shadow-sm: 0 6px 18px rgba(20, 16, 12, 0.08);
    --shadow-md: 0 16px 30px rgba(20, 16, 12, 0.12);
    --shadow-lg: 0 24px 48px rgba(20, 16, 12, 0.18);
    --bg-glow-1: rgba(255, 245, 236, 0.55);
    --bg-glow-2: rgba(255, 220, 190, 0.32);
    --chart-text: #6f655b;
    --chart-grid: rgba(43, 36, 30, 0.12);
    --table-head: linear-gradient(135deg, #f1ddca, #f4d9c4);
    --row-hover: rgba(212, 106, 45, 0.08);
    --scroll-track: #e9dfd6;
    --scroll-thumb: linear-gradient(135deg, #f0c8a9, #e2b46f);
}

[data-theme="dark"] {
    --bg: #151312;
    --bg-accent: #1a1715;
    --surface: #1d1a18;
    --surface-muted: #23201d;
    --surface-strong: #2a1f18;
    --border: #332c26;
    --text: #f4f0ea;
    --text-muted: #b7aea6;
    --accent: #f0a560;
    --accent-strong: #e28a40;
    --accent-soft: #3a2a20;
    --teal: #4cc1b2;
    --shadow-sm: 0 10px 22px rgba(0, 0, 0, 0.45);
    --shadow-md: 0 18px 34px rgba(0, 0, 0, 0.55);
    --shadow-lg: 0 28px 48px rgba(0, 0, 0, 0.6);
    --bg-glow-1: rgba(255, 196, 150, 0.08);
    --bg-glow-2: rgba(255, 180, 120, 0.05);
    --chart-text: #d7ccc3;
    --chart-grid: rgba(244, 240, 234, 0.12);
    --table-head: linear-gradient(135deg, #2c2018, #33261c);
    --row-hover: rgba(240, 165, 96, 0.15);
    --scroll-track: #1c1916;
    --scroll-thumb: linear-gradient(135deg, #f0a560, #c97a3d);
}

body {
    font-family: var(--font-body);
    background: radial-gradient(800px 400px at 10% -10%, var(--bg-glow-1), transparent 60%),
        radial-gradient(650px 420px at 90% 0%, var(--bg-glow-2), transparent 55%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg-accent) 60%, var(--bg) 100%);
    color: var(--text);
}

[dir="rtl"] body {
    font-family: 'Cairo', sans-serif;
}


.global-bar {
    background: linear-gradient(135deg, var(--surface), var(--surface-muted));
    border: 1px solid var(--border);
    box-shadow: var(--shadow-md);
}

.brand-title {
    font-family: var(--font-display);
    color: var(--text);
}

.brand-sub { color: var(--text-muted); }

.tab-buttons { margin-bottom: 22px; }

.tab-btn {
    background: var(--surface-muted);
    border: 1px solid var(--border);
    color: var(--text-muted);
    font-family: var(--font-display);
    text-transform: none;
    box-shadow: none;
    font-size: 1.05rem;
    line-height: 1.1;
}
.tab-btn:hover {
    border-color: var(--accent);
    color: var(--text);
    box-shadow: var(--shadow-sm);
}
.tab-btn.active {
    background: linear-gradient(135deg, var(--surface-strong), var(--accent-soft));
    color: var(--text);
    border-color: var(--accent);
    box-shadow: var(--shadow-sm);
}

.header {
    background: var(--surface);
    border: 1px solid var(--border);
    box-shadow: var(--shadow-md);
}
.header::before { display: none; }

.alliance-logo {
    font-family: var(--font-display);
    color: var(--accent-strong);
    background: var(--surface-strong);
    border: 1px solid var(--border);
    text-shadow: none;
    animation: none;
    letter-spacing: 3px;
    width: 130px;
    height: 130px;
    padding: 16px;
}

.alliance-logo.mini {
    background: var(--surface);
    border: 1px solid var(--border);
    width: 60px;
    height: 60px;
    padding: 8px;
}

.alliance-logo img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.header h1,
.section-title,
.chart-title {
    font-family: var(--font-display);
    color: var(--text);
    text-shadow: none;
    letter-spacing: 1px;
}

.alliance-name { color: var(--text-muted); text-shadow: none; }
.event-subtitle { color: var(--text-muted); text-shadow: none; }

.week-controls,
.table-container,
.kpi-card,
.movement-card,
.chart-card,
.division-card,
.footer,
.modal-content {
    background: var(--surface);
    border: 1px solid var(--border);
    box-shadow: var(--shadow-sm);
}
.kpi-card { border-left: 4px solid var(--accent); }

.week-controls { gap: 20px; }

.action-btn,
.week-btn {
    background: var(--surface-muted);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--font-display);
    text-transform: none;
    text-shadow: none;
    box-shadow: none;
    font-size: 0.95rem;
    line-height: 1.1;
}

.action-btn:hover,
.week-btn:hover {
    border-color: var(--accent);
    color: var(--text);
    box-shadow: var(--shadow-sm);
    transform: translateY(-2px);
}

.week-btn.active {
    background: linear-gradient(135deg, var(--surface-strong), var(--accent-soft));
    border-color: var(--accent);
    color: var(--text);
    text-shadow: none;
}

.upload-btn {
    background: linear-gradient(135deg, var(--accent), var(--accent-strong));
    border: 1px solid var(--accent);
    color: #ffffff;
    font-family: var(--font-display);
    box-shadow: var(--shadow-sm);
    font-size: 0.95rem;
    line-height: 1.1;
}
.upload-btn:hover { box-shadow: var(--shadow-sm); }

.kpi-label { color: var(--text-muted); }
.kpi-value { color: var(--text); text-shadow: none; font-family: var(--font-display); }
.kpi-subtext { color: var(--text-muted); }

.movement-title,
.movement-stats { color: var(--text-muted); }
.movement-player { color: var(--text); text-shadow: none; font-family: var(--font-display); }
.movement-icon { filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.12)); }

.profile-stat {
    background: var(--surface-muted);
    border: 1px solid var(--border);
}
.stat-label { color: var(--text-muted); }
.stat-value { color: var(--text); text-shadow: none; font-family: var(--font-display); }

.charts-grid { grid-template-columns: repeat(auto-fit, minmax(420px, 1fr)); }

.division-card.elite { border-color: #f2c879; box-shadow: var(--shadow-sm); }
.division-card.master { border-color: #9fd8c1; box-shadow: var(--shadow-sm); }
.division-card.warrior { border-color: #f0b88b; box-shadow: var(--shadow-sm); }

.division-name { color: var(--text); }
.division-name { font-family: var(--font-display); }
.division-req { color: var(--text-muted); }
.division-count { color: var(--text); }
.division-players { color: var(--text-muted); }

.search-bar {
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
}
.search-bar:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(212, 106, 45, 0.2);
}

.duel-filters {
    display: grid;
    grid-template-columns: 1fr 180px 180px;
    gap: 12px;
}

.donation-filters {
    display: grid;
    grid-template-columns: 1fr 180px 180px;
    gap: 12px;
}
.guides-grid {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 16px;
}
.guide-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px;
    box-shadow: var(--shadow-sm);
    cursor: zoom-in;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.guide-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}
.guide-card img {
    width: 100%;
    height: 140px;
    object-fit: cover;
    border-radius: 8px;
    display: block;
}
.guide-card-title {
    margin-top: 8px;
    font-weight: 600;
    color: var(--text);
}

[data-theme="dark"] .guide-card-title {
    color: #ffffff;
}

.data-table thead {
    background: var(--table-head);
}
.data-table th { color: var(--text); text-shadow: none; font-family: var(--font-display); }
.data-table td { color: var(--text-muted); font-family: var(--font-body); }
.data-table tbody tr:hover { background: var(--row-hover); }

.table-wrapper::-webkit-scrollbar-track { background: var(--scroll-track); }
.table-wrapper::-webkit-scrollbar-thumb {
    background: var(--scroll-thumb);
    border: 2px solid var(--scroll-track);
}

.rank-1 { background: linear-gradient(135deg, #f6d37a, #f2c053); }
.rank-2 { background: linear-gradient(135deg, #dfe3e8, #c9ced6); }
.rank-3 { background: linear-gradient(135deg, #e8b28a, #d99361); }
.rank-top10 { background: rgba(212, 106, 45, 0.12); color: var(--accent-strong); border-color: rgba(212, 106, 45, 0.4); }
.rank-default { background: var(--surface-muted); color: var(--text-muted); }
.rank-badge { font-family: var(--font-display); }
.rank-movement.up { color: var(--teal); text-shadow: none; }
.rank-movement.down { color: #d9776a; text-shadow: none; }
.rank-movement.same { color: var(--text-muted); }

.achievement-badge {
    background: rgba(31, 138, 131, 0.12);
    border: 1px solid rgba(31, 138, 131, 0.4);
    color: var(--text);
}

.view-profile-btn {
    background: rgba(31, 138, 131, 0.12);
    border: 1px solid rgba(31, 138, 131, 0.4);
    color: var(--text);
    font-family: var(--font-display);
}
.view-profile-btn:hover {
    background: rgba(31, 138, 131, 0.2);
    color: var(--text);
    box-shadow: var(--shadow-sm);
}

.modal {
    background-color: rgba(18, 14, 10, 0.35);
    backdrop-filter: blur(8px);
}
.modal-header {
    background: var(--table-head);
}
.modal-header h2 { color: var(--text); text-shadow: none; }
.modal-close { color: var(--text); text-shadow: none; }

.footer {
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text-muted);
}
.creator-tag { color: var(--accent-strong); text-shadow: none; }

@keyframes fadeRise {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
}

.tab-panel.active {
    animation: fadeRise 0.4s ease;
}

.kpi-card,
.movement-card,
.chart-card,
.division-card,
.table-container {
    animation: fadeRise 0.5s ease;
}

@media (max-width: 900px) {
    .global-bar { flex-direction: column; align-items: flex-start; }
    .global-actions { width: 100%; justify-content: flex-start; }
    .tab-buttons { justify-content: flex-start; }
    .charts-grid { grid-template-columns: 1fr; }
    .guides-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
}

@media (max-width: 768px) {
    .duel-filters { grid-template-columns: 1fr; }
    .donation-filters { grid-template-columns: 1fr; }
    .guides-grid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>
        <div class="global-bar">
        <div class="brand">
            <div class="alliance-logo mini">
                <img src="https://raw.githubusercontent.com/pWRDeFOUR/pwr-alliance-leaderboard/refs/heads/main/logo.png" alt="pWR logo">
            </div>
            <div class="brand-text">
                <div class="brand-title" data-i18n="global.title">POWEr Alliance Command Center</div>
                <div class="brand-sub" data-i18n="global.subtitle">Live Leaderboards & Admin Controls</div>
            </div>
        </div>
        <div class="global-actions">
            <button class="action-btn compact" id="languageToggle">üåê ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
            <button class="action-btn compact" id="themeToggle">üåô Dark</button>
            <button class="action-btn compact" id="signInOutBtn" data-i18n="buttons.signIn">üîê Sign In</button>
            <button class="action-btn compact" id="shareBtn" data-i18n="buttons.screenshot">üì∏ Screenshot</button>
        </div>
    </div>

    <div class="tabs-container">
        <div class="tab-buttons">
            <button class="tab-btn active" data-tab="duelTab" data-i18n="tabs.duel">‚öîÔ∏è Alliance Duel</button>
            <button class="tab-btn" data-tab="donationTab" data-i18n="tabs.donation">ü§ù Donation Leaderboard</button>
            <button class="tab-btn" data-tab="guidesTab" data-i18n="tabs.guides">üìò Guides</button>
        </div>

        <div id="duelTab" class="tab-panel active">
            <div class="dashboard-container">
        <!-- Header -->
            <div class="header">
            <div class="alliance-logo">
                <img src="https://raw.githubusercontent.com/pWRDeFOUR/pwr-alliance-leaderboard/refs/heads/main/logo.png" alt="pWR logo">
            </div>
            <h1 data-i18n="header.title">‚öîÔ∏è ALLIANCE DUEL LEADERBOARD ‚öîÔ∏è</h1>
            <p class="event-subtitle" data-i18n="header.event">Weekly Alliance Duel Event</p>
            <a class="lootbar-cta" href="https://lootbar.gg/top-up/last-z-survival-shooter?aff_short=DeFOUR" target="_blank" rel="noopener">
                <img class="lootbar-icon" src="https://raw.githubusercontent.com/pWRDeFOUR/pwr-alliance-leaderboard/refs/heads/main/LBGG.png" alt="Lootbar icon">
                <span data-i18n="global.lootbarCta">Buy Last War: Survival Game Packages Cheaper from LootBar.gg</span>
            </a>
        </div>

        <!-- Week Controls -->
        <div class="week-controls">
            <div class="week-selector" id="weekSelector"></div>
            <div class="control-buttons">
                <label for="csvUpload" class="upload-btn" id="uploadBtn" data-i18n="buttons.upload">
                    üì§ Upload Week Data
                    <input type="file" id="csvUpload" accept=".csv" style="display: none;">
                </label>
                <button class="action-btn" id="refreshDataBtn" data-i18n="buttons.refresh">üîÑ Refresh Data</button>
                <button class="action-btn" id="deleteWeekBtn" data-i18n="buttons.deleteWeek" style="display: none;">üóëÔ∏è Delete Week</button>
                <button class="action-btn" id="addPlayerBtn" data-i18n="buttons.addPlayer" style="display: none;">‚ûï Add Player</button>
                <button class="action-btn" id="resetDuelBtn" data-i18n="buttons.resetDuel" style="display: none;">‚ôªÔ∏è Reset Duel Data</button>
                <button class="action-btn" id="exportPdfBtn" data-i18n="buttons.exportPdf">üìÑ Export PDF</button>
                <button class="action-btn" id="exportCsvBtn" data-i18n="buttons.exportCsv">üíæ Export CSV</button>
                <button class="action-btn" id="exportPngBtn" data-i18n="buttons.screenshot">üì∏ Screenshot</button>
            </div>
        </div>

        <!-- KPIs -->
        <div class="kpi-grid" id="kpiGrid"></div>

        <!-- Movement Highlights -->
        <div class="movement-section" id="movementSection" style="display: none;">
            <h2 class="section-title" data-i18n="movement.title">üìà Weekly Movement Highlights</h2>
            <div class="movement-grid">
                <div class="movement-card">
                    <div class="movement-icon">üöÄ</div>
                    <div class="movement-title" data-i18n="movement.climber">Biggest Climber</div>
                    <div class="movement-player" id="biggestClimber">-</div>
                    <div class="movement-stats" id="climberStats">-</div>
                </div>
                <div class="movement-card">
                    <div class="movement-icon">üìâ</div>
                    <div class="movement-title" data-i18n="movement.faller">Biggest Drop</div>
                    <div class="movement-player" id="biggestFaller">-</div>
                    <div class="movement-stats" id="fallerStats">-</div>
                </div>
                <div class="movement-card">
                    <div class="movement-icon">üëë</div>
                    <div class="movement-title" data-i18n="movement.mvp">Weekly MVP</div>
                    <div class="movement-player" id="weeklyMvp">-</div>
                    <div class="movement-stats" id="mvpStats">-</div>
                </div>
                <div class="movement-card">
                    <div class="movement-icon">üî•</div>
                    <div class="movement-title" data-i18n="movement.streak">Top Streak</div>
                    <div class="movement-player" id="topStreak">-</div>
                    <div class="movement-stats" id="streakStats">-</div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="charts-grid">
            <div class="chart-card">
                <h3 class="chart-title" data-i18n="charts.top10">üèÜ Top 10 Champions</h3>
                <canvas id="barChart"></canvas>
            </div>
            <div class="chart-card">
                <h3 class="chart-title" data-i18n="charts.distribution">üìä Score Distribution</h3>
                <canvas id="pieChart"></canvas>
            </div>
        </div>

        <!-- Performance Charts -->
        <div class="performance-section">
            <h2 class="section-title">üìà Performance Analysis</h2>
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title" data-i18n="charts.topPerformance">üî• Top 20 Performance</h3>
                    <canvas id="topPerformanceChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title" data-i18n="charts.bottomPerformance">üìâ Bottom 20 Performance</h3>
                    <canvas id="bottomPerformanceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Division System -->
        <div class="performance-section">
            <h2 class="section-title">üèÜ Division Rankings</h2>
            <div class="division-grid">
                <div class="division-card elite">
                    <div class="division-header">
                        <span class="division-icon">üëë</span>
                        <span class="division-name" data-i18n="divisions.elite">Elite Division</span>
                        <span class="division-req" data-i18n="divisions.eliteReq">&gt;100M</span>
                    </div>
                    <div class="division-count" id="eliteDivisionCount">0 Players</div>
                    <div class="division-players" id="eliteDivisionPlayers"></div>
                </div>
                <div class="division-card master">
                    <div class="division-header">
                        <span class="division-icon">‚öîÔ∏è</span>
                        <span class="division-name" data-i18n="divisions.master">Master Division</span>
                        <span class="division-req" data-i18n="divisions.masterReq">50M-100M</span>
                    </div>
                    <div class="division-count" id="masterDivisionCount">0 Players</div>
                    <div class="division-players" id="masterDivisionPlayers"></div>
                </div>
                <div class="division-card warrior">
                    <div class="division-header">
                        <span class="division-icon">üõ°Ô∏è</span>
                        <span class="division-name" data-i18n="divisions.warrior">Warrior Division</span>
                        <span class="division-req" data-i18n="divisions.warriorReq">&lt;50M</span>
                    </div>
                    <div class="division-count" id="warriorDivisionCount">0 Players</div>
                    <div class="division-players" id="warriorDivisionPlayers"></div>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="table-container">
            <h3 class="chart-title" data-i18n="leaderboard.title">üìã Complete Leaderboard</h3>
            <div class="duel-filters">
                <input type="text" id="searchBar" class="search-bar" data-i18n-placeholder="leaderboard.searchPlaceholder" placeholder="üîç Search player name...">
                <input type="number" id="duelMinPoints" class="search-bar" data-i18n-placeholder="leaderboard.minPointsPlaceholder" placeholder="Min points">
                <select id="duelDivisionFilter" class="search-bar">
                    <option value="" data-i18n="leaderboard.allDivisions">All divisions</option>
                    <option value="elite" data-i18n="divisions.eliteShort">Elite</option>
                    <option value="master" data-i18n="divisions.masterShort">Master</option>
                    <option value="warrior" data-i18n="divisions.warriorShort">Warrior</option>
                </select>
            </div>
            <div class="table-wrapper">
                <table class="data-table">
                    <thead id="duelTableHead"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Player Modal -->
        <div id="playerModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalPlayerName">Player Profile</h2>
                    <span class="modal-close" id="closeModal">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="stat-label" data-i18n="modals.currentRank">Current Rank</div>
                            <div class="stat-value" id="modalRank">-</div>
                        </div>
                        <div class="profile-stat">
                            <div class="stat-label" data-i18n="modals.totalPoints">Total Points</div>
                            <div class="stat-value" id="modalPoints">-</div>
                        </div>
                        <div class="profile-stat">
                            <div class="stat-label" data-i18n="modals.division">Division</div>
                            <div class="stat-value" id="modalDivision">-</div>
                        </div>
                    </div>
                    <div>
                        <h3 style="color: #b9541d; margin-bottom: 15px;" data-i18n="modals.performanceHistory">Weekly Performance History</h3>
                        <canvas id="playerHistoryChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Player Modal -->
        <div id="editPlayerModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <h2 data-i18n="modals.editPlayer">‚úèÔ∏è EDIT PLAYER</h2>
                    <span class="modal-close" id="closeEditModal">&times;</span>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editPlayerOriginalName">
                    <input type="hidden" id="editPlayerOriginalRank">
                    
                    <div style="margin-bottom: 20px;">
                        <label style="color: #997755; display: block; margin-bottom: 8px; font-weight: 600;" data-i18n="modals.playerName">Player Name:</label>
                        <input type="text" id="editPlayerName" class="search-bar" style="margin-bottom: 15px;">
                        
                        <label style="color: #997755; display: block; margin-bottom: 8px; font-weight: 600;" data-i18n="modals.rank">Rank:</label>
                        <input type="number" id="editPlayerRank" class="search-bar" min="1" style="margin-bottom: 15px;">
                        
                        <label style="color: #997755; display: block; margin-bottom: 8px; font-weight: 600;" data-i18n="modals.points">Points:</label>
                        <input type="text" id="editPlayerPoints" class="search-bar" data-i18n-placeholder="modals.pointsPlaceholder" placeholder="Enter points (e.g., 254714950)">
                    </div>
                    
                    <button class="upload-btn" id="saveEditPlayerBtn" data-i18n="modals.save" style="width: 100%; margin-bottom: 10px;">
                        üíæ SAVE CHANGES
                    </button>
                    
                    <div id="editPlayerStatus" style="text-align: center; color: #ffaa33; margin-top: 10px; font-weight: 600;"></div>
                </div>
            </div>
        </div>

        <!-- Add Player Modal -->
        <div id="addPlayerModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <h2 data-i18n="modals.addPlayer">‚ûï ADD NEW PLAYER</h2>
                    <span class="modal-close" id="closeAddModal">&times;</span>
                </div>
                <div class="modal-body">
                    <div style="margin-bottom: 20px;">
                        <label style="color: #997755; display: block; margin-bottom: 8px; font-weight: 600;" data-i18n="modals.playerName">Player Name:</label>
                        <input type="text" id="addPlayerName" class="search-bar" data-i18n-placeholder="modals.playerNamePlaceholder" style="margin-bottom: 15px;" placeholder="Enter player name">
                        
                        <label style="color: #997755; display: block; margin-bottom: 8px; font-weight: 600;" data-i18n="modals.rank">Rank:</label>
                        <input type="number" id="addPlayerRank" class="search-bar" data-i18n-placeholder="modals.rankPlaceholder" min="1" style="margin-bottom: 15px;" placeholder="Enter rank">
                        
                        <label style="color: #997755; display: block; margin-bottom: 8px; font-weight: 600;" data-i18n="modals.points">Points:</label>
                        <input type="text" id="addPlayerPoints" class="search-bar" data-i18n-placeholder="modals.pointsPlaceholder" placeholder="Enter points (e.g., 254714950)">
                    </div>
                    
                    <button class="upload-btn" id="saveAddPlayerBtn" data-i18n="modals.add" style="width: 100%; margin-bottom: 10px;">
                        ‚ûï ADD PLAYER
                    </button>
                    
                    <div id="addPlayerStatus" style="text-align: center; color: #ffaa33; margin-top: 10px; font-weight: 600;"></div>
                </div>
            </div>
        </div>

        <!-- Edit Donation Modal -->
        <div id="editDonationModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <h2 data-i18n="donation.form.editTitle">‚úèÔ∏è EDIT COMMANDER</h2>
                    <span class="modal-close" id="closeEditDonationModal">&times;</span>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editDonationOriginalName">
                    <input type="hidden" id="editDonationOriginalRank">

                    <div style="margin-bottom: 20px;">
                        <label style="color: #997755; display: block; margin-bottom: 8px; font-weight: 600;" data-i18n="donation.form.commanderName">Commander Name:</label>
                        <input type="text" id="donationEditName" class="search-bar" data-i18n-placeholder="donation.form.commanderNamePlaceholder" style="margin-bottom: 15px;" placeholder="Enter commander name">

                        <label style="color: #997755; display: block; margin-bottom: 8px; font-weight: 600;" data-i18n="donation.form.rank">Rank:</label>
                        <input type="number" id="donationEditRank" class="search-bar" data-i18n-placeholder="donation.form.rankPlaceholder" min="1" style="margin-bottom: 15px;" placeholder="Enter rank">

                        <label style="color: #997755; display: block; margin-bottom: 8px; font-weight: 600;" data-i18n="donation.form.points">Points:</label>
                        <input type="text" id="donationEditPoints" class="search-bar" data-i18n-placeholder="donation.form.pointsPlaceholder" placeholder="Enter points (e.g., 50000)">
                    </div>

                    <button class="upload-btn" id="saveEditDonationBtn" data-i18n="donation.form.save" style="width: 100%; margin-bottom: 10px;">
                        üíæ SAVE CHANGES
                    </button>

                    <div id="donationEditStatus" style="text-align: center; color: #ffaa33; margin-top: 10px; font-weight: 600;"></div>
                </div>
            </div>
        </div>

        <!-- Add Donation Modal -->
        <div id="addDonationModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <h2 data-i18n="donation.form.addTitle">‚ûï ADD COMMANDER</h2>
                    <span class="modal-close" id="closeAddDonationModal">&times;</span>
                </div>
                <div class="modal-body">
                    <div style="margin-bottom: 20px;">
                        <label style="color: #997755; display: block; margin-bottom: 8px; font-weight: 600;" data-i18n="donation.form.commanderName">Commander Name:</label>
                        <input type="text" id="donationAddName" class="search-bar" data-i18n-placeholder="donation.form.commanderNamePlaceholder" style="margin-bottom: 15px;" placeholder="Enter commander name">

                        <label style="color: #997755; display: block; margin-bottom: 8px; font-weight: 600;" data-i18n="donation.form.rank">Rank:</label>
                        <input type="number" id="donationAddRank" class="search-bar" data-i18n-placeholder="donation.form.rankPlaceholder" min="1" style="margin-bottom: 15px;" placeholder="Enter rank">

                        <label style="color: #997755; display: block; margin-bottom: 8px; font-weight: 600;" data-i18n="donation.form.points">Points:</label>
                        <input type="text" id="donationAddPoints" class="search-bar" data-i18n-placeholder="donation.form.pointsPlaceholder" placeholder="Enter points (e.g., 50000)">
                    </div>

                    <button class="upload-btn" id="saveAddDonationBtn" data-i18n="donation.form.add" style="width: 100%; margin-bottom: 10px;">
                        ‚ûï ADD COMMANDER
                    </button>

                    <div id="donationAddStatus" style="text-align: center; color: #ffaa33; margin-top: 10px; font-weight: 600;"></div>
                </div>
            </div>
        </div>

        <!-- Auth Modal -->
        <div id="authModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h2 data-i18n="auth.title">üîê Sign In</h2>
                    <span class="modal-close" id="closeAuthModal">&times;</span>
                </div>
                <div class="modal-body">
                    <div style="margin-bottom: 20px;">
                        <label style="color: #997755; display: block; margin-bottom: 8px; font-weight: 600;" data-i18n="auth.email">Email</label>
                        <input type="email" id="authEmail" class="search-bar" data-i18n-placeholder="auth.emailPlaceholder" placeholder="admin@example.com" autocomplete="username">
                        
                        <label style="color: #997755; display: block; margin: 15px 0 8px; font-weight: 600;" data-i18n="auth.password">Password</label>
                        <input type="password" id="authPassword" class="search-bar" data-i18n-placeholder="auth.passwordPlaceholder" placeholder="Enter password" autocomplete="current-password">
                        
                        <label style="display: flex; align-items: center; gap: 8px; margin-top: 12px; color: #997755; font-weight: 600;">
                            <input type="checkbox" id="authRememberMe" checked style="width: 18px; height: 18px;">
                            <span data-i18n="auth.remember">Remember me</span>
                        </label>
                    </div>
                    
                    <button class="upload-btn" id="authSubmitBtn" data-i18n="buttons.signIn" style="width: 100%; margin-bottom: 10px;">
                        üîê Sign In
                    </button>
                    
                    <div id="authStatus" style="text-align: center; color: #ffaa33; margin-top: 10px; font-weight: 600;"></div>
                </div>
            </div>
        </div>

        <!-- Donation Profile Modal -->
        <div id="donationProfileModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="donationModalName">Donation Profile</h2>
                    <span class="modal-close" id="closeDonationModal">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="stat-label" data-i18n="donation.modal.rank">Current Rank</div>
                            <div class="stat-value" id="donationModalRank">-</div>
                        </div>
                        <div class="profile-stat">
                            <div class="stat-label" data-i18n="donation.modal.points">Total Points</div>
                            <div class="stat-value" id="donationModalPoints">-</div>
                        </div>
                        <div class="profile-stat">
                            <div class="stat-label" data-i18n="donation.modal.tier">Tier</div>
                            <div class="stat-value" id="donationModalTier">-</div>
                        </div>
                    </div>
                    <div>
                        <h3 style="color: #b9541d; margin-bottom: 15px;" data-i18n="donation.modal.history">Donation History</h3>
                        <canvas id="donationHistoryChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p><span data-i18n="footer.createdBy">Created by:</span> <span class="creator-tag">#1918 [pWR] DeFOUR</span></p>
            <p style="font-size: 0.9rem; color: #808080; margin-top: 5px;" data-i18n="footer.subtitle">Elite Alliance Dashboard System</p>
        </div>
            </div>
        </div>

        <div id="donationTab" class="tab-panel">
            <div class="dashboard-container">
                <div class="header">
                    <div class="alliance-logo">
                        <img src="https://raw.githubusercontent.com/pWRDeFOUR/pwr-alliance-leaderboard/refs/heads/main/logo.png" alt="pWR logo">
                    </div>
                    <h1 data-i18n="donation.header.title">ü§ù ALLIANCE DONATION LEADERBOARD</h1>
                    <p class="event-subtitle" data-i18n="donation.header.subtitle">Weekly Alliance Donations</p>
                    <a class="lootbar-cta" href="https://lootbar.gg/top-up/last-z-survival-shooter?aff_short=DeFOUR" target="_blank" rel="noopener">
                        <img class="lootbar-icon" src="https://raw.githubusercontent.com/pWRDeFOUR/pwr-alliance-leaderboard/refs/heads/main/LBGG.png" alt="Lootbar icon">
                        <span data-i18n="global.lootbarCta">Buy Last War: Survival Game Packages Cheaper</span>
                    </a>
                </div>

                <div class="week-controls">
                    <div class="week-selector" id="donationWeekSelector"></div>
                    <div class="control-buttons">
                        <label for="donationUpload" class="upload-btn" id="donationUploadLabel" data-i18n="buttons.uploadDonation" style="display: none;">
                            üì§ Upload Donation CSV
                            <input type="file" id="donationUpload" accept=".csv" style="display: none;">
                        </label>
                        <button class="action-btn" id="donationRefreshBtn" data-i18n="buttons.refresh">üîÑ Refresh Data</button>
                        <button class="action-btn" id="donationDeleteWeekBtn" data-i18n="buttons.deleteWeek" style="display: none;">üóëÔ∏è Delete Week</button>
                        <button class="action-btn" id="donationAddCommanderBtn" data-i18n="donation.buttons.addCommander" style="display: none;">‚ûï Add Commander</button>
                        <button class="action-btn" id="donationExportPdfBtn" data-i18n="buttons.exportPdf">üìÑ Export PDF</button>
                        <button class="action-btn" id="donationExportCsvBtn" data-i18n="buttons.exportCsv">üíæ Export CSV</button>
                        <button class="action-btn" id="donationExportPngBtn" data-i18n="buttons.screenshot">üì∏ Screenshot</button>
                        <button class="action-btn" id="resetDonationBtn" data-i18n="buttons.resetDonation" style="display: none;">‚ôªÔ∏è Reset Donation Data</button>
                    </div>
                </div>

                <div class="kpi-grid" id="donationKpiGrid">
                    <div class="kpi-card">
                        <div class="kpi-label" data-i18n="donation.kpi.totalCommanders">Total Commanders</div>
                        <div class="kpi-value" id="donationTotalPlayers">-</div>
                        <div class="kpi-subtext" data-i18n="donation.kpi.entries">Entries loaded</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label" data-i18n="donation.kpi.topCommander">Top Commander</div>
                        <div class="kpi-value" id="donationTopCommander">-</div>
                        <div class="kpi-subtext" id="donationTopPoints">-</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label" data-i18n="donation.kpi.totalDonations">Total Donations</div>
                        <div class="kpi-value" id="donationTotalPoints">-</div>
                        <div class="kpi-subtext" data-i18n="donation.kpi.sum">Sum of all points</div>
                    </div>
                </div>

                <div class="movement-section" id="donationMovementSection" style="display: none;">
                    <h2 class="section-title" data-i18n="donation.movement.title">üìà Donation Highlights</h2>
                    <div class="movement-grid">
                        <div class="movement-card">
                            <div class="movement-icon">üöÄ</div>
                            <div class="movement-title" data-i18n="donation.movement.climber">Biggest Climber</div>
                            <div class="movement-player" id="donationBiggestClimber">-</div>
                            <div class="movement-stats" id="donationClimberStats">-</div>
                        </div>
                        <div class="movement-card">
                            <div class="movement-icon">üìâ</div>
                            <div class="movement-title" data-i18n="donation.movement.faller">Biggest Drop</div>
                            <div class="movement-player" id="donationBiggestFaller">-</div>
                            <div class="movement-stats" id="donationFallerStats">-</div>
                        </div>
                        <div class="movement-card">
                            <div class="movement-icon">üëë</div>
                            <div class="movement-title" data-i18n="donation.movement.mvp">Weekly MVP</div>
                            <div class="movement-player" id="donationWeeklyMvp">-</div>
                            <div class="movement-stats" id="donationMvpStats">-</div>
                        </div>
                        <div class="movement-card">
                            <div class="movement-icon">üî•</div>
                            <div class="movement-title" data-i18n="donation.movement.streak">Top Streak</div>
                            <div class="movement-player" id="donationTopStreak">-</div>
                            <div class="movement-stats" id="donationStreakStats">-</div>
                        </div>
                    </div>
                </div>

                <div class="division-grid" id="donationDivisionGrid">
                    <div class="division-card elite">
                        <div class="division-header">
                            <div class="division-icon">üíé</div>
                            <div class="division-name" data-i18n="donation.divisions.elite">100k+ Donors</div>
                            <div class="division-req" data-i18n="donation.divisions.eliteSub">Elite Tier</div>
                        </div>
                        <div class="division-count" id="donationEliteCount">0 Commanders</div>
                        <div class="division-players" id="donationElitePlayers">-</div>
                    </div>
                    <div class="division-card master">
                        <div class="division-header">
                            <div class="division-icon">‚öîÔ∏è</div>
                            <div class="division-name" data-i18n="donation.divisions.master">50k - 99k</div>
                            <div class="division-req" data-i18n="donation.divisions.masterSub">Master Tier</div>
                        </div>
                        <div class="division-count" id="donationMasterCount">0 Commanders</div>
                        <div class="division-players" id="donationMasterPlayers">-</div>
                    </div>
                    <div class="division-card warrior">
                        <div class="division-header">
                            <div class="division-icon">üõ°Ô∏è</div>
                            <div class="division-name" data-i18n="donation.divisions.warrior">Below 50k</div>
                            <div class="division-req" data-i18n="donation.divisions.warriorSub">Warrior Tier</div>
                        </div>
                        <div class="division-count" id="donationWarriorCount">0 Commanders</div>
                        <div class="division-players" id="donationWarriorPlayers">-</div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-title" data-i18n="donation.charts.topDonors">Top 10 Donors</div>
                        <canvas id="donationBarChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-title" data-i18n="donation.charts.distribution">Donation Distribution</div>
                        <canvas id="donationPieChart"></canvas>
                    </div>
                </div>

                <div class="performance-section">
                    <h2 class="section-title" data-i18n="donation.charts.performanceTitle">üìà Donation Performance</h2>
                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3 class="chart-title" data-i18n="donation.charts.topPerformance">üî• Top 20 Performance</h3>
                            <canvas id="donationTopPerformanceChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3 class="chart-title" data-i18n="donation.charts.bottomPerformance">üìâ Bottom 20 Performance</h3>
                            <canvas id="donationBottomPerformanceChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <h2 class="section-title" style="margin-top: 0;" data-i18n="donation.table.title">Donation Leaderboard</h2>
                    <div class="donation-filters">
                    <input type="text" id="donationSearch" class="search-bar" data-i18n-placeholder="donation.table.searchPlaceholder" placeholder="Search commander...">
                        <input type="number" id="donationMinPoints" class="search-bar" data-i18n-placeholder="donation.table.minPointsPlaceholder" placeholder="Min points">
                        <select id="donationTierFilter" class="search-bar">
                            <option value="" data-i18n="donation.table.allTiers">All tiers</option>
                            <option value="elite" data-i18n="donation.table.tierElite">100k+</option>
                            <option value="master" data-i18n="donation.table.tierMaster">50k-99k</option>
                            <option value="warrior" data-i18n="donation.table.tierWarrior">Below 50k</option>
                        </select>
                    </div>
                    <div class="table-wrapper">
                        <table class="data-table">
                            <thead id="donationTableHead"></thead>
                            <tbody id="donationTableBody"></tbody>
                        </table>
                    </div>
                    <div id="donationStatus" style="margin-top: 10px; color: #ffaa33; text-align: center;"></div>
                </div>
            </div>
        </div>

        <div id="guidesTab" class="tab-panel">
            <div class="dashboard-container">
                <div class="header">
                    <div class="alliance-logo">
                        <img src="https://raw.githubusercontent.com/pWRDeFOUR/pwr-alliance-leaderboard/refs/heads/main/logo.png" alt="pWR logo">
                    </div>
                    <h1 data-i18n="guides.title">üìò Guides</h1>
                    <div class="guides-header-actions">
                        <a class="lootbar-cta" href="https://lootbar.gg/top-up/last-z-survival-shooter?aff_short=DeFOUR" target="_blank" rel="noopener">
                            <img class="lootbar-icon" src="https://raw.githubusercontent.com/pWRDeFOUR/pwr-alliance-leaderboard/refs/heads/main/LBGG.png" alt="Lootbar icon">
                            <span data-i18n="global.lootbarCta">Buy Last War: Survival Game Packages Cheaper</span>
                        </a>
                        <button class="action-btn" id="addGuideBtn" data-i18n="guides.addButton" style="display: none;">‚ûï Add Guide</button>
                    </div>
                </div>

                <div class="table-container">
                    <h3 class="chart-title" data-i18n="guides.purchasesTitle">üìò Guides</h3>
                    <div class="guides-grid" id="guidesGrid"></div>
                </div>
            </div>
        </div>

        <div id="guidePreviewModal" class="modal">
            <div class="modal-content" style="max-width: 960px;">
                <div class="modal-header">
                    <h2 data-i18n="guides.previewTitle">üñºÔ∏è Guide Preview</h2>
                    <span class="modal-close" id="closeGuidePreview">&times;</span>
                </div>
                <div class="modal-body scrollable" style="text-align: center;">
                    <img id="guidePreviewImage" src="" alt="Guide preview" style="max-width: 100%; max-height: 70vh; width: auto; height: auto; border-radius: 12px; border: 1px solid var(--border);">
                </div>
            </div>
        </div>

        <div id="addGuideModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <h2 data-i18n="guides.addTitle">‚ûï Add Guide</h2>
                    <span class="modal-close" id="closeAddGuideModal">&times;</span>
                </div>
                <div class="modal-body">
                    <div style="margin-bottom: 20px;">
                        <label style="color: #997755; display: block; margin-bottom: 8px; font-weight: 600;" data-i18n="guides.form.title">Title:</label>
                        <input type="text" id="guideTitleInput" class="search-bar" data-i18n-placeholder="guides.form.titlePlaceholder" placeholder="Enter guide title" style="margin-bottom: 15px;">

                        <label style="color: #997755; display: block; margin-bottom: 8px; font-weight: 600;" data-i18n="guides.form.image">Image URL:</label>
                        <input type="text" id="guideImageInput" class="search-bar" data-i18n-placeholder="guides.form.imagePlaceholder" placeholder="Paste image URL">
                    </div>

                    <button class="upload-btn" id="saveGuideBtn" data-i18n="guides.form.save" style="width: 100%; margin-bottom: 10px;">
                        üíæ Save Guide
                    </button>

                    <div id="guideFormStatus" style="text-align: center; color: #ffaa33; margin-top: 10px; font-weight: 600;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        
        const firebaseConfig = {
          apiKey: "AIzaSyD7GiyI6DhBr_AYW8y_Rreyos5TLUazn-Q",
          authDomain: "pwr-alliance-leaderboard-17775.firebaseapp.com",
          databaseURL: "https://pwr-alliance-leaderboard-17775-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "pwr-alliance-leaderboard-17775",
          storageBucket: "pwr-alliance-leaderboard-17775.firebasestorage.app",
          messagingSenderId: "938865791588",
          appId: "1:938865791588:web:9385747e23eb18a5a58571"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();
        
        console.log('üî• Firebase initialized successfully!');
        
        // ============================================
        // INTERNATIONALIZATION (i18n) SYSTEM
        // ============================================
        
        const translations = {
            en: {
                global: {
                    title: "POWEr Alliance Command Center",
                    subtitle: "Live Leaderboards & Admin Controls",
                    pageTitle: "[pWR] Alliance Command Center",
                    lootbarCta: "Buy Last War: Survival Game Packages Cheaper from LootBar.gg"
                },
                theme: {
                    dark: "üåô Dark",
                    light: "‚òÄÔ∏è Light"
                },
                footer: {
                    createdBy: "Created by:",
                    subtitle: "Elite Alliance Dashboard System"
                },
                tabs: {
                    duel: "‚öîÔ∏è Alliance Duel",
                    donation: "ü§ù Donation Leaderboard",
                    guides: "üìò Guides"
                },
                header: {
                    title: "‚öîÔ∏è ALLIANCE DUEL LEADERBOARD ‚öîÔ∏è",
                    event: "Weekly Alliance Duel Event"
                },
                buttons: {
                    upload: "üì§ Upload Week Data",
                    uploadDonation: "üì§ Upload Donation CSV",
                    signIn: "üîê Sign In",
                    signOut: "üîì Sign Out",
                    refresh: "üîÑ Refresh Data",
                    deleteWeek: "üóëÔ∏è Delete Week",
                    addPlayer: "‚ûï Add Player",
                    resetDuel: "‚ôªÔ∏è Reset Duel Data",
                    resetDonation: "‚ôªÔ∏è Reset Donation Data",
                    exportPdf: "üìÑ Export PDF",
                    exportCsv: "üíæ Export CSV",
                    screenshot: "üì∏ Screenshot",
                    view: "View",
                    edit: "‚úèÔ∏è Edit",
                    delete: "üóëÔ∏è Delete"
                },
                table: {
                    rank: "Rank",
                    movement: "Movement",
                    playerName: "Player Name",
                    points: "Points",
                    achievements: "Achievements",
                    division: "Division",
                    actions: "Actions",
                    commander: "Commander",
                    total: "Total"
                },
                kpi: {
                    totalPlayers: "Total Players",
                    totalPlayersSub: "Active Warriors",
                    avgScore: "Average Score",
                    avgScoreSub: "Points per Player",
                    champion: "Champion",
                    lowestScore: "Lowest Score",
                    lowestScoreSub: "Entry Level"
                },
                movement: {
                    title: "üìà Weekly Movement Highlights",
                    climber: "Biggest Climber",
                    faller: "Biggest Drop",
                    mvp: "Weekly MVP",
                    streak: "Top Streak",
                    climbStat: "‚Üë {count} positions",
                    fallStat: "‚Üì {count} positions",
                    mvpStat: "+{count} points",
                    streakStat: "{count} weeks tracked"
                },
                charts: {
                    top10: "üèÜ Top 10 Champions",
                    distribution: "üìä Score Distribution",
                    topPerformance: "üî• Top 20 Performance",
                    bottomPerformance: "üìâ Bottom 20 Performance"
                },
                divisions: {
                    title: "üèÜ Division Rankings",
                    elite: "Elite Division",
                    master: "Master Division",
                    warrior: "Warrior Division",
                    eliteReq: ">100M",
                    masterReq: "50M-100M",
                    warriorReq: "<50M",
                    players: "Players",
                    playersCount: "{count} Players",
                    eliteShort: "Elite",
                    masterShort: "Master",
                    warriorShort: "Warrior",
                    eliteTier: "Elite (>100M)",
                    masterTier: "Master (50M-100M)",
                    warriorTier: "Warrior (<50M)"
                },
                leaderboard: {
                    title: "üìã Complete Leaderboard",
                    searchPlaceholder: "üîç Search player name...",
                    minPointsPlaceholder: "Min points",
                    allDivisions: "All divisions",
                    allWeeks: "All Weeks"
                },
                guides: {
                    title: "üìò Guides",
                    purchasesTitle: "üìò Guides",
                    previewTitle: "üñºÔ∏è Guide Preview",
                    addButton: "‚ûï Add Guide",
                    addTitle: "‚ûï Add Guide",
                    form: {
                        title: "Title:",
                        image: "Image URL:",
                        titlePlaceholder: "Enter guide title",
                        imagePlaceholder: "Paste image URL",
                        save: "üíæ Save Guide"
                    },
                    messages: {
                        signInRequired: "‚ùå Please sign in to add guides",
                        required: "‚ö†Ô∏è Title and image URL are required",
                        loading: "‚è≥ Loading guides...",
                        saving: "‚è≥ Saving guide...",
                        saved: "‚úÖ Guide added",
                        error: "‚ùå Error adding guide: {error}",
                        loadError: "‚ùå Error loading guides: {error}",
                        empty: "No guides yet"
                    }
                },
                modals: {
                    editPlayer: "‚úèÔ∏è EDIT PLAYER",
                    addPlayer: "‚ûï ADD NEW PLAYER",
                    playerProfile: "Player Profile",
                    currentRank: "Current Rank",
                    totalPoints: "Total Points",
                    division: "Division",
                    performanceHistory: "Weekly Performance History",
                    playerName: "Player Name:",
                    rank: "Rank:",
                    points: "Points:",
                    pointsPlaceholder: "Enter points (e.g., 254714950)",
                    playerNamePlaceholder: "Enter player name",
                    rankPlaceholder: "Enter rank",
                    save: "üíæ SAVE CHANGES",
                    add: "‚ûï ADD PLAYER",
                    cancel: "‚úñ Cancel"
                },
                auth: {
                    title: "üîê Sign In",
                    email: "Email",
                    emailPlaceholder: "admin@example.com",
                    password: "Password",
                    passwordPlaceholder: "Enter password",
                    remember: "Remember me",
                    required: "‚ö†Ô∏è Email and password are required",
                    signingIn: "‚è≥ Signing in...",
                    signedIn: "‚úÖ Signed in"
                },
                achievements: {
                    champion: "üëë Champion",
                    top3: "ü•á Top 3",
                    top10: "‚≠ê Top 10",
                    hundredM: "üíé 100M Club",
                    twoHundredM: "üèÜ 200M Club"
                },
                donation: {
                    buttons: {
                        addCommander: "‚ûï Add Commander"
                    },
                    form: {
                        editTitle: "‚úèÔ∏è EDIT COMMANDER",
                        addTitle: "‚ûï ADD COMMANDER",
                        commanderName: "Commander Name:",
                        rank: "Rank:",
                        points: "Points:",
                        commanderNamePlaceholder: "Enter commander name",
                        rankPlaceholder: "Enter rank",
                        pointsPlaceholder: "Enter points (e.g., 50000)",
                        save: "üíæ SAVE CHANGES",
                        add: "‚ûï ADD COMMANDER"
                    },
                    header: {
                        title: "ü§ù ALLIANCE DONATION LEADERBOARD",
                        subtitle: "Weekly Alliance Donations"
                    },
                    kpi: {
                        totalCommanders: "Total Commanders",
                        topCommander: "Top Commander",
                        totalDonations: "Total Donations",
                        entries: "Entries loaded",
                        sum: "Sum of all points",
                        pointsSuffix: "{points} pts"
                    },
                    movement: {
                        title: "üìà Donation Highlights",
                        climber: "Biggest Climber",
                        faller: "Biggest Drop",
                        mvp: "Weekly MVP",
                        streak: "Top Streak",
                        climbStat: "‚Üë {count} positions",
                        fallStat: "‚Üì {count} positions",
                        mvpStat: "+{count} points",
                        streakStat: "{count} consecutive weeks in Top 10"
                    },
                    divisions: {
                        elite: "100k+ Donors",
                        eliteSub: "Elite Tier",
                        master: "50k - 99k",
                        masterSub: "Master Tier",
                        warrior: "Below 50k",
                        warriorSub: "Warrior Tier",
                        eliteShort: "100k+",
                        masterShort: "50k-99k",
                        warriorShort: "Below 50k",
                        count: "{count} Commanders"
                    },
                    charts: {
                        topDonors: "Top 10 Donors",
                        distribution: "Donation Distribution",
                        performanceTitle: "üìà Donation Performance",
                        topPerformance: "üî• Top 20 Performance",
                        bottomPerformance: "üìâ Bottom 20 Performance"
                    },
                    table: {
                        title: "Donation Leaderboard",
                        searchPlaceholder: "Search commander...",
                        minPointsPlaceholder: "Min points",
                        allTiers: "All tiers",
                        tierElite: "100k+",
                        tierMaster: "50k-99k",
                        tierWarrior: "Below 50k",
                        allWeeks: "All Weeks"
                    },
                    modal: {
                        title: "Donation Profile",
                        rank: "Current Rank",
                        points: "Total Points",
                        tier: "Tier",
                        history: "Donation History"
                    },
                    achievements: {
                        topDonor: "üëë Top Donor",
                        top3: "ü•á Top 3",
                        top10: "‚≠ê Top 10",
                        club100k: "üíé 100k Club",
                        club50k: "üí∞ 50k+"
                    },
                    messages: {
                        signInRequired: "‚ùå Please sign in to upload donations",
                        loading: "‚è≥ Loading donations...",
                        loadedAllWeeks: "Loaded All Weeks ({count} commanders)",
                        loadedWeek: "Loaded Week {week} ({count} commanders)",
                        uploadSuccess: "‚úÖ Uploaded Week {week} ({count} commanders)",
                        uploadError: "‚ùå Error uploading donations: {error}",
                        noExport: "‚ö†Ô∏è No donation data to export",
                        deleteConfirm: "Are you sure you want to delete \"{name}\" (Rank #{rank}) from Week {week}?\n\nThis action cannot be undone!",
                        deleteWeekConfirm: "‚ö†Ô∏è WARNING: You are about to delete Week {week} permanently!\n\nThis will remove all {count} commanders from Week {week}.\n\nType \"DELETE\" to confirm:",
                        deleteWeekOnlyWeek: "‚ùå Cannot delete the only week! You must have at least one week of data.",
                        deleteWeekCancelled: "Deletion cancelled",
                        deleteWeekSuccess: "‚úÖ Week {week} has been deleted",
                        deleteWeekError: "‚ùå Error deleting week: {error}",
                        refreshSuccess: "‚úÖ Donations refreshed! Loaded {count} weeks from Firebase.",
                        refreshError: "‚ùå Error refreshing donations: {error}",
                        addSuccess: "‚úÖ Commander added successfully!",
                        editSuccess: "‚úÖ Commander updated successfully!",
                        deleteSuccess: "‚úÖ Commander deleted successfully",
                        addError: "‚ùå Error adding commander: {error}",
                        editError: "‚ùå Error updating commander: {error}",
                        deleteError: "‚ùå Error deleting commander: {error}",
                        resetConfirm: "‚ö†Ô∏è This will permanently delete ALL Donation data in Firebase.\n\nType \"RESET\" to confirm:",
                        resetSuccess: "‚úÖ Donation data reset",
                        resetCancelled: "Reset cancelled",
                        resetError: "‚ùå Reset failed: {error}"
                    }
                },
                messages: {
                    signInRequired: "‚ùå Please sign in to upload data",
                    deleteConfirm: "Are you sure you want to delete",
                    uploadSuccess: "‚úÖ Week {week} uploaded successfully!",
                    deleteSuccess: "‚úÖ Player deleted successfully",
                    saveSuccess: "‚úÖ Player updated successfully!",
                    addSuccess: "‚úÖ Player added successfully!",
                    requiredFields: "‚ö†Ô∏è All fields are required",
                    pointsPositive: "‚ö†Ô∏è Points must be greater than 0",
                    saving: "‚è≥ Saving...",
                    adding: "‚è≥ Adding player...",
                    error: "‚ùå Error",
                    errorDetail: "‚ùå {error}",
                    signInEdit: "‚ùå Please sign in to edit players",
                    signInDeletePlayer: "‚ùå Please sign in to delete players",
                    signInAddPlayer: "‚ùå Please sign in to add players",
                    signInDeleteWeek: "‚ùå Please sign in to delete weeks",
                    playerNotFound: "‚ùå Player not found",
                    deletePlayerConfirm: "Are you sure you want to delete \"{name}\" (Rank #{rank}) from Week {week}?\n\nThis action cannot be undone!",
                    deletePlayerSuccess: "‚úÖ \"{name}\" has been deleted from Week {week}",
                    deletePlayerError: "‚ùå Error deleting player: {error}",
                    cannotDeleteOnlyWeek: "‚ùå Cannot delete the only week! You must have at least one week of data.",
                    deleteWeekConfirm: "‚ö†Ô∏è WARNING: You are about to delete Week {week} permanently!\n\nThis will remove all {count} players from Week {week}.\n\nType \"DELETE\" to confirm:",
                    deleteCancelled: "Deletion cancelled",
                    weekDeleted: "‚úÖ Week {week} has been deleted",
                    deleteWeekError: "‚ùå Error deleting week: {error}",
                    refreshSuccess: "‚úÖ Data refreshed! Loaded {count} weeks from Firebase.",
                    refreshError: "‚ùå Error refreshing data: {error}",
                    uploadSuccessDetail: "‚úÖ Week {week} uploaded successfully to Firebase!\n{count} players uploaded.",
                    uploadError: "‚ùå Error uploading CSV: {error}\n\nCheck browser console (F12) for details.",
                    invalidCsv: "‚ùå No valid data found in CSV. Please check the file format.\n\nExpected format:\nRank,Player Name,Points\n1,Name,\"1,000,000\"",
                    fileReadError: "‚ùå Error reading file. Please try again.",
                    pdfExportPlaceholder: "üìÑ PDF export feature - Would use jsPDF library to generate PDF report of current week data",
                    signOutConfirm: "Sign out from {email}?",
                    signOutSuccess: "‚úÖ Signed out successfully",
                    signedInAs: "Signed in as {email}",
                    uploadHint: "Signed in as {email} - Click to upload",
                    signInHint: "Sign in to manage data",
                    noData: "NO DATA UPLOADED YET",
                    uploadFirst: "Please sign in and upload Week 1 data to get started",
                    loadingFirebaseTitle: "LOADING FROM FIREBASE...",
                    loadingFirebaseSub: "Fetching alliance data...",
                    refreshing: "‚è≥ Refreshing...",
                    resetConfirm: "‚ö†Ô∏è This will permanently delete ALL Alliance Duel data in Firebase.\n\nType \"RESET\" to confirm:",
                    resetSuccess: "‚úÖ Alliance Duel data reset",
                    resetCancelled: "Reset cancelled",
                    resetError: "‚ùå Reset failed: {error}"
                },
                week: "Week"
            },
            ar: {
                global: {
                    title: "ŸÖÿ±ŸÉÿ≤ ŸÇŸäÿßÿØÿ© ÿ™ÿ≠ÿßŸÑŸÅ POWEr",
                    subtitle: "ŸÑŸàÿ≠ÿßÿ™ ÿµÿØÿßÿ±ÿ© ŸÖÿ®ÿßÿ¥ÿ±ÿ© Ÿàÿ£ÿØŸàÿßÿ™ ÿßŸÑÿ•ÿØÿßÿ±ÿ©",
                    pageTitle: "[pWR] ŸÖÿ±ŸÉÿ≤ ŸÇŸäÿßÿØÿ© ÿßŸÑÿ™ÿ≠ÿßŸÑŸÅ",
                    lootbarCta: "ÿßÿ¥ÿ™ÿ± ÿ®ÿßŸÇÿßÿ™ ŸÑÿπÿ®ÿ© ÿßŸÑÿ≠ÿ±ÿ® ÿßŸÑÿ£ÿÆŸäÿ±ÿ© ÿ®ÿ¥ŸÉŸÑ ÿ£ÿ±ÿÆÿµ ŸÖŸÜ LootBar.gg"
                },
                theme: {
                    dark: "üåô ÿØÿßŸÉŸÜ",
                    light: "‚òÄÔ∏è ŸÅÿßÿ™ÿ≠"
                },
                footer: {
                    createdBy: "ÿ™ŸÖ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ° ÿ®Ÿàÿßÿ≥ÿ∑ÿ©:",
                    subtitle: "ŸÜÿ∏ÿßŸÖ ŸÑŸàÿ≠ÿ© ŸÇŸäÿßÿØÿ© ÿ™ÿ≠ÿßŸÑŸÅ ÿßŸÑŸÜÿÆÿ®ÿ©"
                },
                tabs: {
                    duel: "‚öîÔ∏è ŸÖÿ®ÿßÿ±ÿ≤ÿ© ÿßŸÑÿ™ÿ≠ÿßŸÑŸÅ",
                    donation: "ü§ù ŸÑŸàÿ≠ÿ© ÿ™ÿ®ÿ±ÿπÿßÿ™ ÿßŸÑÿ™ÿ≠ÿßŸÑŸÅ",
                    guides: "üìò ÿßŸÑÿ¥ÿ±Ÿàÿ≠ÿßÿ™"
                },
                header: {
                    title: "‚öîÔ∏è ŸÑŸàÿ≠ÿ© ÿµÿØÿßÿ±ÿ© ŸÖÿ®ÿßÿ±ÿ≤ÿ© ÿßŸÑÿ™ÿ≠ÿßŸÑŸÅ ‚öîÔ∏è",
                    event: "ÿ≠ÿØÿ´ ÿßŸÑŸÖÿ®ÿßÿ±ÿ≤ÿ© ÿßŸÑÿ£ÿ≥ÿ®ŸàÿπŸäÿ© ŸÑŸÑÿ™ÿ≠ÿßŸÑŸÅ"
                },
                buttons: {
                    upload: "üì§ ÿ±ŸÅÿπ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ",
                    uploadDonation: "üì§ ÿ±ŸÅÿπ ÿ™ÿ®ÿ±ÿπÿßÿ™ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ",
                    signIn: "üîê ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",
                    signOut: "üîì ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",
                    refresh: "üîÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™",
                    deleteWeek: "üóëÔ∏è ÿ≠ÿ∞ŸÅ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ",
                    addPlayer: "‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸÑÿßÿπÿ®",
                    resetDuel: "‚ôªÔ∏è ÿ•ÿπÿßÿØÿ© ÿ∂ÿ®ÿ∑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ®ÿßÿ±ÿ≤ÿ©",
                    resetDonation: "‚ôªÔ∏è ÿ•ÿπÿßÿØÿ© ÿ∂ÿ®ÿ∑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿ®ÿ±ÿπÿßÿ™",
                    exportPdf: "üìÑ ÿ™ÿµÿØŸäÿ± PDF",
                    exportCsv: "üíæ ÿ™ÿµÿØŸäÿ± CSV",
                    screenshot: "üì∏ ŸÑŸÇÿ∑ÿ© ÿ¥ÿßÿ¥ÿ©",
                    view: "ÿπÿ±ÿ∂",
                    edit: "‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ",
                    delete: "üóëÔ∏è ÿ≠ÿ∞ŸÅ"
                },
                table: {
                    rank: "ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®",
                    movement: "ÿßŸÑÿ≠ÿ±ŸÉÿ©",
                    playerName: "ÿßÿ≥ŸÖ ÿßŸÑŸÑÿßÿπÿ®",
                    points: "ÿßŸÑŸÜŸÇÿßÿ∑",
                    achievements: "ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™",
                    division: "ÿßŸÑŸÅÿ¶ÿ©",
                    actions: "ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™",
                    commander: "ÿßŸÑŸÇÿßÿ¶ÿØ",
                    total: "ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä"
                },
                kpi: {
                    totalPlayers: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ",
                    totalPlayersSub: "ÿßŸÑŸÖŸÇÿßÿ™ŸÑŸàŸÜ ÿßŸÑŸÜÿ¥ÿ∑ŸàŸÜ",
                    avgScore: "ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑŸÜŸÇÿßÿ∑",
                    avgScoreSub: "ŸÜŸÇÿßÿ∑ ŸÑŸÉŸÑ ŸÑÿßÿπÿ®",
                    champion: "ÿßŸÑÿ®ÿ∑ŸÑ",
                    lowestScore: "ÿ£ŸÇŸÑ ŸÜÿ™Ÿäÿ¨ÿ©",
                    lowestScoreSub: "ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ£ÿØŸÜŸâ"
                },
                movement: {
                    title: "üìà ÿ£ÿ®ÿ±ÿ≤ ÿßŸÑÿ™ÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿ£ÿ≥ÿ®ŸàÿπŸäÿ©",
                    climber: "ÿ£ŸÉÿ®ÿ± ÿµÿπŸàÿØ",
                    faller: "ÿ£ŸÉÿ®ÿ± Ÿáÿ®Ÿàÿ∑",
                    mvp: "ÿ£ŸÅÿ∂ŸÑ ŸÑÿßÿπÿ®",
                    streak: "ÿ£ÿ∑ŸàŸÑ ÿ≥ŸÑÿ≥ŸÑÿ©",
                    climbStat: "‚Üë {count} ŸÖÿ±ÿßŸÉÿ≤",
                    fallStat: "‚Üì {count} ŸÖÿ±ÿßŸÉÿ≤",
                    mvpStat: "+{count} ŸÜŸÇÿ∑ÿ©",
                    streakStat: "{count} ÿ£ÿ≥ÿßÿ®Ÿäÿπ ŸÖÿ≥ÿ¨ŸÑÿ©"
                },
                charts: {
                    top10: "üèÜ ÿ£ŸÅÿ∂ŸÑ 10 ÿ£ÿ®ÿ∑ÿßŸÑ",
                    distribution: "üìä ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑŸÜŸÇÿßÿ∑",
                    topPerformance: "üî• ÿ£ÿØÿßÿ° ÿ£ŸÅÿ∂ŸÑ 20",
                    bottomPerformance: "üìâ ÿ£ÿØÿßÿ° ÿ£ÿ≥ŸÅŸÑ 20"
                },
                divisions: {
                    title: "üèÜ ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÅÿ¶ÿßÿ™",
                    elite: "ŸÅÿ¶ÿ© ÿßŸÑŸÜÿÆÿ®ÿ©",
                    master: "ŸÅÿ¶ÿ© ÿßŸÑŸÖÿßÿ≥ÿ™ÿ±ÿ≤",
                    warrior: "ŸÅÿ¶ÿ© ÿßŸÑŸÖÿ≠ÿßÿ±ÿ®ŸäŸÜ",
                    eliteReq: "ÿ£ŸÉÿ´ÿ± ŸÖŸÜ 100ŸÖ",
                    masterReq: "50ŸÖ - 100ŸÖ",
                    warriorReq: "ÿ£ŸÇŸÑ ŸÖŸÜ 50ŸÖ",
                    players: "ŸÑÿßÿπÿ®ŸäŸÜ",
                    playersCount: "{count} ŸÑÿßÿπÿ®ŸäŸÜ",
                    eliteShort: "ÿßŸÑŸÜÿÆÿ®ÿ©",
                    masterShort: "ÿßŸÑŸÖÿßÿ≥ÿ™ÿ±",
                    warriorShort: "ÿßŸÑŸÖÿ≠ÿßÿ±ÿ®",
                    eliteTier: "ÿßŸÑŸÜÿÆÿ®ÿ© (ÿ£ŸÉÿ´ÿ± ŸÖŸÜ 100ŸÖ)",
                    masterTier: "ÿßŸÑŸÖÿßÿ≥ÿ™ÿ± (50ŸÖ - 100ŸÖ)",
                    warriorTier: "ÿßŸÑŸÖÿ≠ÿßÿ±ÿ® (<50ŸÖ)"
                },
                leaderboard: {
                    title: "üìã ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÉÿßŸÖŸÑÿ©",
                    searchPlaceholder: "üîç ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßÿ≥ŸÖ ÿßŸÑŸÑÿßÿπÿ®...",
                    minPointsPlaceholder: "ÿ£ŸÇŸÑ ŸÜŸÇÿßÿ∑",
                    allDivisions: "ŸÉŸÑ ÿßŸÑŸÅÿ¶ÿßÿ™",
                    allWeeks: "ŸÉŸÑ ÿßŸÑÿ£ÿ≥ÿßÿ®Ÿäÿπ"
                },
                guides: {
                    title: "üìò ÿßŸÑÿ¥ÿ±Ÿàÿ≠ÿßÿ™",
                    
                    purchasesTitle: "üìò ÿ¥ÿ±Ÿàÿ≠ÿßÿ™",
                    previewTitle: "üñºÔ∏è ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿØŸÑŸäŸÑ",
                    addButton: "‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿØŸÑŸäŸÑ",
                    addTitle: "‚ûï ÿ•ÿ∂ÿßŸÅÿ© ÿØŸÑŸäŸÑ",
                    form: {
                        title: "ÿßŸÑÿπŸÜŸàÿßŸÜ:",
                        image: "ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿµŸàÿ±ÿ©:",
                        titlePlaceholder: "ÿ£ÿØÿÆŸÑ ÿπŸÜŸàÿßŸÜ ÿßŸÑÿØŸÑŸäŸÑ",
                        imagePlaceholder: "ÿ£ŸÑÿµŸÇ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿµŸàÿ±ÿ©",
                        save: "üíæ ÿ≠ŸÅÿ∏ ÿßŸÑÿØŸÑŸäŸÑ"
                    },
                    messages: {
                        signInRequired: "‚ùå Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ£ÿØŸÑÿ©",
                        required: "‚ö†Ô∏è ÿßŸÑÿπŸÜŸàÿßŸÜ Ÿàÿ±ÿßÿ®ÿ∑ ÿßŸÑÿµŸàÿ±ÿ© ŸÖÿ∑ŸÑŸàÿ®ÿßŸÜ",
                        loading: "‚è≥ ÿ¨ÿßÿ±Ÿç ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿØŸÑÿ©...",
                        saving: "‚è≥ ÿ¨ÿßÿ±Ÿç ÿ≠ŸÅÿ∏ ÿßŸÑÿØŸÑŸäŸÑ...",
                        saved: "‚úÖ ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿØŸÑŸäŸÑ",
                        error: "‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿØŸÑŸäŸÑ: {error}",
                        loadError: "‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿØŸÑÿ©: {error}",
                        empty: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ£ÿØŸÑÿ© ÿ®ÿπÿØ"
                    }
                },
                modals: {
                    editPlayer: "‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÑÿßÿπÿ®",
                    addPlayer: "‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸÑÿßÿπÿ® ÿ¨ÿØŸäÿØ",
                    playerProfile: "ŸÖŸÑŸÅ ÿßŸÑŸÑÿßÿπÿ®",
                    currentRank: "ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿ≠ÿßŸÑŸä",
                    totalPoints: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÜŸÇÿßÿ∑",
                    division: "ÿßŸÑŸÅÿ¶ÿ©",
                    performanceHistory: "ÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ÿØÿßÿ° ÿßŸÑÿ£ÿ≥ÿ®ŸàÿπŸä",
                    playerName: "ÿßÿ≥ŸÖ ÿßŸÑŸÑÿßÿπÿ®:",
                    rank: "ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®:",
                    points: "ÿßŸÑŸÜŸÇÿßÿ∑:",
                    pointsPlaceholder: "ÿ£ÿØÿÆŸÑ ÿßŸÑŸÜŸÇÿßÿ∑ (ŸÖÿ´ÿßŸÑ: 254714950)",
                    playerNamePlaceholder: "ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÑÿßÿπÿ®",
                    rankPlaceholder: "ÿ£ÿØÿÆŸÑ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®",
                    save: "üíæ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™",
                    add: "‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸÑÿßÿπÿ®",
                    cancel: "‚úñ ÿ•ŸÑÿ∫ÿßÿ°"
                },
                auth: {
                    title: "üîê ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",
                    email: "ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä",
                    emailPlaceholder: "admin@example.com",
                    password: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±",
                    passwordPlaceholder: "ÿ£ÿØÿÆŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±",
                    remember: "ÿ™ÿ∞ŸÉÿ±ŸÜŸä",
                    required: "‚ö†Ô∏è ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸàŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ŸÖÿ∑ŸÑŸàÿ®ÿ©",
                    signingIn: "‚è≥ ÿ¨ÿßÿ±Ÿç ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ...",
                    signedIn: "‚úÖ ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ"
                },
                achievements: {
                    champion: "üëë ÿßŸÑÿ®ÿ∑ŸÑ",
                    top3: "ü•á ÿ£ŸÅÿ∂ŸÑ 3",
                    top10: "‚≠ê ÿ£ŸÅÿ∂ŸÑ 10",
                    hundredM: "üíé ŸÜÿßÿØŸä 100M",
                    twoHundredM: "üèÜ ŸÜÿßÿØŸä 200M"
                },
                donation: {
                    buttons: {
                        addCommander: "‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿ¶ÿØ"
                    },
                    form: {
                        editTitle: "‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÇÿßÿ¶ÿØ",
                        addTitle: "‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿ¶ÿØ",
                        commanderName: "ÿßÿ≥ŸÖ ÿßŸÑŸÇÿßÿ¶ÿØ:",
                        rank: "ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®:",
                        points: "ÿßŸÑŸÜŸÇÿßÿ∑:",
                        commanderNamePlaceholder: "ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÇÿßÿ¶ÿØ",
                        rankPlaceholder: "ÿ£ÿØÿÆŸÑ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®",
                        pointsPlaceholder: "ÿ£ÿØÿÆŸÑ ÿßŸÑŸÜŸÇÿßÿ∑ (ŸÖÿ´ÿßŸÑ: 50000)",
                        save: "üíæ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™",
                        add: "‚ûï ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿßÿ¶ÿØ"
                    },
                    header: {
                        title: "ü§ù ŸÑŸàÿ≠ÿ© ÿµÿØÿßÿ±ÿ© ÿ™ÿ®ÿ±ÿπÿßÿ™ ÿßŸÑÿ™ÿ≠ÿßŸÑŸÅ",
                        subtitle: "ÿ™ÿ®ÿ±ÿπÿßÿ™ ÿßŸÑÿ™ÿ≠ÿßŸÑŸÅ ÿßŸÑÿ£ÿ≥ÿ®ŸàÿπŸäÿ©"
                    },
                    kpi: {
                        totalCommanders: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÇÿßÿØÿ©",
                        topCommander: "ÿ£ŸÅÿ∂ŸÑ ŸÇÿßÿ¶ÿØ",
                        totalDonations: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ™ÿ®ÿ±ÿπÿßÿ™",
                        entries: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•ÿØÿÆÿßŸÑÿßÿ™",
                        sum: "ŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÜŸÇÿßÿ∑",
                        pointsSuffix: "{points} ŸÜŸÇÿ∑ÿ©"
                    },
                    movement: {
                        title: "üìà ÿ£ÿ®ÿ±ÿ≤ ÿ™ÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿ™ÿ®ÿ±ÿπÿßÿ™",
                        climber: "ÿ£ŸÉÿ®ÿ± ÿµÿπŸàÿØ",
                        faller: "ÿ£ŸÉÿ®ÿ± Ÿáÿ®Ÿàÿ∑",
                        mvp: "ÿ£ŸÅÿ∂ŸÑ ŸÖÿ™ÿ®ÿ±ÿπ",
                        streak: "ÿ£ÿ∑ŸàŸÑ ÿ≥ŸÑÿ≥ŸÑÿ©",
                        climbStat: "‚Üë {count} ŸÖÿ±ÿßŸÉÿ≤",
                        fallStat: "‚Üì {count} ŸÖÿ±ÿßŸÉÿ≤",
                        mvpStat: "+{count} ŸÜŸÇÿ∑ÿ©",
                        streakStat: "{count} ÿ£ÿ≥ÿßÿ®Ÿäÿπ ŸÖÿ™ÿ™ÿßŸÑŸäÿ© ÿ∂ŸÖŸÜ ÿ£ŸÅÿ∂ŸÑ 10"
                    },
                    divisions: {
                        elite: "ŸÖÿ™ÿ®ÿ±ÿπŸà +100ÿ£ŸÑŸÅ",
                        eliteSub: "ŸÅÿ¶ÿ© ÿßŸÑŸÜÿÆÿ®ÿ©",
                        master: "50ÿ£ŸÑŸÅ - 99ÿ£ŸÑŸÅ",
                        masterSub: "ŸÅÿ¶ÿ© ÿßŸÑŸÖÿßÿ≥ÿ™ÿ±ÿ≤",
                        warrior: "ÿ£ŸÇŸÑ ŸÖŸÜ 50ÿ£ŸÑŸÅ",
                        warriorSub: "ŸÅÿ¶ÿ© ÿßŸÑŸÖÿ≠ÿßÿ±ÿ®ŸäŸÜ",
                        eliteShort: "100ÿ£ŸÑŸÅ+",
                        masterShort: "50ÿ£ŸÑŸÅ-99ÿ£ŸÑŸÅ",
                        warriorShort: "ÿ£ŸÇŸÑ ŸÖŸÜ 50ÿ£ŸÑŸÅ",
                        count: "{count} ŸÇÿßÿ¶ÿØ"
                    },
                    charts: {
                        topDonors: "ÿ£ŸÅÿ∂ŸÑ 10 ŸÖÿ™ÿ®ÿ±ÿπŸäŸÜ",
                        distribution: "ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑÿ™ÿ®ÿ±ÿπÿßÿ™",
                        performanceTitle: "üìà ÿ£ÿØÿßÿ° ÿßŸÑÿ™ÿ®ÿ±ÿπÿßÿ™",
                        topPerformance: "üî• ÿ£ÿØÿßÿ° ÿ£ŸÅÿ∂ŸÑ 20",
                        bottomPerformance: "üìâ ÿ£ÿØÿßÿ° ÿ£ÿ≥ŸÅŸÑ 20"
                    },
                    table: {
                        title: "ŸÑŸàÿ≠ÿ© ÿµÿØÿßÿ±ÿ© ÿßŸÑÿ™ÿ®ÿ±ÿπÿßÿ™",
                        searchPlaceholder: "ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÇÿßÿ¶ÿØ...",
                        minPointsPlaceholder: "ÿ£ŸÇŸÑ ŸÜŸÇÿßÿ∑",
                        allTiers: "ŸÉŸÑ ÿßŸÑŸÅÿ¶ÿßÿ™",
                        tierElite: "100ÿ£ŸÑŸÅ+",
                        tierMaster: "50ÿ£ŸÑŸÅ-99ÿ£ŸÑŸÅ",
                        tierWarrior: "ÿ£ŸÇŸÑ ŸÖŸÜ 50ÿ£ŸÑŸÅ",
                        allWeeks: "ŸÉŸÑ ÿßŸÑÿ£ÿ≥ÿßÿ®Ÿäÿπ"
                    },
                    modal: {
                        title: "ŸÖŸÑŸÅ ÿßŸÑÿ™ÿ®ÿ±ÿπÿßÿ™",
                        rank: "ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿ≠ÿßŸÑŸä",
                        points: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÜŸÇÿßÿ∑",
                        tier: "ÿßŸÑŸÅÿ¶ÿ©",
                        history: "ÿ≥ÿ¨ŸÑ ÿßŸÑÿ™ÿ®ÿ±ÿπÿßÿ™"
                    },
                    achievements: {
                        topDonor: "üëë ÿ£ŸÅÿ∂ŸÑ ŸÖÿ™ÿ®ÿ±ÿπ",
                        top3: "ü•á ÿ£ŸÅÿ∂ŸÑ 3",
                        top10: "‚≠ê ÿ£ŸÅÿ∂ŸÑ 10",
                        club100k: "üíé ŸÜÿßÿØŸä 100ÿ£ŸÑŸÅ",
                        club50k: "üí∞ 50ÿ£ŸÑŸÅ+"
                    },
                    messages: {
                        signInRequired: "‚ùå Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑÿ±ŸÅÿπ ÿßŸÑÿ™ÿ®ÿ±ÿπÿßÿ™",
                        loading: "‚è≥ ÿ¨ÿßÿ±Ÿç ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ®ÿ±ÿπÿßÿ™...",
                        loadedAllWeeks: "ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ŸÉŸÑ ÿßŸÑÿ£ÿ≥ÿßÿ®Ÿäÿπ ({count} ŸÇÿßÿ¶ÿØ)",
                        loadedWeek: "ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ {week} ({count} ŸÇÿßÿ¶ÿØ)",
                        uploadSuccess: "‚úÖ ÿ™ŸÖ ÿ±ŸÅÿπ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ {week} ({count} ŸÇÿßÿ¶ÿØ)",
                        uploadError: "‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ±ŸÅÿπ ÿßŸÑÿ™ÿ®ÿ±ÿπÿßÿ™: {error}",
                        noExport: "‚ö†Ô∏è ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿ®ÿ±ÿπÿßÿ™ ŸÑŸÑÿ™ÿµÿØŸäÿ±",
                        deleteConfirm: "ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ \"{name}\" (ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® #{rank}) ŸÖŸÜ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ {week}ÿü\n\nŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°!",
                        deleteWeekConfirm: "‚ö†Ô∏è ÿ™ÿ≠ÿ∞Ÿäÿ±: ÿ£ŸÜÿ™ ÿπŸÑŸâ Ÿàÿ¥ŸÉ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ {week} ŸÜŸáÿßÿ¶ŸäÿßŸã!\n\nÿ≥Ÿäÿ§ÿØŸä ÿ∞ŸÑŸÉ ÿ•ŸÑŸâ ÿ≠ÿ∞ŸÅ {count} ŸÇÿßÿ¶ÿØ ŸÖŸÜ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ {week}.\n\nÿßŸÉÿ™ÿ® \"DELETE\" ŸÑŸÑÿ™ÿ£ŸÉŸäÿØ:",
                        deleteWeekOnlyWeek: "‚ùå ŸÑÿß ŸäŸÖŸÉŸÜ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ ÿßŸÑŸàÿ≠ŸäÿØ! Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ŸÑÿØŸäŸÉ ÿ£ÿ≥ÿ®Ÿàÿπ Ÿàÿßÿ≠ÿØ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ.",
                        deleteWeekCancelled: "ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≠ÿ∞ŸÅ",
                        deleteWeekSuccess: "‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ {week}",
                        deleteWeekError: "‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ: {error}",
                        refreshSuccess: "‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿ®ÿ±ÿπÿßÿ™! ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {count} ÿ£ÿ≥ÿßÿ®Ÿäÿπ ŸÖŸÜ Firebase.",
                        refreshError: "‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿ®ÿ±ÿπÿßÿ™: {error}",
                        addSuccess: "‚úÖ ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿ¶ÿØ ÿ®ŸÜÿ¨ÿßÿ≠!",
                        editSuccess: "‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿ¶ÿØ ÿ®ŸÜÿ¨ÿßÿ≠!",
                        deleteSuccess: "‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿ¶ÿØ ÿ®ŸÜÿ¨ÿßÿ≠",
                        addError: "‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿßÿ¶ÿØ: {error}",
                        editError: "‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿ¶ÿØ: {error}",
                        deleteError: "‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÇÿßÿ¶ÿØ: {error}",
                        resetConfirm: "‚ö†Ô∏è ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿ®ÿ±ÿπÿßÿ™ ŸÜŸáÿßÿ¶ŸäÿßŸã ŸÖŸÜ Firebase.\n\nÿßŸÉÿ™ÿ® \"RESET\" ŸÑŸÑÿ™ÿ£ŸÉŸäÿØ:",
                        resetSuccess: "‚úÖ ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ∂ÿ®ÿ∑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿ®ÿ±ÿπÿßÿ™",
                        resetCancelled: "ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∂ÿ®ÿ∑",
                        resetError: "‚ùå ŸÅÿ¥ŸÑ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∂ÿ®ÿ∑: {error}"
                    }
                },
                messages: {
                    signInRequired: "‚ùå Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑÿ±ŸÅÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™",
                    deleteConfirm: "ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ",
                    uploadSuccess: "‚úÖ ÿ™ŸÖ ÿ±ŸÅÿπ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ {week} ÿ®ŸÜÿ¨ÿßÿ≠!",
                    deleteSuccess: "‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÑÿßÿπÿ® ÿ®ŸÜÿ¨ÿßÿ≠",
                    saveSuccess: "‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÑÿßÿπÿ® ÿ®ŸÜÿ¨ÿßÿ≠!",
                    addSuccess: "‚úÖ ÿ™ŸÖÿ™ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÑÿßÿπÿ® ÿ®ŸÜÿ¨ÿßÿ≠!",
                    requiredFields: "‚ö†Ô∏è ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸÖÿ∑ŸÑŸàÿ®ÿ©",
                    pointsPositive: "‚ö†Ô∏è Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ÿßŸÑŸÜŸÇÿßÿ∑ ÿ£ŸÉÿ®ÿ± ŸÖŸÜ 0",
                    saving: "‚è≥ ÿ¨ÿßÿ±Ÿç ÿßŸÑÿ≠ŸÅÿ∏...",
                    adding: "‚è≥ ÿ¨ÿßÿ±Ÿç ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÑÿßÿπÿ®...",
                    error: "‚ùå ÿÆÿ∑ÿ£",
                    errorDetail: "‚ùå {error}",
                    signInEdit: "‚ùå Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ",
                    signInDeletePlayer: "‚ùå Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑÿ≠ÿ∞ŸÅ ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ",
                    signInAddPlayer: "‚ùå Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ",
                    signInDeleteWeek: "‚ùå Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑÿ≠ÿ∞ŸÅ ÿßŸÑÿ£ÿ≥ÿßÿ®Ÿäÿπ",
                    playerNotFound: "‚ùå ÿßŸÑŸÑÿßÿπÿ® ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ",
                    deletePlayerConfirm: "ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ \"{name}\" (ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® #{rank}) ŸÖŸÜ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ {week}ÿü\n\nŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°!",
                    deletePlayerSuccess: "‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ \"{name}\" ŸÖŸÜ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ {week}",
                    deletePlayerError: "‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑŸÑÿßÿπÿ®: {error}",
                    cannotDeleteOnlyWeek: "‚ùå ŸÑÿß ŸäŸÖŸÉŸÜ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ ÿßŸÑŸàÿ≠ŸäÿØ! Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ŸÑÿØŸäŸÉ ÿ£ÿ≥ÿ®Ÿàÿπ Ÿàÿßÿ≠ÿØ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ.",
                    deleteWeekConfirm: "‚ö†Ô∏è ÿ™ÿ≠ÿ∞Ÿäÿ±: ÿ£ŸÜÿ™ ÿπŸÑŸâ Ÿàÿ¥ŸÉ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ {week} ŸÜŸáÿßÿ¶ŸäÿßŸã!\n\nÿ≥Ÿäÿ§ÿØŸä ÿ∞ŸÑŸÉ ÿ•ŸÑŸâ ÿ≠ÿ∞ŸÅ {count} ŸÑÿßÿπÿ®ÿßŸã ŸÖŸÜ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ {week}.\n\nÿßŸÉÿ™ÿ® \"DELETE\" ŸÑŸÑÿ™ÿ£ŸÉŸäÿØ:",
                    deleteCancelled: "ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≠ÿ∞ŸÅ",
                    weekDeleted: "‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ {week}",
                    deleteWeekError: "‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ: {error}",
                    refreshSuccess: "‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™! ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {count} ÿ£ÿ≥ÿßÿ®Ÿäÿπ ŸÖŸÜ Firebase.",
                    refreshError: "‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™: {error}",
                    uploadSuccessDetail: "‚úÖ ÿ™ŸÖ ÿ±ŸÅÿπ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ {week} ÿ®ŸÜÿ¨ÿßÿ≠ ÿ•ŸÑŸâ Firebase!\nÿ™ŸÖ ÿ±ŸÅÿπ {count} ŸÑÿßÿπÿ®ÿßŸã.",
                    uploadError: "‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ±ŸÅÿπ CSV: {error}\n\nÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ≠ÿØÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ (F12) ŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ.",
                    invalidCsv: "‚ùå ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ®ŸäÿßŸÜÿßÿ™ ÿµÿßŸÑÿ≠ÿ© ŸÅŸä CSV. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ.\n\nÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸÖÿ™ŸàŸÇÿπ:\nRank,Player Name,Points\n1,Name,\"1,000,000\"",
                    fileReadError: "‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÖŸÑŸÅ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.",
                    pdfExportPlaceholder: "üìÑ ŸÖŸäÿ≤ÿ© ÿ™ÿµÿØŸäÿ± PDF - ÿ≥Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ jsPDF ŸÑÿ•ŸÜÿ¥ÿßÿ° ÿ™ŸÇÿ±Ÿäÿ± PDF ŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ ÿßŸÑÿ≠ÿßŸÑŸä",
                    signOutConfirm: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ {email}ÿü",
                    signOutSuccess: "‚úÖ ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠",
                    signedInAs: "ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ÿßÿ≥ŸÖ {email}",
                    uploadHint: "ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ÿßÿ≥ŸÖ {email} - ÿßÿ∂ÿ∫ÿ∑ ŸÑŸÑÿ±ŸÅÿπ",
                    signInHint: "ÿ≥ÿ¨ŸëŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™",
                    noData: "ŸÑŸÖ Ÿäÿ™ŸÖ ÿ±ŸÅÿπ ÿ£Ÿä ÿ®ŸäÿßŸÜÿßÿ™ ÿ®ÿπÿØ",
                    uploadFirst: "Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ Ÿàÿ±ŸÅÿπ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ 1 ŸÑŸÑÿ®ÿØÿ°",
                    loadingFirebaseTitle: "ÿ¨ÿßÿ±Ÿç ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÜ Firebase...",
                    loadingFirebaseSub: "ÿ¨ÿßÿ±Ÿç ÿ¨ŸÑÿ® ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿ≠ÿßŸÑŸÅ...",
                    refreshing: "‚è≥ ÿ¨ÿßÿ±Ÿç ÿßŸÑÿ™ÿ≠ÿØŸäÿ´...",
                    resetConfirm: "‚ö†Ô∏è ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ®ÿßÿ±ÿ≤ÿ© ŸÜŸáÿßÿ¶ŸäÿßŸã ŸÖŸÜ Firebase.\n\nÿßŸÉÿ™ÿ® \"RESET\" ŸÑŸÑÿ™ÿ£ŸÉŸäÿØ:",
                    resetSuccess: "‚úÖ ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ∂ÿ®ÿ∑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ®ÿßÿ±ÿ≤ÿ©",
                    resetCancelled: "ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∂ÿ®ÿ∑",
                    resetError: "‚ùå ŸÅÿ¥ŸÑ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∂ÿ®ÿ∑: {error}"
                },
                week: "ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ"
            }
        };
        
        let currentLanguage = localStorage.getItem('dashboardLanguage') || 'en';
        let currentTheme = localStorage.getItem('dashboardTheme');
        if (!currentTheme) {
            currentTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }
        
        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('dashboardLanguage', lang);
            
            // Update HTML direction
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.documentElement.lang = lang;
            document.title = t('global.pageTitle');
            
            // Update language toggle button
            const toggleBtn = document.getElementById('languageToggle');
            if (toggleBtn) {
                toggleBtn.textContent = lang === 'en' ? 'üåê ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' : 'üåê English';
            }
            
            // Translate all elements with data-i18n
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                const keys = key.split('.');
                let translation = translations[lang];
                
                for (const k of keys) {
                    translation = translation[k];
                    if (!translation) break;
                }
                
                if (translation) {
                    // Special handling for labels with child inputs (like upload button)
                    if (element.tagName === 'LABEL' && element.querySelector('input')) {
                        // Only update the text node, preserve child elements
                        const textNode = Array.from(element.childNodes).find(node => node.nodeType === 3);
                        if (textNode) {
                            textNode.textContent = translation;
                        }
                    } else {
                        element.textContent = translation;
                    }
                }
            });

            // Translate placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                const keys = key.split('.');
                let translation = translations[lang];

                for (const k of keys) {
                    translation = translation[k];
                    if (!translation) break;
                }

                if (translation) {
                    element.placeholder = translation;
                }
            });
            
            // Re-apply auth-specific labels/visibility after translations
            updateAuthUI();
            
            // Update dynamic content only if data is loaded
            if (Object.keys(weeklyData).length > 0) {
                updateWeekButtons();
                updateDashboard();
            }

            if (donationData.length > 0 || Object.keys(donationWeeksData).length > 0) {
                updateDonationWeekButtons();
                renderDonationTable(getCurrentDonationRows());
            }

            // Update donation label when language changes (text only)
            const donationLabel = document.getElementById('donationUploadLabel');
            if (donationLabel) {
                const textNode = Array.from(donationLabel.childNodes).find(node => node.nodeType === 3);
                if (textNode) {
                    textNode.textContent = t('buttons.uploadDonation');
                }
            }

            updateThemeToggle();
        }
        
        function t(key, replacements = {}) {
            const keys = key.split('.');
            let translation = translations[currentLanguage];
            
            for (const k of keys) {
                translation = translation[k];
                if (!translation) return key;
            }
            
            // Replace placeholders
            if (typeof translation === 'string') {
                for (const [placeholder, value] of Object.entries(replacements)) {
                    translation = translation.replace(`{${placeholder}}`, value);
                }
            }
            
            return translation;
        }

        function getThemeValue(varName, fallback) {
            const value = getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
            return value || fallback;
        }

        function getChartTheme() {
            return {
                text: getThemeValue('--chart-text', '#6f655b'),
                grid: getThemeValue('--chart-grid', 'rgba(43, 36, 30, 0.12)')
            };
        }

        function updateThemeToggle() {
            const themeBtn = document.getElementById('themeToggle');
            if (!themeBtn) return;
            const nextTheme = currentTheme === 'dark' ? 'light' : 'dark';
            themeBtn.textContent = nextTheme === 'dark' ? t('theme.dark') : t('theme.light');
            themeBtn.setAttribute('aria-pressed', currentTheme === 'dark' ? 'true' : 'false');
        }

        function refreshChartsForTheme() {
            if (Object.keys(weeklyData).length > 0) {
                renderCharts();
                if (currentProfilePlayer) {
                    openPlayerProfile(currentProfilePlayer);
                }
            }

            const donationRows = getCurrentDonationRows();
            if (donationRows && donationRows.length) {
                renderDonationCharts(donationRows);
                if (currentDonationProfile) {
                    openDonationProfile(currentDonationProfile);
                }
            }
        }

        function setTheme(theme) {
            currentTheme = theme;
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('dashboardTheme', theme);
            updateThemeToggle();
            refreshChartsForTheme();
        }
        
        // Language toggle button handler
        document.getElementById('languageToggle')?.addEventListener('click', () => {
            setLanguage(currentLanguage === 'en' ? 'ar' : 'en');
        });

        document.getElementById('themeToggle')?.addEventListener('click', () => {
            setTheme(currentTheme === 'dark' ? 'light' : 'dark');
        });
        
        // Initialize language direction and translations (but not dashboard update)
        document.documentElement.dir = currentLanguage === 'ar' ? 'rtl' : 'ltr';
        document.documentElement.lang = currentLanguage;
        document.documentElement.setAttribute('data-theme', currentTheme);
        
        const toggleBtn = document.getElementById('languageToggle');
        if (toggleBtn) {
            toggleBtn.textContent = currentLanguage === 'en' ? 'üåê ÿßŸÑÿπÿ±ÿ®Ÿäÿ©' : 'üåê English';
        }

        updateThemeToggle();
        
        // ============================================
        // FIREBASE FUNCTIONS
        // ============================================
        
        // Load week data from Firebase
        async function loadWeekFromFirebase(weekNum) {
            try {
                const snapshot = await database.ref(`weeks/${weekNum}`).once('value');
                const data = snapshot.val();
                
                if (!data) {
                    console.log(`Week ${weekNum} not found in Firebase`);
                    return null;
                }
                
                // Convert Firebase object to array
                const players = Object.values(data).map(player => ({
                    Rank: player.rank,
                    'Player Name': player.playerName,
                    Points: player.points
                }));
                
                weeklyData[weekNum] = players;
                console.log(`‚úÖ Loaded Week ${weekNum} from Firebase (${players.length} players)`);
                return players;
            } catch (error) {
                console.error(`Error loading week ${weekNum}:`, error);
                return null;
            }
        }
        
        // Load all available weeks
        async function loadAllWeeksFromFirebase() {
            try {
                const metaSnapshot = await database.ref('metadata').once('value');
                const metadata = metaSnapshot.val();
                
                const totalWeeks = metadata?.totalWeeks || 0;
                
                if (totalWeeks === 0) {
                    console.log('No weeks found in Firebase');
                    return 0;
                }
                
                // Load all weeks
                for (let i = 1; i <= totalWeeks; i++) {
                    await loadWeekFromFirebase(i);
                }
                
                console.log(`‚úÖ Loaded ${totalWeeks} weeks from Firebase`);
                return totalWeeks;
            } catch (error) {
                console.error('Error loading weeks from Firebase:', error);
                return 0;
            }
        }
        
        // Save week data to Firebase
        async function saveWeekToFirebase(weekNum, csvData) {
            try {
                if (!auth.currentUser) {
                    throw new Error('You must be signed in to upload data');
                }
                
                const players = parseCSV(csvData);
                if (!players || players.length === 0) {
                    throw new Error('Invalid CSV data');
                }
                
                console.log(`Uploading Week ${weekNum} to Firebase (${players.length} players)...`);
                
                // Convert to Firebase format
                const firebaseData = players.map(p => ({
                    rank: p.Rank,
                    playerName: p['Player Name'],
                    points: p.Points
                }));
                
                // Save to Firebase
                await database.ref(`weeks/${weekNum}`).set(firebaseData);
                
                // Update metadata
                const metaSnapshot = await database.ref('metadata').once('value');
                const currentMeta = metaSnapshot.val() || {};
                
                await database.ref('metadata').set({
                    totalWeeks: Math.max(currentMeta.totalWeeks || 0, weekNum),
                    latestWeek: weekNum,
                    lastUpdated: new Date().toISOString(),
                    uploadedBy: auth.currentUser.email
                });
                
                // Reload data locally
                await loadWeekFromFirebase(weekNum);
                
                console.log(`‚úÖ Week ${weekNum} uploaded successfully`);
                return true;
            } catch (error) {
                console.error('Error saving to Firebase:', error);
                throw error;
            }
        }

        // Donation Firebase functions
        async function loadDonationWeekFromFirebase(weekNum) {
            try {
                const snapshot = await database.ref(`donations/weeks/${weekNum}`).once('value');
                const data = snapshot.val();
                if (!data) return null;

                const rows = Object.values(data).map(entry => ({
                    Rank: entry.rank,
                    Commander: entry.commanderName,
                    Points: entry.points
                }));
                donationWeeksData[weekNum] = rows;
                return rows;
            } catch (error) {
                console.error(`Error loading donation week ${weekNum}:`, error);
                return null;
            }
        }

        async function loadAllDonationWeeksFromFirebase() {
            try {
                const metaSnapshot = await database.ref('donations/metadata').once('value');
                const metadata = metaSnapshot.val();
                const totalWeeks = metadata?.totalWeeks || 0;
                if (!totalWeeks) return 0;

                for (let i = 1; i <= totalWeeks; i++) {
                    await loadDonationWeekFromFirebase(i);
                }

                currentDonationWeek = metadata.latestWeek || totalWeeks;
                return totalWeeks;
            } catch (error) {
                console.error('Error loading donation weeks:', error);
                return 0;
            }
        }

        async function saveDonationWeekToFirebase(weekNum, csvData) {
            try {
                if (!auth.currentUser) {
                    throw new Error('You must be signed in to upload donations');
                }

                const rows = parseDonationCSV(csvData);
                if (!rows.length) {
                    throw new Error('No valid donation data');
                }

                const firebaseData = rows.map(row => ({
                    rank: row.Rank,
                    commanderName: row['Commander Name'] || row.Commander || row['Player Name'],
                    points: row.Points
                }));

                await database.ref(`donations/weeks/${weekNum}`).set(firebaseData);

                const metaSnapshot = await database.ref('donations/metadata').once('value');
                const currentMeta = metaSnapshot.val() || {};
                await database.ref('donations/metadata').set({
                    totalWeeks: Math.max(currentMeta.totalWeeks || 0, weekNum),
                    latestWeek: weekNum,
                    lastUpdated: new Date().toISOString(),
                    uploadedBy: auth.currentUser.email
                });

                await loadDonationWeekFromFirebase(weekNum);
                return true;
            } catch (error) {
                console.error('Error saving donation week:', error);
                throw error;
            }
        }
        
        // Authentication functions
        async function signInToFirebase(email, password) {
            try {
                await auth.signInWithEmailAndPassword(email, password);
                console.log('‚úÖ Signed in successfully');
                return true;
            } catch (error) {
                console.error('Sign in error:', error);
                throw error;
            }
        }
        
        function signOutFromFirebase() {
            auth.signOut();
            console.log('‚úÖ Signed out');
        }

        // Auth modal helpers
        function openAuthModal() {
            const savedEmail = localStorage.getItem('authRememberEmail') || '';
            document.getElementById('authEmail').value = savedEmail;
            document.getElementById('authPassword').value = '';
            document.getElementById('authStatus').textContent = '';
            document.getElementById('authSubmitBtn').disabled = false;
            const rememberCheckbox = document.getElementById('authRememberMe');
            if (rememberCheckbox) {
                rememberCheckbox.checked = !!savedEmail;
            }
            document.getElementById('authModal').style.display = 'block';
            document.getElementById('authEmail').focus();
        }

        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
        }

        async function handleAuthSubmit(event) {
            event?.preventDefault();
            const email = document.getElementById('authEmail').value.trim();
            const password = document.getElementById('authPassword').value;
            const statusDiv = document.getElementById('authStatus');
            const submitBtn = document.getElementById('authSubmitBtn');
            const remember = document.getElementById('authRememberMe')?.checked;

            if (!email || !password) {
                statusDiv.textContent = t('auth.required');
                return;
            }

            try {
                statusDiv.textContent = t('auth.signingIn');
                submitBtn.disabled = true;
                await signInToFirebase(email, password);
                if (remember) {
                    localStorage.setItem('authRememberEmail', email);
                } else {
                    localStorage.removeItem('authRememberEmail');
                }
                statusDiv.textContent = t('auth.signedIn');
                setTimeout(() => closeAuthModal(), 500);
            } catch (error) {
                console.error('Auth modal sign-in error:', error);
                statusDiv.textContent = t('messages.errorDetail', { error: error.message });
            } finally {
                submitBtn.disabled = false;
            }
        }
        
        // Show loading state
        function showFirebaseLoading() {
            const kpiGrid = document.getElementById('kpiGrid');
            if (kpiGrid) {
                kpiGrid.innerHTML = `
                    <div class="kpi-card" style="grid-column: 1 / -1;">
                        <div class="kpi-label">üî• ${t('messages.loadingFirebaseTitle')}</div>
                        <div class="kpi-value">‚è≥</div>
                        <div class="kpi-subtext">${t('messages.loadingFirebaseSub')}</div>
                    </div>
                `;
            }
        }
        
        // ============================================
        // === DATA MANAGEMENT ===
        let weeklyData = {};
        let currentWeek = 1;
        let currentDuelView = 'week';
        let chartInstances = {};
        let currentProfilePlayer = null;
        let currentDonationProfile = null;
        let playerHistory = {}; // Track each player across weeks
        let donationData = [];
        let donationWeeksData = {};
        let currentDonationWeek = 1;
        let currentDonationView = 'all';
        let guidesData = [];

        // === UTILITY FUNCTIONS ===
        function parseCSV(csv) {
            // Normalize line endings (handle \r\n, \r, and \n)
            const normalizedCSV = csv.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
            const lines = normalizedCSV.trim().split('\n');
            console.log('parseCSV: Total lines:', lines.length);
            
            if (lines.length === 0) return [];
            
            // Get headers from first line
            const headerLine = lines[0];
            const headers = parseCSVLine(headerLine).map(h => h.trim());
            console.log('parseCSV: Headers:', headers);
            
            // Parse data rows
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue; // Skip empty lines
                
                const values = parseCSVLine(lines[i]);
                const obj = {};
                
                headers.forEach((header, index) => {
                    let value = (values[index] || '').trim();
                    
                    // Handle Points column - remove commas and convert to number
                    if (header === 'Points') {
                        obj[header] = parseInt(value.replace(/,/g, '')) || 0;
                    } 
                    // Handle Rank column - convert to number
                    else if (header === 'Rank') {
                        obj[header] = parseInt(value) || 0;
                    } 
                    // All other columns - keep as string
                    else {
                        obj[header] = value;
                    }
                });
                
                // Only add if we have valid data
                if (obj['Player Name'] && obj.Rank && obj.Points) {
                    data.push(obj);
                } else {
                    console.log('parseCSV: Skipping invalid row:', obj);
                }
            }
            
            console.log('parseCSV: Parsed', data.length, 'valid rows');
            return data;
        }

        function parseDonationCSV(csv) {
            const normalizedCSV = csv.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
            const lines = normalizedCSV.trim().split('\n');
            if (lines.length === 0) return [];

            const headerLine = lines[0];
            const headers = parseCSVLine(headerLine).map(h => h.trim());
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                const values = parseCSVLine(lines[i]);
                const obj = {};

                headers.forEach((header, index) => {
                    let value = (values[index] || '').trim();
                    if (header === 'Points') {
                        obj[header] = parseInt(value.replace(/,/g, '')) || 0;
                    } else if (header === 'Rank') {
                        obj[header] = parseInt(value) || 0;
                    } else {
                        obj[header] = value;
                    }
                });

                const commander = obj['Commander Name'] || obj['Commander'] || obj['Player Name'];
                if (commander && obj.Rank && obj.Points >= 0) {
                    obj['Commander Name'] = commander;
                    data.push(obj);
                }
            }

            return data;
        }

        // Helper function to parse a single CSV line
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        // Handle escaped quotes
                        current += '"';
                        i++; // Skip next quote
                    } else {
                        // Toggle quote state
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    // Found field separator
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            // Add last field
            result.push(current);
            
            return result;
        }

        function getCurrentPlayers() {
            return weeklyData[currentWeek] || [];
        }

        function getCurrentDuelRows() {
            if (currentDuelView === 'all') {
                return buildDuelCumulativeRows();
            }
            return getCurrentPlayers();
        }

        function buildDuelCumulativeRows() {
            const weeks = Object.keys(weeklyData).map(Number).sort((a, b) => a - b);
            if (!weeks.length) return [];

            const map = {};
            weeks.forEach(week => {
                const rows = weeklyData[week] || [];
                rows.forEach(row => {
                    const key = row['Player Name'];
                    if (!map[key]) {
                        map[key] = { 'Player Name': key, TotalPoints: 0, WeekPoints: {} };
                    }
                    map[key].WeekPoints[week] = row.Points || 0;
                    map[key].TotalPoints += row.Points || 0;
                });
            });

            const combined = Object.values(map).sort((a, b) => b.TotalPoints - a.TotalPoints);
            return combined.map((row, index) => ({
                Rank: index + 1,
                'Player Name': row['Player Name'],
                Points: row.TotalPoints,
                WeekPoints: row.WeekPoints
            }));
        }

        function getDonationWeeksList() {
            return Object.keys(donationWeeksData).map(Number).sort((a, b) => a - b);
        }

        async function loadGuidesFromFirebase() {
            const grid = document.getElementById('guidesGrid');
            if (grid) {
                grid.innerHTML = `<div class="kpi-subtext" style="grid-column: 1 / -1; text-align: center;">${t('guides.messages.loading')}</div>`;
            }
            try {
                const snapshot = await database.ref('guides').once('value');
                const data = snapshot.val() || {};
                const entries = Object.values(data);
                guidesData = entries
                    .map(entry => ({
                        title: entry.title || '',
                        imageUrl: entry.imageUrl || '',
                        createdAt: entry.createdAt || ''
                    }))
                    .filter(entry => entry.title && entry.imageUrl);

            guidesData.sort((a, b) => (a.createdAt || '').localeCompare(b.createdAt || ''));
                renderGuides();
            } catch (error) {
                console.error('Error loading guides:', error);
                if (grid) {
                    grid.innerHTML = `<div class="kpi-subtext" style="grid-column: 1 / -1; text-align: center;">${t('guides.messages.loadError', { error: error.message })}</div>`;
                }
            }
        }

        function renderGuides() {
            const grid = document.getElementById('guidesGrid');
            if (!grid) return;

            if (!guidesData.length) {
                grid.innerHTML = `<div class="kpi-subtext" style="grid-column: 1 / -1; text-align: center;">${t('guides.messages.empty')}</div>`;
                return;
            }

            grid.innerHTML = guidesData.map(entry => `
                <button class="guide-card" data-full="${entry.imageUrl}" data-title="${entry.title}">
                    <img src="${entry.imageUrl}" alt="${entry.title}">
                    <div class="guide-card-title">${entry.title}</div>
                </button>
            `).join('');

            grid.querySelectorAll('.guide-card').forEach(card => {
                card.addEventListener('click', () => {
                    const fullSrc = card.getAttribute('data-full');
                    const title = card.getAttribute('data-title');
                    const preview = document.getElementById('guidePreviewImage');
                    if (preview && fullSrc) {
                        preview.src = fullSrc;
                        preview.alt = title || 'Guide preview';
                        document.getElementById('guidePreviewModal').style.display = 'block';
                    }
                });
            });
        }

        function showAddGuideModal() {
            if (!auth.currentUser) {
                alert(t('guides.messages.signInRequired'));
                return;
            }
            document.getElementById('guideTitleInput').value = '';
            document.getElementById('guideImageInput').value = '';
            document.getElementById('guideFormStatus').textContent = '';
            document.getElementById('addGuideModal').style.display = 'block';
        }

        async function saveGuide() {
            const statusDiv = document.getElementById('guideFormStatus');
            try {
                const title = document.getElementById('guideTitleInput').value.trim();
                const imageUrl = document.getElementById('guideImageInput').value.trim();
                if (!title || !imageUrl) {
                    statusDiv.textContent = t('guides.messages.required');
                    return;
                }

                statusDiv.textContent = t('guides.messages.saving');
                const newRef = database.ref('guides').push();
                await newRef.set({
                    title,
                    imageUrl,
                    createdAt: new Date().toISOString(),
                    createdBy: auth.currentUser?.email || ''
                });

                statusDiv.textContent = t('guides.messages.saved');
                await loadGuidesFromFirebase();
                setTimeout(() => {
                    document.getElementById('addGuideModal').style.display = 'none';
                }, 1200);
            } catch (error) {
                console.error('Error saving guide:', error);
                statusDiv.textContent = t('guides.messages.error', { error: error.message });
            }
        }

        function getCurrentDonationRows() {
            if (currentDonationView === 'all') {
                return buildDonationCumulativeRows();
            }
            const stored = donationWeeksData[currentDonationWeek];
            if (stored && stored.length) return stored;
            return donationData || [];
        }

        function buildDonationCumulativeRows() {
            const weeks = getDonationWeeksList();
            if (!weeks.length) return donationData || [];

            const map = {};
            weeks.forEach(week => {
                const rows = donationWeeksData[week] || [];
                rows.forEach(row => {
                    const key = row.Commander;
                    if (!map[key]) {
                        map[key] = { Commander: key, TotalPoints: 0, WeekPoints: {} };
                    }
                    map[key].WeekPoints[week] = row.Points || 0;
                    map[key].TotalPoints += row.Points || 0;
                });
            });

            const combined = Object.values(map).sort((a, b) => b.TotalPoints - a.TotalPoints);
            return combined.map((row, index) => ({
                Rank: index + 1,
                Commander: row.Commander,
                Points: row.TotalPoints,
                WeekPoints: row.WeekPoints
            }));
        }

        function destroyChart(chartId) {
            if (chartInstances[chartId]) {
                chartInstances[chartId].destroy();
                delete chartInstances[chartId];
            }
        }

        function getDivision(points) {
            if (points > 100000000) return t('divisions.eliteShort');
            if (points >= 50000000) return t('divisions.masterShort');
            return t('divisions.warriorShort');
        }

        function getAchievements(player, week) {
            const achievements = [];
            const rank = player.Rank;
            const points = player.Points;
            
            if (rank === 1) achievements.push(t('achievements.champion'));
            if (rank <= 3) achievements.push(t('achievements.top3'));
            if (rank <= 10) achievements.push(t('achievements.top10'));
            if (points > 100000000) achievements.push(t('achievements.hundredM'));
            if (points > 200000000) achievements.push(t('achievements.twoHundredM'));
            
            return achievements;
        }

        function calculateMovement(playerName) {
            const weeks = Object.keys(weeklyData).sort((a, b) => a - b);
            if (weeks.length < 2 || currentWeek == 1) return { change: 0, type: 'same' };
            
            const currentIndex = weeks.indexOf(currentWeek.toString());
            if (currentIndex === 0) return { change: 0, type: 'same' };
            
            const prevWeek = weeks[currentIndex - 1];
            const currentData = weeklyData[currentWeek].find(p => p['Player Name'] === playerName);
            const prevData = weeklyData[prevWeek].find(p => p['Player Name'] === playerName);
            
            if (!currentData || !prevData) return { change: 0, type: 'same' };
            
            const change = prevData.Rank - currentData.Rank;
            const type = change > 0 ? 'up' : change < 0 ? 'down' : 'same';
            
            return { change: Math.abs(change), type };
        }

        // === RENDERING FUNCTIONS ===
        function renderKPIs() {
            const players = getCurrentDuelRows();
            if (!players.length) return;
            
            const totalPlayers = players.length;
            const totalPoints = players.reduce((sum, p) => sum + p.Points, 0);
            const avgScore = Math.round(totalPoints / totalPlayers);
            const highestScore = Math.max(...players.map(p => p.Points));
            const lowestScore = Math.min(...players.map(p => p.Points));
            const champion = players.find(p => p.Points === highestScore);
            
            document.getElementById('kpiGrid').innerHTML = `
                <div class="kpi-card">
                    <div class="kpi-label">${t('kpi.totalPlayers')}</div>
                    <div class="kpi-value">${totalPlayers}</div>
                    <div class="kpi-subtext">${t('kpi.totalPlayersSub')}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">${t('kpi.avgScore')}</div>
                    <div class="kpi-value">${avgScore.toLocaleString()}</div>
                    <div class="kpi-subtext">${t('kpi.avgScoreSub')}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">${t('kpi.champion')}</div>
                    <div class="kpi-value">${highestScore.toLocaleString()}</div>
                    <div class="kpi-subtext">${champion['Player Name']}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">${t('kpi.lowestScore')}</div>
                    <div class="kpi-value">${lowestScore.toLocaleString()}</div>
                    <div class="kpi-subtext">${t('kpi.lowestScoreSub')}</div>
                </div>
            `;
        }

        function renderMovementHighlights() {
            const weeks = Object.keys(weeklyData).sort((a, b) => a - b);
            if (weeks.length < 2 || currentWeek == 1) {
                document.getElementById('movementSection').style.display = 'none';
                return;
            }
            
            document.getElementById('movementSection').style.display = 'block';
            
            const currentIndex = weeks.indexOf(currentWeek.toString());
            const prevWeek = weeks[currentIndex - 1];
            const currentData = weeklyData[currentWeek];
            const prevData = weeklyData[prevWeek];
            
            // Calculate movements
            const movements = currentData.map(p => {
                const prev = prevData.find(pp => pp['Player Name'] === p['Player Name']);
                if (!prev) return null;
                return {
                    name: p['Player Name'],
                    rankChange: prev.Rank - p.Rank,
                    pointsGain: p.Points - prev.Points
                };
            }).filter(m => m !== null);
            
            const biggestClimber = movements.reduce((max, m) => m.rankChange > max.rankChange ? m : max, movements[0]);
            const biggestFaller = movements.reduce((min, m) => m.rankChange < min.rankChange ? m : min, movements[0]);
            const mvp = movements.reduce((max, m) => m.pointsGain > max.pointsGain ? m : max, movements[0]);
            
            document.getElementById('biggestClimber').textContent = biggestClimber?.name || '-';
            document.getElementById('climberStats').textContent = t('movement.climbStat', { count: biggestClimber?.rankChange || 0 });
            
            document.getElementById('biggestFaller').textContent = biggestFaller?.name || '-';
            document.getElementById('fallerStats').textContent = t('movement.fallStat', { count: Math.abs(biggestFaller?.rankChange || 0) });
            
            document.getElementById('weeklyMvp').textContent = mvp?.name || '-';
            document.getElementById('mvpStats').textContent = t('movement.mvpStat', { count: (mvp?.pointsGain || 0).toLocaleString() });
            
            // Top streak (simplified - player in top 10 for longest)
            document.getElementById('topStreak').textContent = currentData[0]['Player Name'];
            document.getElementById('streakStats').textContent = t('movement.streakStat', { count: weeks.length });
        }

        function renderCharts() {
            const players = getCurrentDuelRows();
            if (!players.length) return;

            const chartTheme = getChartTheme();
            
            // Top 10 Bar Chart
            const top10 = players.slice(0, 10);
            const barCtx = document.getElementById('barChart').getContext('2d');
            destroyChart('barChart');
            chartInstances['barChart'] = new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: top10.map(p => p['Player Name']),
                    datasets: [{
                        label: t('table.points'),
                        data: top10.map(p => p.Points),
                        backgroundColor: 'rgba(212, 106, 45, 0.8)',
                        borderColor: 'rgba(212, 106, 45, 1)',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                                grid: { color: chartTheme.grid },
                            ticks: {
                                color: chartTheme.text,
                                callback: v => (v / 1000000).toFixed(0) + 'M'
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: chartTheme.text, maxRotation: 45 }
                        }
                    }
                }
            });
            
            // Pie Chart
            const tiers = {
                [t('divisions.eliteTier')]: players.filter(p => p.Points > 100000000).length,
                [t('divisions.masterTier')]: players.filter(p => p.Points >= 50000000 && p.Points <= 100000000).length,
                [t('divisions.warriorTier')]: players.filter(p => p.Points < 50000000).length
            };
            const pieCtx = document.getElementById('pieChart').getContext('2d');
            destroyChart('pieChart');
            chartInstances['pieChart'] = new Chart(pieCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(tiers),
                    datasets: [{
                        data: Object.values(tiers),
                        backgroundColor: ['rgba(242, 192, 83, 0.85)', 'rgba(31, 138, 131, 0.8)', 'rgba(227, 154, 107, 0.8)'],
                        borderColor: ['rgba(242, 192, 83, 1)', 'rgba(31, 138, 131, 1)', 'rgba(227, 154, 107, 1)'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: chartTheme.text, font: { size: 14 }, padding: 20 }
                        }
                    }
                }
            });
            
            // Top 20 Performance
            const top20 = players.slice(0, 20);
            const topPerfCtx = document.getElementById('topPerformanceChart').getContext('2d');
            destroyChart('topPerformanceChart');
            chartInstances['topPerformanceChart'] = new Chart(topPerfCtx, {
                type: 'line',
                data: {
                    labels: top20.map(p => p['Player Name']),
                    datasets: [{
                        label: t('table.points'),
                        data: top20.map(p => p.Points),
                        borderColor: 'rgba(31, 138, 131, 1)',
                        backgroundColor: 'rgba(31, 138, 131, 0.2)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                                grid: { color: chartTheme.grid },
                            ticks: {
                                color: chartTheme.text,
                                callback: v => (v / 1000000).toFixed(0) + 'M'
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: chartTheme.text, maxRotation: 45 }
                        }
                    }
                }
            });
            
            // Bottom 20 Performance
            const bottom20 = players.slice(-20).reverse();
            const bottomPerfCtx = document.getElementById('bottomPerformanceChart').getContext('2d');
            destroyChart('bottomPerformanceChart');
            chartInstances['bottomPerformanceChart'] = new Chart(bottomPerfCtx, {
                type: 'line',
                data: {
                    labels: bottom20.map(p => p['Player Name']),
                    datasets: [{
                        label: t('table.points'),
                        data: bottom20.map(p => p.Points),
                        borderColor: 'rgba(224, 108, 95, 1)',
                        backgroundColor: 'rgba(224, 108, 95, 0.2)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                                grid: { color: chartTheme.grid },
                            ticks: {
                                color: chartTheme.text,
                                callback: v => (v / 1000000).toFixed(0) + 'M'
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: chartTheme.text, maxRotation: 45 }
                        }
                    }
                }
            });
        }

        function renderDivisions() {
            const players = getCurrentDuelRows();
            const elite = players.filter(p => p.Points > 100000000);
            const master = players.filter(p => p.Points >= 50000000 && p.Points <= 100000000);
            const warrior = players.filter(p => p.Points < 50000000);
            
            document.getElementById('eliteDivisionCount').textContent = t('divisions.playersCount', { count: elite.length });
            document.getElementById('eliteDivisionPlayers').innerHTML = elite.slice(0, 5).map(p => p['Player Name']).join(', ') + (elite.length > 5 ? '...' : '');
            
            document.getElementById('masterDivisionCount').textContent = t('divisions.playersCount', { count: master.length });
            document.getElementById('masterDivisionPlayers').innerHTML = master.slice(0, 5).map(p => p['Player Name']).join(', ') + (master.length > 5 ? '...' : '');
            
            document.getElementById('warriorDivisionCount').textContent = t('divisions.playersCount', { count: warrior.length });
            document.getElementById('warriorDivisionPlayers').innerHTML = warrior.slice(0, 5).map(p => p['Player Name']).join(', ') + (warrior.length > 5 ? '...' : '');
        }

        function renderTable(data = null) {
            const players = data || getCurrentDuelRows();
            const tbody = document.getElementById('tableBody');
            const thead = document.getElementById('duelTableHead');
            const isAdmin = auth.currentUser !== null;
            const weeks = Object.keys(weeklyData).map(Number).sort((a, b) => a - b);
            const isCumulative = currentDuelView === 'all' && weeks.length > 0;

            if (thead) {
                if (isCumulative) {
                    thead.innerHTML = `
                        <tr>
                            <th>${t('table.rank')}</th>
                            <th>${t('table.playerName')}</th>
                            ${weeks.map(w => `<th>${t('week')} ${w}</th>`).join('')}
                            <th>${t('table.total')}</th>
                            <th>${t('table.achievements')}</th>
                            <th>${t('table.division')}</th>
                            <th>${t('table.actions')}</th>
                        </tr>
                    `;
                } else {
                    thead.innerHTML = `
                        <tr>
                            <th>${t('table.rank')}</th>
                            <th>${t('table.movement')}</th>
                            <th>${t('table.playerName')}</th>
                            <th>${t('table.points')}</th>
                            <th>${t('table.achievements')}</th>
                            <th>${t('table.division')}</th>
                            <th>${t('table.actions')}</th>
                        </tr>
                    `;
                }
            }

            tbody.innerHTML = players.map(player => {
                let rankClass = 'rank-default';
                if (player.Rank === 1) rankClass = 'rank-1';
                else if (player.Rank === 2) rankClass = 'rank-2';
                else if (player.Rank === 3) rankClass = 'rank-3';
                else if (player.Rank <= 10) rankClass = 'rank-top10';
                
                const movement = calculateMovement(player['Player Name']);
                const movementIcon = movement.type === 'up' ? '‚Üë' : movement.type === 'down' ? '‚Üì' : '‚îÄ';
                const movementText = movement.change > 0 ? `${movementIcon} ${movement.change}` : movementIcon;

                const achievements = getAchievements(player, currentWeek);
                const division = getDivision(player.Points);
                
                // Admin buttons (only show if signed in + weekly view)
                const adminButtons = isAdmin && !isCumulative ? `
                    <button class="view-profile-btn" onclick="editPlayer('${player['Player Name'].replace(/'/g, "\\'")}', ${player.Rank})" style="background: rgba(153, 204, 51, 0.4); border-color: #99cc33;">${t('buttons.edit')}</button>
                    <button class="view-profile-btn" onclick="deletePlayer('${player['Player Name'].replace(/'/g, "\\'")}', ${player.Rank})" style="background: rgba(204, 51, 0, 0.4); border-color: #cc3300;">${t('buttons.delete')}</button>
                ` : '';

                const actionCell = `
                    <button class="view-profile-btn" onclick="openPlayerProfile('${player['Player Name'].replace(/'/g, "\\'")}')">  ${t('buttons.view')}</button>
                    ${adminButtons}
                `;

                if (isCumulative) {
                    const weekCells = weeks.map(w => `<td>${(player.WeekPoints?.[w] || 0).toLocaleString()}</td>`).join('');
                    return `
                        <tr>
                            <td><span class="rank-badge ${rankClass}">#${player.Rank}</span></td>
                            <td>${player['Player Name']}</td>
                            ${weekCells}
                            <td>${player.Points.toLocaleString()}</td>
                            <td>${achievements.map(a => `<span class="achievement-badge">${a}</span>`).join('')}</td>
                            <td>${division}</td>
                            <td>${actionCell}</td>
                        </tr>
                    `;
                }

                return `
                    <tr>
                        <td><span class="rank-badge ${rankClass}">#${player.Rank}</span></td>
                        <td><span class="rank-movement ${movement.type}">${movementText}</span></td>
                        <td>${player['Player Name']}</td>
                        <td>${player.Points.toLocaleString()}</td>
                        <td>${achievements.map(a => `<span class="achievement-badge">${a}</span>`).join('')}</td>
                        <td>${division}</td>
                        <td>${actionCell}</td>
                    </tr>
                `;
            }).join('');
        }

        function updateWeekButtons() {
            const weeks = Object.keys(weeklyData).sort((a, b) => a - b);
            const weekSelector = document.getElementById('weekSelector');
            if (!weekSelector) return;

            if (!weeks.length) {
                weekSelector.innerHTML = '';
                return;
            }

            const allActive = currentDuelView === 'all';
            weekSelector.innerHTML = `
                <button class="week-btn ${allActive ? 'active' : ''}" onclick="selectDuelView('all')">${t('leaderboard.allWeeks')}</button>
                ${weeks.map(week =>
                    `<button class="week-btn ${!allActive && week == currentWeek ? 'active' : ''}" onclick="selectWeek(${week})">${t('week')} ${week}</button>`
                ).join('')}
            `;
        }

        function updateDashboard() {
            renderKPIs();
            renderMovementHighlights();
            renderCharts();
            renderDivisions();
            renderTable();
            const searchInput = document.getElementById('searchBar');
            if (searchInput) searchInput.value = '';
            const minPointsInput = document.getElementById('duelMinPoints');
            if (minPointsInput) minPointsInput.value = '';
            const divisionFilter = document.getElementById('duelDivisionFilter');
            if (divisionFilter) divisionFilter.value = '';
        }

        // === DONATION LEADERBOARD ===
        function renderDonationKPIs(rows = getCurrentDonationRows()) {
            const totalPlayersEl = document.getElementById('donationTotalPlayers');
            const topCommanderEl = document.getElementById('donationTopCommander');
            const topPointsEl = document.getElementById('donationTopPoints');
            const totalPointsEl = document.getElementById('donationTotalPoints');

            if (!totalPlayersEl || !topCommanderEl || !topPointsEl || !totalPointsEl) return;

            const top = rows[0];
            const totalPoints = rows.reduce((sum, p) => sum + (p.Points || 0), 0);

            totalPlayersEl.textContent = rows.length || '-';
            topCommanderEl.textContent = top ? top.Commander : '-';
            topPointsEl.textContent = top ? t('donation.kpi.pointsSuffix', { points: top.Points.toLocaleString() }) : '-';
            totalPointsEl.textContent = totalPoints ? totalPoints.toLocaleString() : '-';
        }

        function renderDonationTable(rows = getCurrentDonationRows()) {
            const tbody = document.getElementById('donationTableBody');
            const thead = document.getElementById('donationTableHead');
            if (!tbody || !thead) return;

            const safeRows = rows || [];
            const weeks = getDonationWeeksList();
            const isCumulative = currentDonationView === 'all' && weeks.length > 0;
            const isAdmin = auth.currentUser !== null;

            if (isCumulative) {
                thead.innerHTML = `
                    <tr>
                        <th>${t('table.rank')}</th>
                        <th>${t('table.commander')}</th>
                        ${weeks.map(w => `<th>${t('week')} ${w}</th>`).join('')}
                        <th>${t('table.total')}</th>
                        <th>${t('table.achievements')}</th>
                        <th>${t('table.actions')}</th>
                    </tr>
                `;
            } else {
                thead.innerHTML = `
                    <tr>
                        <th>${t('table.rank')}</th>
                        <th>${t('table.commander')}</th>
                        <th>${t('table.points')}</th>
                        <th>${t('table.achievements')}</th>
                        <th>${t('table.actions')}</th>
                    </tr>
                `;
            }

            tbody.innerHTML = safeRows.map(player => {
                const rankClass = player.Rank === 1 ? 'rank-1' : player.Rank === 2 ? 'rank-2' : player.Rank === 3 ? 'rank-3' : player.Rank <= 10 ? 'rank-top10' : 'rank-default';
                const achievements = getDonationAchievements(player);
                const points = (player.Points || 0);
                const adminButtons = isAdmin && !isCumulative ? `
                    <button class="view-profile-btn" onclick="editDonationEntry('${player.Commander.replace(/'/g, "\\'")}', ${player.Rank})" style="background: rgba(153, 204, 51, 0.4); border-color: #99cc33;">${t('buttons.edit')}</button>
                    <button class="view-profile-btn" onclick="deleteDonationEntry('${player.Commander.replace(/'/g, "\\'")}', ${player.Rank})" style="background: rgba(204, 51, 0, 0.4); border-color: #cc3300;">${t('buttons.delete')}</button>
                ` : '';
                const actions = `
                    <button class="view-profile-btn" onclick="openDonationProfile('${player.Commander.replace(/'/g, "\\'")}')">${t('buttons.view')}</button>
                    ${adminButtons}
                `;

                if (isCumulative) {
                    const weekCells = weeks.map(w => `<td>${(player.WeekPoints?.[w] || 0).toLocaleString()}</td>`).join('');
                    return `
                        <tr>
                            <td><span class="rank-badge ${rankClass}">#${player.Rank}</span></td>
                            <td>${player.Commander}</td>
                            ${weekCells}
                            <td>${points.toLocaleString()}</td>
                            <td>${achievements.map(a => `<span class="achievement-badge">${a}</span>`).join('')}</td>
                            <td>${actions}</td>
                        </tr>
                    `;
                }

                return `
                    <tr>
                        <td><span class="rank-badge ${rankClass}">#${player.Rank}</span></td>
                        <td>${player.Commander}</td>
                        <td>${points.toLocaleString()}</td>
                        <td>${achievements.map(a => `<span class="achievement-badge">${a}</span>`).join('')}</td>
                        <td>${actions}</td>
                    </tr>
                `;
            }).join('');

            renderDonationKPIs(safeRows);
            renderDonationCharts(safeRows);
            renderDonationDivisions(safeRows);
            renderDonationMovementHighlights();
        }

        function getDonationTier(points) {
            if (points >= 100000) return 'elite';
            if (points >= 50000) return 'master';
            return 'warrior';
        }

        function getDonationAchievements(player) {
            const badges = [];
            const points = player.Points || 0;
            const rank = player.Rank || 0;
            if (rank === 1) badges.push(t('donation.achievements.topDonor'));
            if (rank <= 3) badges.push(t('donation.achievements.top3'));
            if (rank <= 10) badges.push(t('donation.achievements.top10'));
            if (points >= 100000) badges.push(t('donation.achievements.club100k'));
            if (points >= 50000) badges.push(t('donation.achievements.club50k'));
            return badges;
        }

        function renderDonationDivisions(rows) {
            const elite = rows.filter(p => getDonationTier(p.Points) === 'elite');
            const master = rows.filter(p => getDonationTier(p.Points) === 'master');
            const warrior = rows.filter(p => getDonationTier(p.Points) === 'warrior');

            const eliteNames = elite.slice(0, 5).map(p => p.Commander).join(', ') || '-';
            const masterNames = master.slice(0, 5).map(p => p.Commander).join(', ') || '-';
            const warriorNames = warrior.slice(0, 5).map(p => p.Commander).join(', ') || '-';

            document.getElementById('donationEliteCount').textContent = t('donation.divisions.count', { count: elite.length });
            document.getElementById('donationElitePlayers').textContent = eliteNames + (elite.length > 5 ? '...' : '');
            document.getElementById('donationMasterCount').textContent = t('donation.divisions.count', { count: master.length });
            document.getElementById('donationMasterPlayers').textContent = masterNames + (master.length > 5 ? '...' : '');
            document.getElementById('donationWarriorCount').textContent = t('donation.divisions.count', { count: warrior.length });
            document.getElementById('donationWarriorPlayers').textContent = warriorNames + (warrior.length > 5 ? '...' : '');
        }

        function renderDonationMovementHighlights() {
            const weeks = getDonationWeeksList();
            if (weeks.length < 2) {
                document.getElementById('donationMovementSection').style.display = 'none';
                return;
            }

            document.getElementById('donationMovementSection').style.display = 'block';
            const currentIndex = weeks.indexOf(Number(currentDonationWeek));
            const currentWeek = currentIndex >= 0 ? weeks[currentIndex] : weeks[weeks.length - 1];
            const prevIndex = weeks.indexOf(currentWeek) - 1;
            if (prevIndex < 0) {
                document.getElementById('donationMovementSection').style.display = 'none';
                return;
            }
            const prevWeek = weeks[prevIndex];
            const currentData = donationWeeksData[currentWeek] || [];
            const prevData = donationWeeksData[prevWeek] || [];

            const movements = currentData.map(p => {
                const prev = prevData.find(pp => pp.Commander === p.Commander);
                if (!prev) return null;
                return {
                    name: p.Commander,
                    rankChange: prev.Rank - p.Rank,
                    pointsGain: (p.Points || 0) - (prev.Points || 0)
                };
            }).filter(Boolean);

            if (!movements.length) {
                document.getElementById('donationMovementSection').style.display = 'none';
                return;
            }

            const biggestClimber = movements.reduce((max, m) => m.rankChange > max.rankChange ? m : max, movements[0]);
            const biggestFaller = movements.reduce((min, m) => m.rankChange < min.rankChange ? m : min, movements[0]);
            const mvp = movements.reduce((max, m) => m.pointsGain > max.pointsGain ? m : max, movements[0]);

            document.getElementById('donationBiggestClimber').textContent = biggestClimber?.name || '-';
            document.getElementById('donationClimberStats').textContent = t('donation.movement.climbStat', { count: biggestClimber?.rankChange || 0 });
            document.getElementById('donationBiggestFaller').textContent = biggestFaller?.name || '-';
            document.getElementById('donationFallerStats').textContent = t('donation.movement.fallStat', { count: Math.abs(biggestFaller?.rankChange || 0) });
            document.getElementById('donationWeeklyMvp').textContent = mvp?.name || '-';
            document.getElementById('donationMvpStats').textContent = t('donation.movement.mvpStat', { count: (mvp?.pointsGain || 0).toLocaleString() });

            const streakResult = getDonationTopStreak(weeks);
            document.getElementById('donationTopStreak').textContent = streakResult.name || '-';
            document.getElementById('donationStreakStats').textContent = streakResult.count ? t('donation.movement.streakStat', { count: streakResult.count }) : '-';
        }

        function getDonationTopStreak(weeks) {
            const streaks = {};
            const maxStreaks = {};

            weeks.forEach(week => {
                const weekRows = donationWeeksData[week] || [];
                const topSet = new Set(weekRows.slice(0, 10).map(row => row.Commander));

                topSet.forEach(name => {
                    streaks[name] = (streaks[name] || 0) + 1;
                    maxStreaks[name] = Math.max(maxStreaks[name] || 0, streaks[name]);
                });

                Object.keys(streaks).forEach(name => {
                    if (!topSet.has(name)) {
                        streaks[name] = 0;
                    }
                });
            });

            const entries = Object.entries(maxStreaks).sort((a, b) => b[1] - a[1]);
            return entries.length ? { name: entries[0][0], count: entries[0][1] } : { name: '', count: 0 };
        }

        function openDonationProfile(commanderName) {
            const weeks = getDonationWeeksList();
            const currentRows = getCurrentDonationRows();
            const playerData = currentRows.find(p => p.Commander === commanderName);
            const points = playerData?.Points || 0;

            currentDonationProfile = commanderName;
            const chartTheme = getChartTheme();

            document.getElementById('donationModalName').textContent = `${t('donation.modal.title')} ‚Äî ${commanderName}`;
            document.getElementById('donationModalRank').textContent = playerData?.Rank ? `#${playerData.Rank}` : '-';
            document.getElementById('donationModalPoints').textContent = points.toLocaleString();
            const tier = getDonationTier(points);
            const tierLabel = tier === 'elite'
                ? t('donation.divisions.eliteShort')
                : tier === 'master'
                    ? t('donation.divisions.masterShort')
                    : t('donation.divisions.warriorShort');
            document.getElementById('donationModalTier').textContent = tierLabel;

            if (!weeks.length) {
                destroyChart('donationHistoryChart');
                document.getElementById('donationProfileModal').style.display = 'block';
                return;
            }

            const history = weeks.map(week => {
                const entry = donationWeeksData[week]?.find(row => row.Commander === commanderName);
                return entry ? entry.Points : 0;
            });

            const ctx = document.getElementById('donationHistoryChart')?.getContext('2d');
            if (ctx) {
                destroyChart('donationHistoryChart');
                chartInstances['donationHistoryChart'] = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: weeks.map(w => `${t('week')} ${w}`),
                        datasets: [{
                            label: t('table.points'),
                            data: history,
                            borderColor: 'rgba(212, 106, 45, 1)',
                            backgroundColor: 'rgba(212, 106, 45, 0.2)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, ticks: { color: chartTheme.text }, grid: { color: chartTheme.grid } },
                            x: { ticks: { color: chartTheme.text }, grid: { display: false } }
                        }
                    }
                });
            }

            document.getElementById('donationProfileModal').style.display = 'block';
        }

        function renderDonationCharts(rows) {
            if (!rows || !rows.length) return;

            const chartTheme = getChartTheme();
            const top10 = rows.slice(0, 10);
            const barCtx = document.getElementById('donationBarChart')?.getContext('2d');
            if (barCtx) {
                destroyChart('donationBarChart');
                chartInstances['donationBarChart'] = new Chart(barCtx, {
                    type: 'bar',
                    data: {
                        labels: top10.map(p => p.Commander),
                    datasets: [{
                        label: t('table.points'),
                        data: top10.map(p => p.Points),
                        backgroundColor: 'rgba(212, 106, 45, 0.8)',
                        borderColor: 'rgba(212, 106, 45, 1)',
                            borderWidth: 2,
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: chartTheme.grid },
                                ticks: { color: chartTheme.text }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: chartTheme.text, maxRotation: 45 }
                            }
                        }
                    }
                });
            }

            const tiers = {
                [t('donation.table.tierElite')]: rows.filter(p => p.Points >= 100000).length,
                [t('donation.table.tierMaster')]: rows.filter(p => p.Points >= 50000 && p.Points < 100000).length,
                [t('donation.table.tierWarrior')]: rows.filter(p => p.Points < 50000).length
            };
            const pieCtx = document.getElementById('donationPieChart')?.getContext('2d');
            if (pieCtx) {
                destroyChart('donationPieChart');
                chartInstances['donationPieChart'] = new Chart(pieCtx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(tiers),
                        datasets: [{
                            data: Object.values(tiers),
                            backgroundColor: ['rgba(242, 192, 83, 0.85)', 'rgba(212, 106, 45, 0.8)', 'rgba(227, 154, 107, 0.8)'],
                            borderColor: ['rgba(242, 192, 83, 1)', 'rgba(212, 106, 45, 1)', 'rgba(227, 154, 107, 1)'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: chartTheme.text, font: { size: 14 }, padding: 20 }
                            }
                        }
                    }
                });
            }

            const top20 = rows.slice(0, 20);
            const topPerfCtx = document.getElementById('donationTopPerformanceChart')?.getContext('2d');
            if (topPerfCtx) {
                destroyChart('donationTopPerformanceChart');
                chartInstances['donationTopPerformanceChart'] = new Chart(topPerfCtx, {
                    type: 'line',
                    data: {
                        labels: top20.map(p => p.Commander),
                        datasets: [{
                            label: t('table.points'),
                            data: top20.map(p => p.Points),
                            borderColor: 'rgba(31, 138, 131, 1)',
                            backgroundColor: 'rgba(31, 138, 131, 0.2)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: {
                                grid: { color: chartTheme.grid },
                                ticks: { color: chartTheme.text }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: chartTheme.text, maxRotation: 45 }
                            }
                        }
                    }
                });
            }

            const bottom20 = rows.slice(-20).reverse();
            const bottomPerfCtx = document.getElementById('donationBottomPerformanceChart')?.getContext('2d');
            if (bottomPerfCtx) {
                destroyChart('donationBottomPerformanceChart');
                chartInstances['donationBottomPerformanceChart'] = new Chart(bottomPerfCtx, {
                    type: 'line',
                    data: {
                        labels: bottom20.map(p => p.Commander),
                        datasets: [{
                            label: t('table.points'),
                            data: bottom20.map(p => p.Points),
                            borderColor: 'rgba(224, 108, 95, 1)',
                            backgroundColor: 'rgba(224, 108, 95, 0.2)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: {
                                grid: { color: chartTheme.grid },
                                ticks: { color: chartTheme.text }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: chartTheme.text, maxRotation: 45 }
                            }
                        }
                    }
                });
            }
        }

        function updateDonationWeekButtons() {
            const weeks = getDonationWeeksList();
            const selector = document.getElementById('donationWeekSelector');
            if (!selector) return;

            if (!weeks.length) {
                selector.innerHTML = '';
                return;
            }

            const allActive = currentDonationView === 'all';
            selector.innerHTML = `
                <button class="week-btn ${allActive ? 'active' : ''}" onclick="selectDonationView('all')">${t('donation.table.allWeeks')}</button>
                ${weeks.map(week =>
                    `<button class="week-btn ${!allActive && week == currentDonationWeek ? 'active' : ''}" onclick="selectDonationWeek(${week})">${t('week')} ${week}</button>`
                ).join('')}
            `;
        }

        function selectDonationWeek(week) {
            currentDonationWeek = week;
            currentDonationView = 'week';
            updateDonationWeekButtons();
            renderDonationTable(getCurrentDonationRows());
        }

        function selectDonationView(view) {
            currentDonationView = view;
            updateDonationWeekButtons();
            renderDonationTable(getCurrentDonationRows());
        }

        async function loadDonationLeaderboard() {
            const statusEl = document.getElementById('donationStatus');
            try {
                if (statusEl) statusEl.textContent = t('donation.messages.loading');
                const totalWeeks = await loadAllDonationWeeksFromFirebase();
                if (totalWeeks > 0) {
                    currentDonationView = 'all';
                    const rows = getCurrentDonationRows();
                    updateDonationWeekButtons();
                    renderDonationTable(rows);
                    if (statusEl) statusEl.textContent = t('donation.messages.loadedAllWeeks', { count: rows.length });
                    return rows;
                }

                return await loadDonationDefaultCSV();
            } catch (error) {
                console.error('Error loading donation leaderboard:', error);
                if (statusEl) statusEl.textContent = `‚ùå ${error.message}`;
                return [];
            }
        }

        async function loadDonationDefaultCSV() {
            const statusEl = document.getElementById('donationStatus');
            const response = await fetch('alliance_donation_week_1.csv');
            if (!response.ok) {
                throw new Error('Unable to load donation CSV');
            }
            const csvText = await response.text();
            const parsed = parseDonationCSV(csvText);
            donationData = parsed.map(row => {
                const commander = row['Commander Name'] || row.Commander || row['Commander'] || row['Player Name'] || row.Player;
                const pointsVal = typeof row.Points === 'number' ? row.Points : parseInt(String(row.Points || '0').replace(/,/g, '')) || 0;
                const rankVal = parseInt(row.Rank, 10) || 0;
                return { Rank: rankVal, Commander: commander || 'Unknown', Points: pointsVal };
            }).filter(p => p.Commander);

            donationData.sort((a, b) => a.Rank - b.Rank);
            currentDonationView = 'week';
            currentDonationWeek = 1;
            renderDonationTable(donationData);
            updateDonationWeekButtons();
            if (statusEl) statusEl.textContent = t('donation.messages.loadedWeek', { week: currentDonationWeek, count: donationData.length });
            return donationData;
        }

        function showDonationUpload() {
            const label = document.getElementById('donationUploadLabel');
            if (auth.currentUser && label) {
                label.style.display = 'inline-block';
            } else if (label) {
                label.style.display = 'none';
            }
        }

        function setDonationStatus(text) {
            const statusEl = document.getElementById('donationStatus');
            if (statusEl) statusEl.textContent = text || '';
        }

        async function resetAllianceDuelData() {
            if (!auth.currentUser) {
                alert(t('messages.signInRequired'));
                return;
            }

            const confirmText = prompt(t('messages.resetConfirm'));
            if (confirmText !== 'RESET') {
                alert(t('messages.resetCancelled'));
                return;
            }

            try {
                await database.ref('weeks').remove();
                await database.ref('metadata').remove();
                weeklyData = {};
                currentWeek = 1;
                updateWeekButtons();
                updateDashboard();

                const kpiGrid = document.getElementById('kpiGrid');
                if (kpiGrid) {
                    kpiGrid.innerHTML = `
                        <div class="kpi-card" style="grid-column: 1 / -1;">
                            <div class="kpi-label">üì§ ${t('messages.noData')}</div>
                            <div class="kpi-value">‚ö†Ô∏è</div>
                            <div class="kpi-subtext">${t('messages.uploadFirst')}</div>
                        </div>
                    `;
                }

                alert(t('messages.resetSuccess'));
            } catch (error) {
                console.error('Reset duel error:', error);
                alert(t('messages.resetError', { error: error.message }));
            }
        }

        async function resetDonationData() {
            if (!auth.currentUser) {
                alert(t('donation.messages.signInRequired'));
                return;
            }

            const confirmText = prompt(t('donation.messages.resetConfirm'));
            if (confirmText !== 'RESET') {
                alert(t('donation.messages.resetCancelled'));
                return;
            }

            try {
                await database.ref('donations').remove();
                donationWeeksData = {};
                donationData = [];
                currentDonationWeek = 1;
                currentDonationView = 'week';
                updateDonationWeekButtons();
                renderDonationTable([]);
                setDonationStatus(t('donation.messages.resetSuccess'));
                alert(t('donation.messages.resetSuccess'));
            } catch (error) {
                console.error('Reset donation error:', error);
                alert(t('donation.messages.resetError', { error: error.message }));
            }
        }

        // === USER INTERACTIONS ===
        function setActiveTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                const target = btn.getAttribute('data-tab');
                btn.classList.toggle('active', target === tabId);
            });
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.toggle('active', panel.id === tabId);
            });

            localStorage.setItem('activeTab', tabId);
            if (tabId) {
                window.location.hash = tabId;
            }

            if (tabId === 'donationTab') {
                loadDonationLeaderboard();
            }
            if (tabId === 'guidesTab') {
                loadGuidesFromFirebase();
            }
        }

        function selectWeek(week) {
            currentWeek = week;
            currentDuelView = 'week';
            updateWeekButtons();
            updateDashboard();
        }

        function selectDuelView(view) {
            currentDuelView = view;
            updateWeekButtons();
            renderKPIs();
            renderCharts();
            renderDivisions();
            renderTable();
        }

        function openPlayerProfile(playerName) {
            const weeks = Object.keys(weeklyData).sort((a, b) => a - b);
            const playerData = getCurrentPlayers().find(p => p['Player Name'] === playerName);
            
            if (!playerData) return;

            currentProfilePlayer = playerName;
            const chartTheme = getChartTheme();
            
            document.getElementById('modalPlayerName').textContent = `${t('modals.playerProfile')} ‚Äî ${playerName}`;
            document.getElementById('modalRank').textContent = `#${playerData.Rank}`;
            document.getElementById('modalPoints').textContent = playerData.Points.toLocaleString();
            document.getElementById('modalDivision').textContent = getDivision(playerData.Points);
            
            // Player history chart
            const historyData = weeks.map(week => {
                const data = weeklyData[week].find(p => p['Player Name'] === playerName);
                return data ? data.Points : 0;
            });
            
            const histCtx = document.getElementById('playerHistoryChart').getContext('2d');
            if (chartInstances['playerHistoryChart']) {
                chartInstances['playerHistoryChart'].destroy();
            }
            chartInstances['playerHistoryChart'] = new Chart(histCtx, {
                type: 'line',
                data: {
                    labels: weeks.map(w => `${t('week')} ${w}`),
                    datasets: [{
                        label: t('table.points'),
                        data: historyData,
                        borderColor: 'rgba(31, 138, 131, 1)',
                        backgroundColor: 'rgba(31, 138, 131, 0.2)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            grid: { color: chartTheme.grid },
                            ticks: { color: chartTheme.text }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: chartTheme.text }
                        }
                    }
                }
            });
            
            document.getElementById('playerModal').style.display = 'block';
        }

        // CSV Upload
        document.getElementById('csvUpload').addEventListener('change', async function(e) {
            console.log('üì§ CSV upload triggered');
            const file = e.target.files[0];
            if (!file) {
                console.log('No file selected');
                return;
            }
            
            console.log('File selected:', file.name, file.size, 'bytes');
            
            // Check authentication first
            if (!auth.currentUser) {
                alert(t('messages.signInRequired'));
                e.target.value = '';
                return;
            }
            
            console.log('User authenticated:', auth.currentUser.email);
            
            const reader = new FileReader();
            reader.onload = async function(event) {
                try {
                    const csvContent = event.target.result;
                    console.log('CSV Content loaded, length:', csvContent.length);
                    
                    const newPlayers = parseCSV(csvContent);
                    console.log('Parsed players:', newPlayers.length, newPlayers.slice(0, 3));
                    
                    if (!newPlayers || newPlayers.length === 0) {
                        alert(t('messages.invalidCsv'));
                        e.target.value = '';
                        return;
                    }
                    
                    const existingWeeks = Object.keys(weeklyData).map(Number);
                    const nextWeek = existingWeeks.length > 0 ? Math.max(...existingWeeks) + 1 : 1;
                    
                    console.log(`Uploading Week ${nextWeek} with ${newPlayers.length} players...`);
                    console.log('Existing weeks:', existingWeeks);
                    
                    // Save to Firebase
                    await saveWeekToFirebase(nextWeek, csvContent);
                    
                    // Update UI
                    currentWeek = nextWeek;
                    currentDuelView = 'week';
                    updateWeekButtons();
                    updateDashboard();
                    
                    alert(t('messages.uploadSuccessDetail', { week: nextWeek, count: newPlayers.length }));
                    
                } catch (error) {
                    console.error('Upload error:', error);
                    alert(t('messages.uploadError', { error: error.message }));
                }
            };
            
            reader.onerror = function() {
                alert(t('messages.fileReadError'));
            };
            
            console.log('Starting to read file...');
            reader.readAsText(file);
            e.target.value = '';
        });
        
        // Debug: Test if upload button is clickable
        document.getElementById('uploadBtn')?.addEventListener('click', function(e) {
            console.log('Upload button clicked!');
            console.log('User signed in:', auth.currentUser ? 'Yes' : 'No');
            console.log('Button display:', this.style.display);
        });

        // Export Functions
        document.getElementById('exportPdfBtn').addEventListener('click', () => {
            const panel = document.getElementById('duelTab');
            const bgColor = getComputedStyle(document.body).backgroundColor || '#ffffff';
            html2canvas(panel, { backgroundColor: bgColor, scale: 2, useCORS: true }).then(canvas => {
                const pdf = new jspdf.jsPDF('p', 'pt', 'a4');
                const imgData = canvas.toDataURL('image/png');
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const ratio = Math.min(pageWidth / canvas.width, pageHeight / canvas.height);
                const imgWidth = canvas.width * ratio;
                const imgHeight = canvas.height * ratio;
                pdf.setFillColor(255, 255, 255);
                pdf.rect(0, 0, pageWidth, pageHeight, 'F');
                pdf.addImage(imgData, 'PNG', (pageWidth - imgWidth) / 2, 20, imgWidth, imgHeight);
                pdf.save(`pwr_alliance_week${currentWeek}.pdf`);
            });
        });

        document.getElementById('exportCsvBtn').addEventListener('click', () => {
            const players = getCurrentDuelRows();
            const weeks = Object.keys(weeklyData).map(Number).sort((a, b) => a - b);
            const isCumulative = currentDuelView === 'all' && weeks.length > 0;
            let csv = '';
            if (isCumulative) {
                csv = 'Rank,Player Name,' + weeks.map(w => `Week ${w}`).join(',') + ',Total\n' +
                    players.map(p => `${p.Rank},"${p['Player Name']}",${weeks.map(w => p.WeekPoints?.[w] || 0).join(',')},${p.Points}`).join('\n');
            } else {
                csv = 'Rank,Player Name,Points\n' + players.map(p =>
                    `${p.Rank},"${p['Player Name']}","${p.Points.toLocaleString()}"`
                ).join('\n');
            }
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = isCumulative ? 'pwr_alliance_all_weeks.csv' : `pwr_alliance_week${currentWeek}.csv`;
            a.click();
        });

        document.getElementById('exportPngBtn').addEventListener('click', () => {
            const panel = document.getElementById('duelTab');
            html2canvas(panel).then(canvas => {
                const link = document.createElement('a');
                link.download = `pwr_alliance_week${currentWeek}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        });

        document.getElementById('shareBtn').addEventListener('click', () => {
            const activePanel = document.querySelector('.tab-panel.active') || document.querySelector('.dashboard-container');
            html2canvas(activePanel).then(canvas => {
                const link = document.createElement('a');
                link.download = 'pwr_alliance_dashboard.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        });

        function applyDuelFilters() {
            const term = document.getElementById('searchBar')?.value.toLowerCase() || '';
            const minPoints = parseInt(document.getElementById('duelMinPoints')?.value || '0', 10) || 0;
            const divisionFilter = document.getElementById('duelDivisionFilter')?.value || '';
            const baseRows = getCurrentDuelRows();
            const filtered = baseRows.filter(p => {
                const matchesName = p['Player Name'].toLowerCase().includes(term);
                const matchesPoints = (p.Points || 0) >= minPoints;
                const points = p.Points || 0;
                const matchesDivision = divisionFilter
                    ? (divisionFilter === 'elite' && points > 100000000) ||
                      (divisionFilter === 'master' && points >= 50000000 && points <= 100000000) ||
                      (divisionFilter === 'warrior' && points < 50000000)
                    : true;
                return matchesName && matchesPoints && matchesDivision;
            });
            renderTable(filtered);
        }

        // Search and filters
        document.getElementById('searchBar')?.addEventListener('input', applyDuelFilters);
        document.getElementById('duelMinPoints')?.addEventListener('input', applyDuelFilters);
        document.getElementById('duelDivisionFilter')?.addEventListener('change', applyDuelFilters);

        // Modal Close
        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('playerModal').style.display = 'none';
            currentProfilePlayer = null;
        });

        window.addEventListener('click', (e) => {
            if (e.target.id === 'playerModal') {
                document.getElementById('playerModal').style.display = 'none';
                currentProfilePlayer = null;
            }
        });

        // ============================================
        // === EDIT/DELETE/ADD PLAYER FUNCTIONS ===
        // ============================================
        
        // Edit Player
        function editPlayer(playerName, rank) {
            if (!auth.currentUser) {
                alert(t('messages.signInEdit'));
                return;
            }
            
            const players = getCurrentPlayers();
            const player = players.find(p => p['Player Name'] === playerName && p.Rank === rank);
            
            if (!player) {
                alert(t('messages.playerNotFound'));
                return;
            }
            
            // Populate modal
            document.getElementById('editPlayerOriginalName').value = playerName;
            document.getElementById('editPlayerOriginalRank').value = rank;
            document.getElementById('editPlayerName').value = playerName;
            document.getElementById('editPlayerRank').value = rank;
            document.getElementById('editPlayerPoints').value = player.Points;
            document.getElementById('editPlayerStatus').textContent = '';
            
            // Show modal
            document.getElementById('editPlayerModal').style.display = 'block';
        }
        
        // Save Edited Player
        async function saveEditedPlayer() {
            const statusDiv = document.getElementById('editPlayerStatus');
            
            try {
                const originalName = document.getElementById('editPlayerOriginalName').value;
                const originalRank = parseInt(document.getElementById('editPlayerOriginalRank').value);
                const newName = document.getElementById('editPlayerName').value.trim();
                const newRank = parseInt(document.getElementById('editPlayerRank').value);
                const newPoints = parseInt(document.getElementById('editPlayerPoints').value.replace(/,/g, ''));
                
                if (!newName || !newRank || !newPoints) {
                    statusDiv.textContent = t('messages.requiredFields');
                    return;
                }
                
                if (newPoints <= 0) {
                    statusDiv.textContent = t('messages.pointsPositive');
                    return;
                }
                
                statusDiv.textContent = t('messages.saving');
                
                // Get current week data
                const players = getCurrentPlayers();
                
                // Find and update the player
                const playerIndex = players.findIndex(p => 
                    p['Player Name'] === originalName && p.Rank === originalRank
                );
                
                if (playerIndex === -1) {
                    throw new Error('Player not found');
                }
                
                // Update player data
                players[playerIndex] = {
                    Rank: newRank,
                    'Player Name': newName,
                    Points: newPoints
                };
                
                // Sort by rank
                players.sort((a, b) => a.Rank - b.Rank);
                
                // Convert to CSV format
                const csvContent = 'Rank,Player Name,Points\n' + 
                    players.map(p => `${p.Rank},"${p['Player Name']}","${p.Points}"`).join('\n');
                
                // Save to Firebase (this will overwrite the week)
                await saveWeekToFirebase(currentWeek, csvContent);
                
                // Update local data
                weeklyData[currentWeek] = players;
                
                // Refresh UI
                updateDashboard();
                
                statusDiv.textContent = t('messages.saveSuccess');
                
                setTimeout(() => {
                    document.getElementById('editPlayerModal').style.display = 'none';
                }, 1500);
                
            } catch (error) {
                console.error('Error saving player:', error);
                statusDiv.textContent = t('messages.errorDetail', { error: error.message });
            }
        }
        
        // Delete Player
        async function deletePlayer(playerName, rank) {
            if (!auth.currentUser) {
                alert(t('messages.signInDeletePlayer'));
                return;
            }
            
            if (!confirm(t('messages.deletePlayerConfirm', { name: playerName, rank, week: currentWeek }))) {
                return;
            }
            
            try {
                // Get current week data
                const players = getCurrentPlayers();
                
                // Remove the player
                const filteredPlayers = players.filter(p => 
                    !(p['Player Name'] === playerName && p.Rank === rank)
                );
                
                if (filteredPlayers.length === players.length) {
                    alert(t('messages.playerNotFound'));
                    return;
                }
                
                // Re-assign ranks
                filteredPlayers.forEach((p, index) => {
                    p.Rank = index + 1;
                });
                
                // Convert to CSV format
                const csvContent = 'Rank,Player Name,Points\n' + 
                    filteredPlayers.map(p => `${p.Rank},"${p['Player Name']}","${p.Points}"`).join('\n');
                
                // Save to Firebase
                await saveWeekToFirebase(currentWeek, csvContent);
                
                // Update local data
                weeklyData[currentWeek] = filteredPlayers;
                
                // Refresh UI
                updateDashboard();
                
                alert(t('messages.deletePlayerSuccess', { name: playerName, week: currentWeek }));
                
            } catch (error) {
                console.error('Error deleting player:', error);
                alert(t('messages.deletePlayerError', { error: error.message }));
            }
        }
        
        // Show Add Player Modal
        function showAddPlayerModal() {
            if (!auth.currentUser) {
                alert(t('messages.signInAddPlayer'));
                return;
            }
            
            document.getElementById('addPlayerName').value = '';
            document.getElementById('addPlayerRank').value = '';
            document.getElementById('addPlayerPoints').value = '';
            document.getElementById('addPlayerStatus').textContent = '';
            
            document.getElementById('addPlayerModal').style.display = 'block';
        }
        
        // Save New Player
        async function saveNewPlayer() {
            const statusDiv = document.getElementById('addPlayerStatus');
            
            try {
                const newName = document.getElementById('addPlayerName').value.trim();
                const newRank = parseInt(document.getElementById('addPlayerRank').value);
                const newPoints = parseInt(document.getElementById('addPlayerPoints').value.replace(/,/g, ''));
                
                if (!newName || !newRank || !newPoints) {
                    statusDiv.textContent = t('messages.requiredFields');
                    return;
                }
                
                if (newPoints <= 0) {
                    statusDiv.textContent = t('messages.pointsPositive');
                    return;
                }
                
                statusDiv.textContent = t('messages.adding');
                
                // Get current week data
                const players = getCurrentPlayers();
                
                // Add new player
                players.push({
                    Rank: newRank,
                    'Player Name': newName,
                    Points: newPoints
                });
                
                // Sort by rank
                players.sort((a, b) => a.Rank - b.Rank);
                
                // Re-assign ranks to ensure no gaps
                players.forEach((p, index) => {
                    p.Rank = index + 1;
                });
                
                // Convert to CSV format
                const csvContent = 'Rank,Player Name,Points\n' + 
                    players.map(p => `${p.Rank},"${p['Player Name']}","${p.Points}"`).join('\n');
                
                // Save to Firebase
                await saveWeekToFirebase(currentWeek, csvContent);
                
                // Update local data
                weeklyData[currentWeek] = players;
                
                // Refresh UI
                updateDashboard();
                
                statusDiv.textContent = t('messages.addSuccess');
                
                setTimeout(() => {
                    document.getElementById('addPlayerModal').style.display = 'none';
                }, 1500);
                
            } catch (error) {
                console.error('Error adding player:', error);
                statusDiv.textContent = t('messages.errorDetail', { error: error.message });
            }
        }
        
        // Delete Week
        async function deleteCurrentWeek() {
            if (!auth.currentUser) {
                alert(t('messages.signInDeleteWeek'));
                return;
            }
            
            if (Object.keys(weeklyData).length === 1) {
                alert(t('messages.cannotDeleteOnlyWeek'));
                return;
            }
            
            const confirmText = prompt(
                t('messages.deleteWeekConfirm', {
                    week: currentWeek,
                    count: getCurrentPlayers().length
                })
            );
            
            if (confirmText !== 'DELETE') {
                alert(t('messages.deleteCancelled'));
                return;
            }
            
            try {
                // Delete from Firebase
                await database.ref(`weeks/${currentWeek}`).remove();
                
                // Update metadata
                delete weeklyData[currentWeek];
                const weeks = Object.keys(weeklyData).map(Number);
                const newTotalWeeks = Math.max(...weeks);
                const newLatestWeek = newTotalWeeks;
                
                await database.ref('metadata').set({
                    totalWeeks: weeks.length,
                    latestWeek: newLatestWeek,
                    lastUpdated: new Date().toISOString(),
                    uploadedBy: auth.currentUser.email
                });
                
                // Switch to another week
                currentWeek = newLatestWeek;
                currentDuelView = 'week';
                
                // Refresh UI
                updateWeekButtons();
                updateDashboard();
                
                alert(t('messages.weekDeleted', { week: currentWeek }));
                
            } catch (error) {
                console.error('Error deleting week:', error);
                alert(t('messages.deleteWeekError', { error: error.message }));
            }
        }
        
        // Refresh Data from Firebase
        async function refreshDataFromFirebase() {
            try {
                const refreshBtn = document.getElementById('refreshDataBtn');
                if (refreshBtn) {
                    refreshBtn.textContent = t('messages.refreshing');
                    refreshBtn.disabled = true;
                }
                
                showFirebaseLoading();
                
                // Clear local data
                weeklyData = {};
                
                // Reload from Firebase
                const totalWeeks = await loadAllWeeksFromFirebase();
                
                if (totalWeeks > 0) {
                    currentWeek = totalWeeks;
                    currentDuelView = 'week';
                }
                
                // Refresh UI
                updateWeekButtons();
                updateDashboard();
                
                alert(t('messages.refreshSuccess', { count: totalWeeks }));
                
            } catch (error) {
                console.error('Error refreshing data:', error);
                alert(t('messages.refreshError', { error: error.message }));
            } finally {
                const refreshBtn = document.getElementById('refreshDataBtn');
                if (refreshBtn) {
                    refreshBtn.textContent = t('buttons.refresh');
                    refreshBtn.disabled = false;
                }
            }
        }

        function buildDonationCsv(rows) {
            return 'Rank,Commander Name,Points\n' +
                rows.map(p => `${p.Rank},"${p.Commander}","${p.Points}"`).join('\n');
        }

        function editDonationEntry(commanderName, rank) {
            if (!auth.currentUser) {
                alert(t('donation.messages.signInRequired'));
                return;
            }

            if (currentDonationView === 'all') {
                currentDonationView = 'week';
            }

            const rows = donationWeeksData[currentDonationWeek] || [];
            const entry = rows.find(p => p.Commander === commanderName && p.Rank === rank);
            if (!entry) {
                alert(t('donation.messages.deleteError', { error: t('messages.playerNotFound') }));
                return;
            }

            document.getElementById('editDonationOriginalName').value = commanderName;
            document.getElementById('editDonationOriginalRank').value = rank;
            document.getElementById('donationEditName').value = commanderName;
            document.getElementById('donationEditRank').value = rank;
            document.getElementById('donationEditPoints').value = entry.Points;
            document.getElementById('donationEditStatus').textContent = '';
            document.getElementById('editDonationModal').style.display = 'block';
        }

        async function saveEditedDonation() {
            const statusDiv = document.getElementById('donationEditStatus');
            try {
                const originalName = document.getElementById('editDonationOriginalName').value;
                const originalRank = parseInt(document.getElementById('editDonationOriginalRank').value, 10);
                const newName = document.getElementById('donationEditName').value.trim();
                const newRank = parseInt(document.getElementById('donationEditRank').value, 10);
                const newPoints = parseInt(document.getElementById('donationEditPoints').value.replace(/,/g, ''), 10);

                if (!newName || !newRank || !newPoints) {
                    statusDiv.textContent = t('messages.requiredFields');
                    return;
                }

                if (newPoints <= 0) {
                    statusDiv.textContent = t('messages.pointsPositive');
                    return;
                }

                statusDiv.textContent = t('messages.saving');

                const rows = donationWeeksData[currentDonationWeek] || [];
                const entryIndex = rows.findIndex(p => p.Commander === originalName && p.Rank === originalRank);
                if (entryIndex === -1) {
                    throw new Error('Commander not found');
                }

                rows[entryIndex] = { Rank: newRank, Commander: newName, Points: newPoints };
                rows.sort((a, b) => a.Rank - b.Rank);
                rows.forEach((p, index) => { p.Rank = index + 1; });

                const csvContent = buildDonationCsv(rows);
                await saveDonationWeekToFirebase(currentDonationWeek, csvContent);
                donationWeeksData[currentDonationWeek] = rows;

                renderDonationTable(getCurrentDonationRows());
                statusDiv.textContent = t('donation.messages.editSuccess');
                setTimeout(() => {
                    document.getElementById('editDonationModal').style.display = 'none';
                }, 1500);
            } catch (error) {
                console.error('Error updating donation entry:', error);
                statusDiv.textContent = t('donation.messages.editError', { error: error.message });
            }
        }

        async function deleteDonationEntry(commanderName, rank) {
            if (!auth.currentUser) {
                alert(t('donation.messages.signInRequired'));
                return;
            }

            if (!confirm(t('donation.messages.deleteConfirm', { name: commanderName, rank, week: currentDonationWeek }))) {
                return;
            }

            try {
                const rows = donationWeeksData[currentDonationWeek] || [];
                const filteredRows = rows.filter(p => !(p.Commander === commanderName && p.Rank === rank));
                if (filteredRows.length === rows.length) {
                    alert(t('donation.messages.deleteError', { error: t('messages.playerNotFound') }));
                    return;
                }

                filteredRows.forEach((p, index) => { p.Rank = index + 1; });
                const csvContent = buildDonationCsv(filteredRows);
                await saveDonationWeekToFirebase(currentDonationWeek, csvContent);
                donationWeeksData[currentDonationWeek] = filteredRows;

                renderDonationTable(getCurrentDonationRows());
                alert(t('donation.messages.deleteSuccess'));
            } catch (error) {
                console.error('Error deleting donation entry:', error);
                alert(t('donation.messages.deleteError', { error: error.message }));
            }
        }

        function showAddDonationModal() {
            if (!auth.currentUser) {
                alert(t('donation.messages.signInRequired'));
                return;
            }

            if (!Object.keys(donationWeeksData).length) {
                currentDonationWeek = 1;
            }

            if (currentDonationView === 'all') {
                currentDonationView = 'week';
                updateDonationWeekButtons();
            }

            document.getElementById('donationAddName').value = '';
            document.getElementById('donationAddRank').value = '';
            document.getElementById('donationAddPoints').value = '';
            document.getElementById('donationAddStatus').textContent = '';
            document.getElementById('addDonationModal').style.display = 'block';
        }

        async function saveNewDonation() {
            const statusDiv = document.getElementById('donationAddStatus');
            try {
                const newName = document.getElementById('donationAddName').value.trim();
                const newRank = parseInt(document.getElementById('donationAddRank').value, 10);
                const newPoints = parseInt(document.getElementById('donationAddPoints').value.replace(/,/g, ''), 10);

                if (!newName || !newRank || !newPoints) {
                    statusDiv.textContent = t('messages.requiredFields');
                    return;
                }

                if (newPoints <= 0) {
                    statusDiv.textContent = t('messages.pointsPositive');
                    return;
                }

                statusDiv.textContent = t('messages.adding');

                const rows = donationWeeksData[currentDonationWeek] || [];
                rows.push({ Rank: newRank, Commander: newName, Points: newPoints });
                rows.sort((a, b) => a.Rank - b.Rank);
                rows.forEach((p, index) => { p.Rank = index + 1; });

                const csvContent = buildDonationCsv(rows);
                await saveDonationWeekToFirebase(currentDonationWeek, csvContent);
                donationWeeksData[currentDonationWeek] = rows;

                renderDonationTable(getCurrentDonationRows());
                statusDiv.textContent = t('donation.messages.addSuccess');
                setTimeout(() => {
                    document.getElementById('addDonationModal').style.display = 'none';
                }, 1500);
            } catch (error) {
                console.error('Error adding donation entry:', error);
                statusDiv.textContent = t('donation.messages.addError', { error: error.message });
            }
        }

        async function deleteDonationWeek() {
            if (!auth.currentUser) {
                alert(t('donation.messages.signInRequired'));
                return;
            }

            const weeks = getDonationWeeksList();
            if (weeks.length <= 1) {
                alert(t('donation.messages.deleteWeekOnlyWeek'));
                return;
            }

            const confirmText = prompt(t('donation.messages.deleteWeekConfirm', { week: currentDonationWeek, count: (donationWeeksData[currentDonationWeek] || []).length }));
            if (confirmText !== 'DELETE') {
                alert(t('donation.messages.deleteWeekCancelled'));
                return;
            }

            try {
                await database.ref(`donations/weeks/${currentDonationWeek}`).remove();
                delete donationWeeksData[currentDonationWeek];

                const remainingWeeks = getDonationWeeksList();
                const latestWeek = Math.max(...remainingWeeks);
                await database.ref('donations/metadata').set({
                    totalWeeks: remainingWeeks.length,
                    latestWeek,
                    lastUpdated: new Date().toISOString(),
                    uploadedBy: auth.currentUser.email
                });

                currentDonationWeek = latestWeek;
                currentDonationView = 'week';
                updateDonationWeekButtons();
                renderDonationTable(getCurrentDonationRows());
                alert(t('donation.messages.deleteWeekSuccess', { week: currentDonationWeek }));
            } catch (error) {
                console.error('Error deleting donation week:', error);
                alert(t('donation.messages.deleteWeekError', { error: error.message }));
            }
        }

        async function refreshDonationDataFromFirebase() {
            try {
                const refreshBtn = document.getElementById('donationRefreshBtn');
                if (refreshBtn) {
                    refreshBtn.textContent = t('messages.refreshing');
                    refreshBtn.disabled = true;
                }

                setDonationStatus(t('donation.messages.loading'));
                donationWeeksData = {};
                donationData = [];

                const totalWeeks = await loadAllDonationWeeksFromFirebase();
                if (totalWeeks > 0) {
                    currentDonationView = 'all';
                    const rows = getCurrentDonationRows();
                    updateDonationWeekButtons();
                    renderDonationTable(rows);
                    setDonationStatus(t('donation.messages.refreshSuccess', { count: totalWeeks }));
                } else {
                    setDonationStatus(t('donation.messages.refreshSuccess', { count: 0 }));
                }
            } catch (error) {
                console.error('Error refreshing donations:', error);
                setDonationStatus(t('donation.messages.refreshError', { error: error.message }));
            } finally {
                const refreshBtn = document.getElementById('donationRefreshBtn');
                if (refreshBtn) {
                    refreshBtn.textContent = t('buttons.refresh');
                    refreshBtn.disabled = false;
                }
            }
        }
        
        // Modal Close Handlers
        document.getElementById('closeEditModal')?.addEventListener('click', () => {
            document.getElementById('editPlayerModal').style.display = 'none';
        });
        
        document.getElementById('closeAddModal')?.addEventListener('click', () => {
            document.getElementById('addPlayerModal').style.display = 'none';
        });

        document.getElementById('closeEditDonationModal')?.addEventListener('click', () => {
            document.getElementById('editDonationModal').style.display = 'none';
        });

        document.getElementById('closeAddDonationModal')?.addEventListener('click', () => {
            document.getElementById('addDonationModal').style.display = 'none';
        });

        document.getElementById('closeAuthModal')?.addEventListener('click', () => {
            closeAuthModal();
        });

        document.getElementById('closeDonationModal')?.addEventListener('click', () => {
            document.getElementById('donationProfileModal').style.display = 'none';
            currentDonationProfile = null;
        });

        document.getElementById('closeGuidePreview')?.addEventListener('click', () => {
            document.getElementById('guidePreviewModal').style.display = 'none';
        });

        document.getElementById('closeAddGuideModal')?.addEventListener('click', () => {
            document.getElementById('addGuideModal').style.display = 'none';
        });
        
        window.addEventListener('click', (e) => {
            if (e.target.id === 'editPlayerModal') {
                document.getElementById('editPlayerModal').style.display = 'none';
            }
            if (e.target.id === 'addPlayerModal') {
                document.getElementById('addPlayerModal').style.display = 'none';
            }
            if (e.target.id === 'editDonationModal') {
                document.getElementById('editDonationModal').style.display = 'none';
            }
            if (e.target.id === 'addDonationModal') {
                document.getElementById('addDonationModal').style.display = 'none';
            }
            if (e.target.id === 'authModal') {
                closeAuthModal();
            }
            if (e.target.id === 'donationProfileModal') {
                document.getElementById('donationProfileModal').style.display = 'none';
                currentDonationProfile = null;
            }
            if (e.target.id === 'guidePreviewModal') {
                document.getElementById('guidePreviewModal').style.display = 'none';
            }
            if (e.target.id === 'addGuideModal') {
                document.getElementById('addGuideModal').style.display = 'none';
            }
        });
        
        // Save buttons
        document.getElementById('saveEditPlayerBtn')?.addEventListener('click', saveEditedPlayer);
        document.getElementById('saveAddPlayerBtn')?.addEventListener('click', saveNewPlayer);
        document.getElementById('saveEditDonationBtn')?.addEventListener('click', saveEditedDonation);
        document.getElementById('saveAddDonationBtn')?.addEventListener('click', saveNewDonation);
        document.getElementById('authSubmitBtn')?.addEventListener('click', handleAuthSubmit);
        document.getElementById('authPassword')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleAuthSubmit(e);
            }
        });
        
        // Control buttons
        document.getElementById('deleteWeekBtn')?.addEventListener('click', deleteCurrentWeek);
        document.getElementById('addPlayerBtn')?.addEventListener('click', showAddPlayerModal);
        document.getElementById('refreshDataBtn')?.addEventListener('click', refreshDataFromFirebase);
        document.getElementById('donationRefreshBtn')?.addEventListener('click', refreshDonationDataFromFirebase);
        document.getElementById('donationDeleteWeekBtn')?.addEventListener('click', deleteDonationWeek);
        document.getElementById('donationAddCommanderBtn')?.addEventListener('click', showAddDonationModal);

        // Tabs
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => setActiveTab(btn.getAttribute('data-tab')));
        });

        const initialTab = window.location.hash.replace('#', '') ||
            localStorage.getItem('activeTab') ||
            'duelTab';
        if (initialTab && document.getElementById(initialTab)) {
            setActiveTab(initialTab);
        }

        function applyDonationFilters() {
            const term = document.getElementById('donationSearch')?.value.toLowerCase() || '';
            const minPoints = parseInt(document.getElementById('donationMinPoints')?.value || '0', 10) || 0;
            const tierFilter = document.getElementById('donationTierFilter')?.value || '';
            const baseRows = getCurrentDonationRows();
            const filtered = baseRows.filter(p => {
                const matchesName = p.Commander.toLowerCase().includes(term);
                const matchesPoints = (p.Points || 0) >= minPoints;
                const matchesTier = tierFilter ? getDonationTier(p.Points || 0) === tierFilter : true;
                return matchesName && matchesPoints && matchesTier;
            });
            renderDonationTable(filtered);
        }

        // Donation search/filters
        document.getElementById('donationSearch')?.addEventListener('input', applyDonationFilters);
        document.getElementById('donationMinPoints')?.addEventListener('input', applyDonationFilters);
        document.getElementById('donationTierFilter')?.addEventListener('change', applyDonationFilters);
        document.getElementById('addGuideBtn')?.addEventListener('click', showAddGuideModal);
        document.getElementById('saveGuideBtn')?.addEventListener('click', saveGuide);

        // Donation upload
        document.getElementById('donationUpload')?.addEventListener('change', (e) => {
            if (!auth.currentUser) {
                alert(t('donation.messages.signInRequired'));
                e.target.value = '';
                return;
            }
            const file = e.target.files?.[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async function(event) {
                try {
                    const csvContent = event.target.result;
                    const existingWeeks = Object.keys(donationWeeksData).map(Number);
                    const nextWeek = existingWeeks.length > 0 ? Math.max(...existingWeeks) + 1 : 1;
                    await saveDonationWeekToFirebase(nextWeek, csvContent);
                    currentDonationWeek = nextWeek;
                    currentDonationView = 'week';
                    const rows = getCurrentDonationRows();
                    updateDonationWeekButtons();
                    renderDonationTable(rows);
                    setDonationStatus(t('donation.messages.uploadSuccess', { week: nextWeek, count: rows.length }));
                } catch (error) {
                    console.error('Donation upload error:', error);
                    alert(t('donation.messages.uploadError', { error: error.message }));
                } finally {
                    e.target.value = '';
                }
            };
            reader.onerror = function() {
                alert(t('messages.fileReadError'));
                e.target.value = '';
            };
            reader.readAsText(file);
        });

        document.getElementById('donationExportCsvBtn')?.addEventListener('click', () => {
            const rows = getCurrentDonationRows();
            if (!rows.length) {
                alert(t('donation.messages.noExport'));
                return;
            }
            const weeks = getDonationWeeksList();
            const isCumulative = currentDonationView === 'all' && weeks.length > 0;
            let csv = '';
            if (isCumulative) {
                csv = 'Rank,Commander Name,' + weeks.map(w => `Week ${w}`).join(',') + ',Total\n' +
                    rows.map(p => `${p.Rank},"${p.Commander}",${weeks.map(w => p.WeekPoints?.[w] || 0).join(',')},${p.Points}`).join('\n');
            } else {
                csv = 'Rank,Commander Name,Points\n' + rows.map(p => `${p.Rank},"${p.Commander}","${p.Points}"`).join('\n');
            }
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'pwr_alliance_donations.csv';
            a.click();
        });

        document.getElementById('donationExportPdfBtn')?.addEventListener('click', () => {
            const panel = document.getElementById('donationTab');
            const bgColor = getComputedStyle(document.body).backgroundColor || '#ffffff';
            html2canvas(panel, { backgroundColor: bgColor, scale: 2, useCORS: true }).then(canvas => {
                const pdf = new jspdf.jsPDF('p', 'pt', 'a4');
                const imgData = canvas.toDataURL('image/png');
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const ratio = Math.min(pageWidth / canvas.width, pageHeight / canvas.height);
                const imgWidth = canvas.width * ratio;
                const imgHeight = canvas.height * ratio;
                pdf.setFillColor(255, 255, 255);
                pdf.rect(0, 0, pageWidth, pageHeight, 'F');
                pdf.addImage(imgData, 'PNG', (pageWidth - imgWidth) / 2, 20, imgWidth, imgHeight);
                pdf.save('pwr_alliance_donations.pdf');
            });
        });

        document.getElementById('donationExportPngBtn')?.addEventListener('click', () => {
            const panel = document.getElementById('donationTab');
            html2canvas(panel).then(canvas => {
                const link = document.createElement('a');
                link.download = 'pwr_alliance_donations.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        });

        document.getElementById('resetDuelBtn')?.addEventListener('click', resetAllianceDuelData);
        document.getElementById('resetDonationBtn')?.addEventListener('click', resetDonationData);

        // ============================================
        // === FIREBASE INITIALIZATION ===
        // ============================================
        
        async function initializeDashboard() {
            console.log('üöÄ Initializing dashboard with Firebase...');
            
            showFirebaseLoading();
            
            // Try to load from Firebase first
            const totalWeeks = await loadAllWeeksFromFirebase();
            
            if (totalWeeks === 0) {
                // No data in Firebase - show empty state
                console.log('‚ö†Ô∏è No Firebase data found. Please upload Week 1 data.');
                
                // Show message to user
                const kpiGrid = document.getElementById('kpiGrid');
                if (kpiGrid) {
                    kpiGrid.innerHTML = `
                        <div class="kpi-card" style="grid-column: 1 / -1;">
                            <div class="kpi-label">üì§ ${t('messages.noData')}</div>
                            <div class="kpi-value">‚ö†Ô∏è</div>
                            <div class="kpi-subtext">${t('messages.uploadFirst')}</div>
                        </div>
                    `;
                }
                
                currentWeek = 1;
                currentDuelView = 'week';
            } else {
                // Set current week to latest available
                currentWeek = totalWeeks;
                currentDuelView = 'week';
                
                // Update UI
                updateWeekButtons();
                updateDashboard();
            }
            
            updateAuthUI();
            showDonationUpload();
            
            // Apply full language translations now that data is loaded
            setLanguage(currentLanguage);
            
            console.log('‚úÖ Dashboard initialized');
        }
        
        // Update UI based on auth state
        function updateAuthUI() {
            const user = auth.currentUser;
            const signInBtn = document.getElementById('signInOutBtn');
            const uploadLabel = document.getElementById('uploadBtn');
            const deleteWeekBtn = document.getElementById('deleteWeekBtn');
            const addPlayerBtn = document.getElementById('addPlayerBtn');
            const refreshDataBtn = document.getElementById('refreshDataBtn');
            const donationDeleteWeekBtn = document.getElementById('donationDeleteWeekBtn');
            const donationAddCommanderBtn = document.getElementById('donationAddCommanderBtn');
            const addGuideBtn = document.getElementById('addGuideBtn');
            
            console.log('üîÑ Updating Auth UI, user:', user ? user.email : 'None');
            
            if (user) {
                // User is signed in - SHOW admin buttons
                if (signInBtn) {
                    signInBtn.textContent = t('buttons.signOut');
                    signInBtn.title = t('messages.signedInAs', { email: user.email });
                    console.log('‚úÖ Sign out button set');
                }
                if (uploadLabel) {
                    uploadLabel.style.display = 'inline-block';
                    // Update only the text node, not the entire content (preserves the input element)
                    const textNode = Array.from(uploadLabel.childNodes).find(node => node.nodeType === 3);
                    if (textNode) {
                        textNode.textContent = t('buttons.upload');
                    }
                    uploadLabel.style.background = 'linear-gradient(135deg, #1f8a83, #176a64)';
                    uploadLabel.style.boxShadow = '0 0 18px rgba(31, 138, 131, 0.35)';
                    uploadLabel.title = t('messages.uploadHint', { email: user.email });
                    console.log('‚úÖ Upload button shown');
                }
                if (deleteWeekBtn) {
                    deleteWeekBtn.style.display = 'inline-block';
                    deleteWeekBtn.textContent = t('buttons.deleteWeek');
                }
                if (addPlayerBtn) {
                    addPlayerBtn.style.display = 'inline-block';
                    addPlayerBtn.textContent = t('buttons.addPlayer');
                }
                const resetDuelBtn = document.getElementById('resetDuelBtn');
                if (resetDuelBtn) {
                    resetDuelBtn.style.display = 'inline-block';
                }
                const resetDonationBtn = document.getElementById('resetDonationBtn');
                if (resetDonationBtn) {
                    resetDonationBtn.style.display = 'inline-block';
                }
                if (donationDeleteWeekBtn) {
                    donationDeleteWeekBtn.style.display = 'inline-block';
                    donationDeleteWeekBtn.textContent = t('buttons.deleteWeek');
                }
                if (donationAddCommanderBtn) {
                    donationAddCommanderBtn.style.display = 'inline-block';
                    donationAddCommanderBtn.textContent = t('donation.buttons.addCommander');
                }
                if (addGuideBtn) {
                    addGuideBtn.style.display = 'inline-block';
                    addGuideBtn.textContent = t('guides.addButton');
                }
                if (refreshDataBtn) {
                    refreshDataBtn.textContent = t('buttons.refresh');
                }
            } else {
                // User is signed out - HIDE admin buttons
                if (signInBtn) {
                    signInBtn.textContent = t('buttons.signIn');
                    signInBtn.title = t('messages.signInHint');
                    console.log('‚úÖ Sign in button set');
                }
                if (uploadLabel) {
                    uploadLabel.style.display = 'none';
                }
                if (deleteWeekBtn) {
                    deleteWeekBtn.style.display = 'none';
                }
                if (addPlayerBtn) {
                    addPlayerBtn.style.display = 'none';
                }
                const resetDuelBtn = document.getElementById('resetDuelBtn');
                if (resetDuelBtn) {
                    resetDuelBtn.style.display = 'none';
                }
                const resetDonationBtn = document.getElementById('resetDonationBtn');
                if (resetDonationBtn) {
                    resetDonationBtn.style.display = 'none';
                }
                if (donationDeleteWeekBtn) {
                    donationDeleteWeekBtn.style.display = 'none';
                }
                if (donationAddCommanderBtn) {
                    donationAddCommanderBtn.style.display = 'none';
                }
                if (addGuideBtn) {
                    addGuideBtn.style.display = 'none';
                }
                if (refreshDataBtn) {
                    refreshDataBtn.textContent = t('buttons.refresh');
                }
            }
        }
        
        // Auth state observer
        auth.onAuthStateChanged((user) => {
            console.log('Auth state changed:', user ? `Signed in as ${user.email}` : 'Signed out');
            updateAuthUI();
            showDonationUpload();
        });
        
        // Sign In/Out button handler
        document.getElementById('signInOutBtn').addEventListener('click', async () => {
            const user = auth.currentUser;
            
            if (user) {
                // User is signed in - sign out
                if (confirm(t('messages.signOutConfirm', { email: user.email }))) {
                    signOutFromFirebase();
                    alert(t('messages.signOutSuccess'));
                }
            } else {
                // User is signed out - show inline auth modal
                openAuthModal();
            }
        });
        
        // Start the app
        initializeDashboard();
    </script>

</body>
</html>
