<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[pWR] Alliance Duel Weekly Leaderboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
/* =================================================================
   LAST WAR: SURVIVAL THEME - POST-APOCALYPTIC ZOMBIE SURVIVAL STYLE
   Replace the <style> section in your dashboard with this CSS
   ================================================================= */

   @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@400;600;700&family=Rajdhani:wght@400;600;700&family=Teko:wght@400;600;700&display=swap');

* { margin: 0; padding: 0; box-sizing: border-box; }

/* ===== APOCALYPTIC BACKGROUND ===== */
body {
    font-family: 'Rajdhani', sans-serif;
    background: linear-gradient(135deg, #0d0d0d 0%, #1a1410 50%, #1f1a15 100%);
    background-image: 
        radial-gradient(ellipse at top, rgba(139, 69, 0, 0.1), transparent),
        radial-gradient(ellipse at bottom, rgba(200, 50, 0, 0.05), transparent);
    color: #d4d4d4;
    min-height: 100vh;
    padding: 20px;
}

.dashboard-container { max-width: 1600px; margin: 0 auto; }

/* ===== MILITARY HEADER ===== */
.header {
    text-align: center;
    margin-bottom: 30px;
    padding: 30px 20px;
    background: linear-gradient(135deg, rgba(40, 30, 20, 0.9), rgba(30, 25, 20, 0.9));
    border: 3px solid #8b5a00;
    border-radius: 10px;
    box-shadow: 0 0 40px rgba(200, 100, 0, 0.3), inset 0 0 20px rgba(0, 0, 0, 0.5);
    position: relative;
}

/* Scanline Effect */
.header::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0, 0, 0, 0.1) 2px,
        rgba(0, 0, 0, 0.1) 4px
    );
    pointer-events: none;
}

/* Alliance Logo - Burning Effect */
.alliance-logo {
    font-family: 'Oswald', sans-serif;
    font-size: 4rem;
    font-weight: 700;
    color: #ff6600;
    text-shadow: 
        0 0 10px #ff6600,
        0 0 20px #cc3300,
        2px 2px 4px #000,
        -2px -2px 4px #000;
    padding: 20px;
    border: 3px solid #8b5a00;
    background: linear-gradient(135deg, rgba(60, 40, 20, 0.8), rgba(40, 30, 15, 0.8));
    border-radius: 10px;
    display: inline-block;
    animation: flickerGlow 3s infinite;
    letter-spacing: 8px;
}

@keyframes flickerGlow {
    0%, 100% { 
        box-shadow: 0 0 20px rgba(255, 102, 0, 0.5), 
                   inset 0 0 10px rgba(255, 102, 0, 0.2);
    }
    50% { 
        box-shadow: 0 0 30px rgba(255, 102, 0, 0.8), 
                   inset 0 0 15px rgba(255, 102, 0, 0.3);
    }
}

.header h1 {
    font-family: 'Oswald', sans-serif;
    font-size: 2.5rem;
    font-weight: 700;
    color: #ffaa00;
    text-shadow: 2px 2px 4px #000, 0 0 10px #ff6600;
    margin: 15px 0 5px 0;
    letter-spacing: 3px;
}

.alliance-name {
    font-family: 'Teko', sans-serif;
    font-size: 1.6rem;
    color: #ff9933;
    margin: 8px 0;
    letter-spacing: 4px;
    text-transform: uppercase;
    text-shadow: 1px 1px 2px #000;
}

.event-subtitle {
    font-size: 1.1rem;
    color: #cc6633;
    margin: 5px 0;
    letter-spacing: 2px;
    font-weight: 600;
    text-shadow: 1px 1px 2px #000;
}

/* ===== MILITARY CONTROLS ===== */
.week-controls {
    display: flex;
    justify-content: space-between;
    gap: 15px;
    margin-bottom: 25px;
    padding: 20px;
    background: linear-gradient(135deg, rgba(40, 35, 25, 0.9), rgba(30, 25, 20, 0.9));
    border: 2px solid #6b5a3d;
    border-radius: 8px;
    flex-wrap: wrap;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
}

.week-selector { display: flex; gap: 10px; flex-wrap: wrap; }

.week-btn, .action-btn {
    padding: 12px 20px;
    background: linear-gradient(135deg, #3a3020, #2a2515);
    border: 2px solid #6b5a3d;
    border-radius: 6px;
    color: #d4a765;
    font-family: 'Teko', sans-serif;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}

.week-btn:hover, .action-btn:hover {
    border-color: #ff9933;
    color: #ffcc66;
    box-shadow: 0 0 15px rgba(255, 153, 51, 0.4);
    transform: translateY(-2px);
    background: linear-gradient(135deg, #4a4030, #3a3025);
}

.week-btn.active {
    background: linear-gradient(135deg, #ff6600, #cc5200);
    border-color: #ff9933;
    color: #ffffff;
    box-shadow: 0 0 20px rgba(255, 102, 0, 0.6);
    text-shadow: 0 0 5px #000;
}

.upload-btn {
    padding: 12px 25px;
    background: linear-gradient(135deg, #cc5200, #993d00);
    border: 2px solid #ff6600;
    border-radius: 6px;
    color: #ffffff;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(255, 102, 0, 0.3);
    font-family: 'Teko', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 1px;
}

.upload-btn:hover {
    background: linear-gradient(135deg, #ff6600, #cc5200);
    box-shadow: 0 6px 20px rgba(255, 102, 0, 0.5);
    transform: translateY(-2px);
}

.control-buttons { display: flex; gap: 10px; flex-wrap: wrap; }

/* ===== RESOURCE CARDS (KPIs) ===== */
.kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.kpi-card {
    background: linear-gradient(135deg, rgba(50, 40, 25, 0.9), rgba(35, 28, 18, 0.9));
    border: 2px solid #6b5a3d;
    border-left: 4px solid #ff6600;
    border-radius: 8px;
    padding: 25px;
    text-align: center;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

.kpi-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(255, 102, 0, 0.3);
    border-color: #ff9933;
}

.kpi-label {
    font-size: 0.9rem;
    color: #997755;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 10px;
    font-weight: 600;
}

.kpi-value {
    font-family: 'Oswald', sans-serif;
    font-size: 2.2rem;
    font-weight: 700;
    color: #ffaa33;
    text-shadow: 0 0 10px rgba(255, 170, 51, 0.5), 2px 2px 4px #000;
}

.kpi-subtext {
    font-size: 0.85rem;
    color: #7a6a50;
    margin-top: 5px;
}

/* ===== COMBAT STATS ===== */
.movement-section { margin: 30px 0; }

.section-title {
    font-family: 'Oswald', sans-serif;
    font-size: 1.8rem;
    text-align: center;
    color: #ffaa33;
    text-shadow: 2px 2px 4px #000, 0 0 10px #ff6600;
    margin-bottom: 25px;
    text-transform: uppercase;
    letter-spacing: 3px;
}

.movement-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.movement-card {
    background: linear-gradient(135deg, rgba(40, 35, 25, 0.9), rgba(30, 25, 20, 0.9));
    border: 2px solid #6b5a3d;
    border-radius: 8px;
    padding: 25px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

.movement-icon { font-size: 3rem; margin-bottom: 10px; filter: drop-shadow(2px 2px 4px #000); }
.movement-title { font-size: 0.9rem; color: #997755; text-transform: uppercase; margin-bottom: 10px; font-weight: 600; }
.movement-player { font-family: 'Oswald', sans-serif; font-size: 1.3rem; color: #ffaa33; margin-bottom: 5px; text-shadow: 1px 1px 2px #000; }
.movement-stats { font-size: 0.9rem; color: #7a6a50; }

/* ===== CHARTS ===== */
.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
}

.chart-card {
    background: linear-gradient(135deg, rgba(40, 35, 25, 0.9), rgba(30, 25, 20, 0.9));
    border: 2px solid #6b5a3d;
    border-radius: 8px;
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
}

.chart-title {
    font-family: 'Oswald', sans-serif;
    font-size: 1.2rem;
    color: #ffaa33;
    margin-bottom: 20px;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 1px 1px 2px #000;
}

/* ===== DIVISION SYSTEM ===== */
.division-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.division-card {
    background: linear-gradient(135deg, rgba(40, 35, 25, 0.9), rgba(30, 25, 20, 0.9));
    border: 2px solid #6b5a3d;
    border-radius: 8px;
    padding: 25px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

.division-card.elite { 
    border-color: #d4af37; 
    border-width: 3px;
    box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
}
.division-card.master { 
    border-color: #99cc33;
    box-shadow: 0 0 15px rgba(153, 204, 51, 0.2);
}
.division-card.warrior { 
    border-color: #cc6633;
    box-shadow: 0 0 15px rgba(204, 102, 51, 0.2);
}

.division-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.division-icon { font-size: 2rem; filter: drop-shadow(2px 2px 3px #000); }
.division-name { font-family: 'Oswald', sans-serif; font-size: 1.2rem; color: #ffcc66; flex: 1; margin: 0 10px; letter-spacing: 1px; }
.division-req { font-size: 0.85rem; color: #997755; }
.division-count { font-size: 1.1rem; color: #ffaa33; margin-bottom: 10px; font-weight: 600; }
.division-players { font-size: 0.9rem; color: #9a8970; line-height: 1.6; }

/* ===== LEADERBOARD TABLE ===== */
.table-container {
    background: linear-gradient(135deg, rgba(40, 35, 25, 0.9), rgba(30, 25, 20, 0.9));
    border: 2px solid #6b5a3d;
    border-radius: 8px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
}

.search-bar {
    width: 100%;
    padding: 15px 20px;
    margin-bottom: 20px;
    background: rgba(20, 18, 15, 0.8);
    border: 2px solid #6b5a3d;
    border-radius: 6px;
    color: #d4d4d4;
    font-size: 1rem;
    font-family: 'Rajdhani', sans-serif;
}

.search-bar:focus {
    outline: none;
    border-color: #ff9933;
    box-shadow: 0 0 15px rgba(255, 153, 51, 0.3);
}

.table-wrapper {
    max-height: 600px;
    overflow-y: auto;
    border-radius: 8px;
}

.table-wrapper::-webkit-scrollbar { width: 12px; }
.table-wrapper::-webkit-scrollbar-track { background: rgba(20, 18, 15, 0.8); border-radius: 8px; }
.table-wrapper::-webkit-scrollbar-thumb { 
    background: linear-gradient(135deg, #ff6600, #cc5200); 
    border-radius: 8px;
    border: 2px solid rgba(20, 18, 15, 0.8);
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}

.data-table thead {
    position: sticky;
    top: 0;
    z-index: 10;
    background: linear-gradient(135deg, #ff6600, #cc5200);
}

.data-table th {
    padding: 15px;
    text-align: left;
    font-weight: 700;
    text-transform: uppercase;
    font-size: 0.9rem;
    color: #ffffff;
    text-shadow: 1px 1px 2px #000;
    font-family: 'Teko', sans-serif;
    letter-spacing: 1px;
}

.data-table tbody tr {
    border-bottom: 1px solid rgba(107, 90, 61, 0.3);
    transition: all 0.3s ease;
}

.data-table tbody tr:hover {
    background: rgba(255, 102, 0, 0.1);
}

.data-table td {
    padding: 12px 15px;
    color: #c4b5a0;
}

/* ===== RANK BADGES - MILITARY STYLE ===== */
.rank-badge {
    display: inline-block;
    padding: 5px 12px;
    border-radius: 4px;
    font-weight: 700;
    font-size: 0.85rem;
    font-family: 'Oswald', sans-serif;
    letter-spacing: 1px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
}

.rank-1 { 
    background: linear-gradient(135deg, #d4af37, #f4d03f); 
    color: #000;
    box-shadow: 0 0 15px rgba(212, 175, 55, 0.6);
    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
}
.rank-2 { 
    background: linear-gradient(135deg, #c0c0c0, #e8e8e8); 
    color: #000;
    box-shadow: 0 0 12px rgba(192, 192, 192, 0.5);
}
.rank-3 { 
    background: linear-gradient(135deg, #cd7f32, #e6a157); 
    color: #000;
    box-shadow: 0 0 12px rgba(205, 127, 50, 0.5);
}
.rank-top10 { background: rgba(255, 153, 51, 0.3); color: #ffaa33; border: 1px solid #ff9933; }
.rank-default { background: rgba(80, 70, 60, 0.3); color: #9a8970; border: 1px solid #6b5a3d; }

.rank-movement {
    display: inline-flex;
    align-items: center;
    font-weight: 700;
    font-size: 1.1rem;
}

.rank-movement.up { color: #99cc33; text-shadow: 0 0 5px #99cc33; }
.rank-movement.down { color: #cc3300; text-shadow: 0 0 5px #cc3300; }
.rank-movement.same { color: #7a6a50; }

.achievement-badge {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
    margin: 2px;
    background: rgba(255, 153, 51, 0.2);
    border: 1px solid rgba(255, 153, 51, 0.5);
}

.view-profile-btn {
    padding: 6px 12px;
    background: rgba(204, 82, 0, 0.4);
    border: 1px solid #cc5200;
    border-radius: 4px;
    color: #ffaa33;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: 'Teko', sans-serif;
}

.view-profile-btn:hover {
    background: rgba(255, 102, 0, 0.6);
    color: #ffffff;
    box-shadow: 0 0 10px rgba(255, 102, 0, 0.4);
}

/* ===== FOOTER ===== */
.footer {
    text-align: center;
    margin-top: 40px;
    padding: 30px 20px;
    background: linear-gradient(135deg, rgba(40, 35, 25, 0.9), rgba(30, 25, 20, 0.9));
    border: 2px solid #6b5a3d;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
}

.creator-tag {
    font-family: 'Oswald', sans-serif;
    font-weight: 700;
    color: #ff9933;
    font-size: 1.3rem;
    letter-spacing: 2px;
    text-shadow: 0 0 10px rgba(255, 153, 51, 0.5), 2px 2px 4px #000;
}

/* ===== MODAL ===== */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(10px);
}

.modal-content {
    background: linear-gradient(135deg, rgba(40, 35, 25, 0.95), rgba(30, 25, 20, 0.95));
    margin: 5% auto;
    padding: 0;
    border: 3px solid #6b5a3d;
    border-radius: 8px;
    width: 90%;
    max-width: 900px;
    box-shadow: 0 10px 50px rgba(255, 102, 0, 0.3);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    padding: 25px;
    background: linear-gradient(135deg, #ff6600, #cc5200);
    border-radius: 5px 5px 0 0;
}

.modal-header h2 {
    font-family: 'Oswald', sans-serif;
    color: #ffffff;
    margin: 0;
    text-shadow: 2px 2px 4px #000;
}

.modal-close {
    color: #ffffff;
    font-size: 2rem;
    cursor: pointer;
    text-shadow: 2px 2px 4px #000;
}

.modal-body { padding: 25px; }

.profile-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
}

.profile-stat {
    background: rgba(20, 18, 15, 0.8);
    border: 2px solid #6b5a3d;
    border-radius: 6px;
    padding: 15px;
    text-align: center;
}

.stat-label { font-size: 0.85rem; color: #997755; margin-bottom: 8px; }
.stat-value { font-family: 'Oswald', sans-serif; font-size: 1.5rem; color: #ffaa33; font-weight: 700; text-shadow: 0 0 8px rgba(255, 170, 51, 0.4); }

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
    .header h1 { font-size: 1.8rem; }
    .alliance-logo { font-size: 2.5rem; padding: 15px; }
    .charts-grid, .kpi-grid { grid-template-columns: 1fr; }
    .week-controls { flex-direction: column; }
}</style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <div class="alliance-logo">pWR</div>
            <h1>‚öîÔ∏è ALLIANCE DUEL LEADERBOARD ‚öîÔ∏è</h1>
            <p class="alliance-name">[pWR] POWEr Alliance</p>
            <p class="event-subtitle">Weekly Alliance Duel Event</p>
        </div>

        <!-- Week Controls -->
        <div class="week-controls">
            <div class="week-selector" id="weekSelector"></div>
            <div class="control-buttons">
                <label for="csvUpload" class="upload-btn">
                    üì§ Upload Week Data
                    <input type="file" id="csvUpload" accept=".csv" style="display: none;">
                </label>
                <button class="action-btn" id="exportPdfBtn">üìÑ Export PDF</button>
                <button class="action-btn" id="exportCsvBtn">üíæ Export CSV</button>
                <button class="action-btn" id="shareBtn">üì∏ Screenshot</button>
            </div>
        </div>

        <!-- KPIs -->
        <div class="kpi-grid" id="kpiGrid"></div>

        <!-- Movement Highlights -->
        <div class="movement-section" id="movementSection" style="display: none;">
            <h2 class="section-title">üìà Weekly Movement Highlights</h2>
            <div class="movement-grid">
                <div class="movement-card">
                    <div class="movement-icon">üöÄ</div>
                    <div class="movement-title">Biggest Climber</div>
                    <div class="movement-player" id="biggestClimber">-</div>
                    <div class="movement-stats" id="climberStats">-</div>
                </div>
                <div class="movement-card">
                    <div class="movement-icon">üìâ</div>
                    <div class="movement-title">Biggest Drop</div>
                    <div class="movement-player" id="biggestFaller">-</div>
                    <div class="movement-stats" id="fallerStats">-</div>
                </div>
                <div class="movement-card">
                    <div class="movement-icon">üëë</div>
                    <div class="movement-title">Weekly MVP</div>
                    <div class="movement-player" id="weeklyMvp">-</div>
                    <div class="movement-stats" id="mvpStats">-</div>
                </div>
                <div class="movement-card">
                    <div class="movement-icon">üî•</div>
                    <div class="movement-title">Top Streak</div>
                    <div class="movement-player" id="topStreak">-</div>
                    <div class="movement-stats" id="streakStats">-</div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="charts-grid">
            <div class="chart-card">
                <h3 class="chart-title">üèÜ Top 10 Champions</h3>
                <canvas id="barChart"></canvas>
            </div>
            <div class="chart-card">
                <h3 class="chart-title">üìä Score Distribution</h3>
                <canvas id="pieChart"></canvas>
            </div>
        </div>

        <!-- Performance Charts -->
        <div class="performance-section">
            <h2 class="section-title">üìà Performance Analysis</h2>
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title">üî• Top 20 Performance</h3>
                    <canvas id="topPerformanceChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">üìâ Bottom 20 Performance</h3>
                    <canvas id="bottomPerformanceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Division System -->
        <div class="performance-section">
            <h2 class="section-title">üèÜ Division Rankings</h2>
            <div class="division-grid">
                <div class="division-card elite">
                    <div class="division-header">
                        <span class="division-icon">üëë</span>
                        <span class="division-name">Elite Division</span>
                        <span class="division-req">&gt;100M</span>
                    </div>
                    <div class="division-count" id="eliteDivisionCount">0 Players</div>
                    <div class="division-players" id="eliteDivisionPlayers"></div>
                </div>
                <div class="division-card master">
                    <div class="division-header">
                        <span class="division-icon">‚öîÔ∏è</span>
                        <span class="division-name">Master Division</span>
                        <span class="division-req">50M-100M</span>
                    </div>
                    <div class="division-count" id="masterDivisionCount">0 Players</div>
                    <div class="division-players" id="masterDivisionPlayers"></div>
                </div>
                <div class="division-card warrior">
                    <div class="division-header">
                        <span class="division-icon">üõ°Ô∏è</span>
                        <span class="division-name">Warrior Division</span>
                        <span class="division-req">&lt;50M</span>
                    </div>
                    <div class="division-count" id="warriorDivisionCount">0 Players</div>
                    <div class="division-players" id="warriorDivisionPlayers"></div>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="table-container">
            <h3 class="chart-title">üìã Complete Leaderboard</h3>
            <input type="text" id="searchBar" class="search-bar" placeholder="üîç Search player name...">
            <div class="table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Movement</th>
                            <th>Player Name</th>
                            <th>Points</th>
                            <th>Achievements</th>
                            <th>Division</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Player Modal -->
        <div id="playerModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalPlayerName">Player Profile</h2>
                    <span class="modal-close" id="closeModal">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="stat-label">Current Rank</div>
                            <div class="stat-value" id="modalRank">-</div>
                        </div>
                        <div class="profile-stat">
                            <div class="stat-label">Total Points</div>
                            <div class="stat-value" id="modalPoints">-</div>
                        </div>
                        <div class="profile-stat">
                            <div class="stat-label">Division</div>
                            <div class="stat-value" id="modalDivision">-</div>
                        </div>
                    </div>
                    <div>
                        <h3 style="color: #8b45ff; margin-bottom: 15px;">Weekly Performance History</h3>
                        <canvas id="playerHistoryChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Created by: <span class="creator-tag">#1918 [pWR] DeFOUR</span></p>
            <p style="font-size: 0.9rem; color: #808080; margin-top: 5px;">Elite Alliance Dashboard System</p>
        </div>
    </div>

    <script>
        // === DATA MANAGEMENT ===
        let weeklyData = {};
        let currentWeek = 1;
        let chartInstances = {};
        let playerHistory = {}; // Track each player across weeks

        // Week 1 CSV Data
        const week1CSV = `Rank,Player Name,Points
1,Ibrahim 506,"254,714,950"
2,Abo Mohammed,"222,079,491"
3,Abdol28,"180,506,633"
4,Abo Adnan,"173,667,879"
5,Ahmad,"134,543,890"
6,SLAYER,"126,951,974"
7,ABDULAZIZALMALKI,"118,571,944"
8,Muath Alqahtani,"111,049,134"
9,DeFOUR,"97,202,531"
10,DrSolo,"91,974,532"
11,KurdeCR7,"86,022,193"
12,Kh20s,"84,333,138"
13,Prince Faas,"83,901,842"
14,Silver,"83,891,034"
15,FNFH,"82,813,666"
16,3toos,"82,270,188"
17,MoD515,"81,708,133"
18,araalaa,"81,696,038"
19,Odin,"81,374,060"
20,Puno Kawan212,"76,801,589"
21,BadLayy,"76,642,782"
22,REEKI,"75,053,779"
23,AbuZahrah,"74,035,082"
24,Stiner,"73,552,818"
25,Abu Ghaith,"72,558,455"
26,heavenly way,"68,779,646"
27,Duaa,"67,121,386"
28,Librta,"66,270,258"
29,Raed 966,"64,873,382"
30,777Chris,"63,581,728"
31,Abusalwati,"63,329,661"
32,Call Me Sarass,"60,184,658"
33,BoYousef16,"59,801,715"
34,LiemKo,"59,489,836"
35,ÿßÿ®Ÿà ŸÜŸàÿßŸÅ,"57,938,576"
36,Liu Porsche,"57,633,240"
37,ciki33,"57,176,638"
38,aboyaamen,"56,817,080"
39,JokerR5,"56,485,471"
40,jumanto,"56,066,666"
41,Rawan,"55,489,643"
42,batttosai,"55,475,449"
43,Emonbdwy,"55,080,311"
44,AbuHaitham94,"55,063,094"
45,FAHad,"53,197,906"
46,BlackWolf05,"52,839,177"
47,MoroccanPatriots,"52,103,149"
48,PERNAMA,"52,000,712"
49,SKYLINE,"51,834,583"
50,Abu Jassim,"50,513,844"
51,letnanmm,"50,504,397"
52,AzD69,"50,470,907"
53,DOOMSKY,"50,463,540"
54,The Dreamer,"49,876,426"
55,TheRagy,"49,161,384"
56,FalconOfPrey Yahya,"48,798,782"
57,louiieee,"48,699,193"
58,AfroZack,"48,589,570"
59,MaulanaMalik,"48,575,383"
60,DewolARZ,"48,117,286"
61,Abu Yazan12,"47,702,991"
62,LaoBan,"47,329,765"
63,BU SULTAN,"47,310,813"
64,Komandan29f11,"46,947,538"
65,Zincoo,"46,253,199"
66,Stellaquantum,"46,195,001"
67,Sahroni Anti Hero,"45,099,933"
68,AlaaNa22,"43,132,672"
69,PeCeLeLe,"42,323,581"
70,19Maho94,"41,083,116"
71,NatanRGL,"38,333,989"
72,A506d,"37,675,665"
73,commandos np,"36,380,736"
74,NEVER TOP UP,"36,060,184"
75,Moha1994a,"35,946,151"
76,Ns911,"35,796,681"
77,dloah,"35,450,464"
78,Hussein12,"35,158,478"
79,Niro1973,"34,697,302"
80,Prestige,"31,073,684"
81,Abu Jassim jr,"31,051,153"
82,Burkan5,"30,501,191"
83,Safiraalyysa,"30,160,926"
84,Khaledkhaba,"28,709,046"
85,KhaledQ8,"28,404,426"
86,ViniJR,"28,320,266"
87,Fighter,"27,639,212"
88,Tito EmamAdel,"27,534,558"
89,ANGDO,"25,060,798"
90,CaptainOMN,"24,245,736"
91,LOOKAS07,"21,958,420"
92,TAZ,"18,412,925"
93,AlModamer77,"17,095,087"
94,AlQatras,"16,570,020"
95,Majedz31,"13,836,563"
96,feasta,"7,215,356"
97,DanPlex768,"2,944,502"
98,Abood19973,"2,500,065"`;

        // === UTILITY FUNCTIONS ===
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            if (lines.length === 0) return [];
            
            // Get headers from first line
            const headerLine = lines[0];
            const headers = parseCSVLine(headerLine);
            
            // Parse data rows
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue; // Skip empty lines
                
                const values = parseCSVLine(lines[i]);
                const obj = {};
                
                headers.forEach((header, index) => {
                    let value = values[index] || '';
                    
                    // Handle Points column - remove commas and convert to number
                    if (header === 'Points') {
                        obj[header] = parseInt(value.replace(/,/g, '')) || 0;
                    } 
                    // Handle Rank column - convert to number
                    else if (header === 'Rank') {
                        obj[header] = parseInt(value) || 0;
                    } 
                    // All other columns - keep as string
                    else {
                        obj[header] = value;
                    }
                });
                
                // Only add if we have valid data
                if (obj['Player Name'] && obj.Rank && obj.Points) {
                    data.push(obj);
                }
            }
            
            return data;
        }

        // Helper function to parse a single CSV line
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        // Handle escaped quotes
                        current += '"';
                        i++; // Skip next quote
                    } else {
                        // Toggle quote state
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    // Found field separator
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            // Add last field
            result.push(current);
            
            return result;
        }

        function getCurrentPlayers() {
            return weeklyData[currentWeek] || [];
        }

        function destroyChart(chartId) {
            if (chartInstances[chartId]) {
                chartInstances[chartId].destroy();
                delete chartInstances[chartId];
            }
        }

        function getDivision(points) {
            if (points > 100000000) return 'Elite';
            if (points >= 50000000) return 'Master';
            return 'Warrior';
        }

        function getAchievements(player, week) {
            const achievements = [];
            const rank = player.Rank;
            const points = player.Points;
            
            if (rank === 1) achievements.push('üëë Champion');
            if (rank <= 3) achievements.push('ü•á Top 3');
            if (rank <= 10) achievements.push('‚≠ê Top 10');
            if (points > 100000000) achievements.push('üíé 100M Club');
            if (points > 200000000) achievements.push('üèÜ 200M Club');
            
            return achievements;
        }

        function calculateMovement(playerName) {
            const weeks = Object.keys(weeklyData).sort((a, b) => a - b);
            if (weeks.length < 2 || currentWeek == 1) return { change: 0, type: 'same' };
            
            const currentIndex = weeks.indexOf(currentWeek.toString());
            if (currentIndex === 0) return { change: 0, type: 'same' };
            
            const prevWeek = weeks[currentIndex - 1];
            const currentData = weeklyData[currentWeek].find(p => p['Player Name'] === playerName);
            const prevData = weeklyData[prevWeek].find(p => p['Player Name'] === playerName);
            
            if (!currentData || !prevData) return { change: 0, type: 'same' };
            
            const change = prevData.Rank - currentData.Rank;
            const type = change > 0 ? 'up' : change < 0 ? 'down' : 'same';
            
            return { change: Math.abs(change), type };
        }

        // === RENDERING FUNCTIONS ===
        function renderKPIs() {
            const players = getCurrentPlayers();
            if (!players.length) return;
            
            const totalPlayers = players.length;
            const totalPoints = players.reduce((sum, p) => sum + p.Points, 0);
            const avgScore = Math.round(totalPoints / totalPlayers);
            const highestScore = Math.max(...players.map(p => p.Points));
            const lowestScore = Math.min(...players.map(p => p.Points));
            const champion = players.find(p => p.Points === highestScore);
            
            document.getElementById('kpiGrid').innerHTML = `
                <div class="kpi-card">
                    <div class="kpi-label">Total Players</div>
                    <div class="kpi-value">${totalPlayers}</div>
                    <div class="kpi-subtext">Active Warriors</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Average Score</div>
                    <div class="kpi-value">${avgScore.toLocaleString()}</div>
                    <div class="kpi-subtext">Points per Player</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Champion</div>
                    <div class="kpi-value">${highestScore.toLocaleString()}</div>
                    <div class="kpi-subtext">${champion['Player Name']}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Lowest Score</div>
                    <div class="kpi-value">${lowestScore.toLocaleString()}</div>
                    <div class="kpi-subtext">Entry Level</div>
                </div>
            `;
        }

        function renderMovementHighlights() {
            const weeks = Object.keys(weeklyData).sort((a, b) => a - b);
            if (weeks.length < 2 || currentWeek == 1) {
                document.getElementById('movementSection').style.display = 'none';
                return;
            }
            
            document.getElementById('movementSection').style.display = 'block';
            
            const currentIndex = weeks.indexOf(currentWeek.toString());
            const prevWeek = weeks[currentIndex - 1];
            const currentData = weeklyData[currentWeek];
            const prevData = weeklyData[prevWeek];
            
            // Calculate movements
            const movements = currentData.map(p => {
                const prev = prevData.find(pp => pp['Player Name'] === p['Player Name']);
                if (!prev) return null;
                return {
                    name: p['Player Name'],
                    rankChange: prev.Rank - p.Rank,
                    pointsGain: p.Points - prev.Points
                };
            }).filter(m => m !== null);
            
            const biggestClimber = movements.reduce((max, m) => m.rankChange > max.rankChange ? m : max, movements[0]);
            const biggestFaller = movements.reduce((min, m) => m.rankChange < min.rankChange ? m : min, movements[0]);
            const mvp = movements.reduce((max, m) => m.pointsGain > max.pointsGain ? m : max, movements[0]);
            
            document.getElementById('biggestClimber').textContent = biggestClimber?.name || '-';
            document.getElementById('climberStats').textContent = `‚Üë ${biggestClimber?.rankChange || 0} positions`;
            
            document.getElementById('biggestFaller').textContent = biggestFaller?.name || '-';
            document.getElementById('fallerStats').textContent = `‚Üì ${Math.abs(biggestFaller?.rankChange || 0)} positions`;
            
            document.getElementById('weeklyMvp').textContent = mvp?.name || '-';
            document.getElementById('mvpStats').textContent = `+${(mvp?.pointsGain || 0).toLocaleString()} points`;
            
            // Top streak (simplified - player in top 10 for longest)
            document.getElementById('topStreak').textContent = currentData[0]['Player Name'];
            document.getElementById('streakStats').textContent = `${weeks.length} weeks tracked`;
        }

        function renderCharts() {
            const players = getCurrentPlayers();
            if (!players.length) return;
            
            // Top 10 Bar Chart
            const top10 = players.slice(0, 10);
            const barCtx = document.getElementById('barChart').getContext('2d');
            destroyChart('barChart');
            chartInstances['barChart'] = new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: top10.map(p => p['Player Name']),
                    datasets: [{
                        label: 'Points',
                        data: top10.map(p => p.Points),
                        backgroundColor: 'rgba(139, 69, 255, 0.8)',
                        borderColor: 'rgba(139, 69, 255, 1)',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(139, 69, 255, 0.1)' },
                            ticks: {
                                color: '#b0b0b0',
                                callback: v => (v / 1000000).toFixed(0) + 'M'
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#b0b0b0', maxRotation: 45 }
                        }
                    }
                }
            });
            
            // Pie Chart
            const tiers = {
                'Elite (>100M)': players.filter(p => p.Points > 100000000).length,
                'Master (50M-100M)': players.filter(p => p.Points >= 50000000 && p.Points <= 100000000).length,
                'Warrior (<50M)': players.filter(p => p.Points < 50000000).length
            };
            const pieCtx = document.getElementById('pieChart').getContext('2d');
            destroyChart('pieChart');
            chartInstances['pieChart'] = new Chart(pieCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(tiers),
                    datasets: [{
                        data: Object.values(tiers),
                        backgroundColor: ['rgba(255, 215, 0, 0.8)', 'rgba(139, 69, 255, 0.8)', 'rgba(255, 0, 128, 0.8)'],
                        borderColor: ['rgba(255, 215, 0, 1)', 'rgba(139, 69, 255, 1)', 'rgba(255, 0, 128, 1)'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#b0b0b0', font: { size: 14 }, padding: 20 }
                        }
                    }
                }
            });
            
            // Top 20 Performance
            const top20 = players.slice(0, 20);
            const topPerfCtx = document.getElementById('topPerformanceChart').getContext('2d');
            destroyChart('topPerformanceChart');
            chartInstances['topPerformanceChart'] = new Chart(topPerfCtx, {
                type: 'line',
                data: {
                    labels: top20.map(p => p['Player Name']),
                    datasets: [{
                        label: 'Points',
                        data: top20.map(p => p.Points),
                        borderColor: 'rgba(139, 69, 255, 1)',
                        backgroundColor: 'rgba(139, 69, 255, 0.2)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            grid: { color: 'rgba(139, 69, 255, 0.1)' },
                            ticks: {
                                color: '#b0b0b0',
                                callback: v => (v / 1000000).toFixed(0) + 'M'
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#b0b0b0', maxRotation: 45 }
                        }
                    }
                }
            });
            
            // Bottom 20 Performance
            const bottom20 = players.slice(-20).reverse();
            const bottomPerfCtx = document.getElementById('bottomPerformanceChart').getContext('2d');
            destroyChart('bottomPerformanceChart');
            chartInstances['bottomPerformanceChart'] = new Chart(bottomPerfCtx, {
                type: 'line',
                data: {
                    labels: bottom20.map(p => p['Player Name']),
                    datasets: [{
                        label: 'Points',
                        data: bottom20.map(p => p.Points),
                        borderColor: 'rgba(255, 0, 128, 1)',
                        backgroundColor: 'rgba(255, 0, 128, 0.2)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 0, 128, 0.1)' },
                            ticks: {
                                color: '#b0b0b0',
                                callback: v => (v / 1000000).toFixed(0) + 'M'
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#b0b0b0', maxRotation: 45 }
                        }
                    }
                }
            });
        }

        function renderDivisions() {
            const players = getCurrentPlayers();
            const elite = players.filter(p => p.Points > 100000000);
            const master = players.filter(p => p.Points >= 50000000 && p.Points <= 100000000);
            const warrior = players.filter(p => p.Points < 50000000);
            
            document.getElementById('eliteDivisionCount').textContent = `${elite.length} Players`;
            document.getElementById('eliteDivisionPlayers').innerHTML = elite.slice(0, 5).map(p => p['Player Name']).join(', ') + (elite.length > 5 ? '...' : '');
            
            document.getElementById('masterDivisionCount').textContent = `${master.length} Players`;
            document.getElementById('masterDivisionPlayers').innerHTML = master.slice(0, 5).map(p => p['Player Name']).join(', ') + (master.length > 5 ? '...' : '');
            
            document.getElementById('warriorDivisionCount').textContent = `${warrior.length} Players`;
            document.getElementById('warriorDivisionPlayers').innerHTML = warrior.slice(0, 5).map(p => p['Player Name']).join(', ') + (warrior.length > 5 ? '...' : '');
        }

        function renderTable(data = null) {
            const players = data || getCurrentPlayers();
            const tbody = document.getElementById('tableBody');
            
            tbody.innerHTML = players.map(player => {
                let rankClass = 'rank-default';
                if (player.Rank === 1) rankClass = 'rank-1';
                else if (player.Rank === 2) rankClass = 'rank-2';
                else if (player.Rank === 3) rankClass = 'rank-3';
                else if (player.Rank <= 10) rankClass = 'rank-top10';
                
                const movement = calculateMovement(player['Player Name']);
                const movementIcon = movement.type === 'up' ? '‚Üë' : movement.type === 'down' ? '‚Üì' : '‚îÄ';
                const movementText = movement.change > 0 ? `${movementIcon} ${movement.change}` : movementIcon;
                
                const achievements = getAchievements(player, currentWeek);
                const division = getDivision(player.Points);
                
                return `
                    <tr>
                        <td><span class="rank-badge ${rankClass}">#${player.Rank}</span></td>
                        <td><span class="rank-movement ${movement.type}">${movementText}</span></td>
                        <td>${player['Player Name']}</td>
                        <td>${player.Points.toLocaleString()}</td>
                        <td>${achievements.map(a => `<span class="achievement-badge">${a}</span>`).join('')}</td>
                        <td>${division}</td>
                        <td><button class="view-profile-btn" onclick="openPlayerProfile('${player['Player Name']}')">View</button></td>
                    </tr>
                `;
            }).join('');
        }

        function updateWeekButtons() {
            const weeks = Object.keys(weeklyData).sort((a, b) => a - b);
            const weekSelector = document.getElementById('weekSelector');
            
            weekSelector.innerHTML = weeks.map(week => 
                `<button class="week-btn ${week == currentWeek ? 'active' : ''}" onclick="selectWeek(${week})">Week ${week}</button>`
            ).join('');
        }

        function updateDashboard() {
            renderKPIs();
            renderMovementHighlights();
            renderCharts();
            renderDivisions();
            renderTable();
            document.getElementById('searchBar').value = '';
        }

        // === USER INTERACTIONS ===
        function selectWeek(week) {
            currentWeek = week;
            updateWeekButtons();
            updateDashboard();
        }

        function openPlayerProfile(playerName) {
            const weeks = Object.keys(weeklyData).sort((a, b) => a - b);
            const playerData = getCurrentPlayers().find(p => p['Player Name'] === playerName);
            
            if (!playerData) return;
            
            document.getElementById('modalPlayerName').textContent = playerName;
            document.getElementById('modalRank').textContent = `#${playerData.Rank}`;
            document.getElementById('modalPoints').textContent = playerData.Points.toLocaleString();
            document.getElementById('modalDivision').textContent = getDivision(playerData.Points);
            
            // Player history chart
            const historyData = weeks.map(week => {
                const data = weeklyData[week].find(p => p['Player Name'] === playerName);
                return data ? data.Points : 0;
            });
            
            const histCtx = document.getElementById('playerHistoryChart').getContext('2d');
            if (chartInstances['playerHistoryChart']) {
                chartInstances['playerHistoryChart'].destroy();
            }
            chartInstances['playerHistoryChart'] = new Chart(histCtx, {
                type: 'line',
                data: {
                    labels: weeks.map(w => `Week ${w}`),
                    datasets: [{
                        label: 'Points',
                        data: historyData,
                        borderColor: 'rgba(139, 69, 255, 1)',
                        backgroundColor: 'rgba(139, 69, 255, 0.2)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            grid: { color: 'rgba(139, 69, 255, 0.1)' },
                            ticks: { color: '#b0b0b0' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#b0b0b0' }
                        }
                    }
                }
            });
            
            document.getElementById('playerModal').style.display = 'block';
        }

        // CSV Upload
        document.getElementById('csvUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const csvContent = event.target.result;
                        const newPlayers = parseCSV(csvContent);
                        
                        if (newPlayers.length > 0) {
                            const nextWeek = Math.max(...Object.keys(weeklyData).map(Number)) + 1;
                            weeklyData[nextWeek] = newPlayers;
                            currentWeek = nextWeek;
                            
                            updateWeekButtons();
                            updateDashboard();
                            
                            alert(`‚úÖ Week ${nextWeek} data uploaded successfully! (${newPlayers.length} players)`);
                        }
                    } catch (error) {
                        alert('‚ùå Error parsing CSV: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
            e.target.value = '';
        });

        // Export Functions
        document.getElementById('exportPdfBtn').addEventListener('click', () => {
            alert('üìÑ PDF export feature - Would use jsPDF library to generate PDF report of current week data');
        });

        document.getElementById('exportCsvBtn').addEventListener('click', () => {
            const players = getCurrentPlayers();
            const csv = 'Rank,Player Name,Points\n' + players.map(p => 
                `${p.Rank},"${p['Player Name']}","${p.Points.toLocaleString()}"`
            ).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pwr_alliance_week${currentWeek}.csv`;
            a.click();
        });

        document.getElementById('shareBtn').addEventListener('click', () => {
            html2canvas(document.querySelector('.dashboard-container')).then(canvas => {
                const link = document.createElement('a');
                link.download = `pwr_alliance_week${currentWeek}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        });

        // Search
        document.getElementById('searchBar').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const players = getCurrentPlayers();
            const filtered = players.filter(p => 
                p['Player Name'].toLowerCase().includes(searchTerm)
            );
            renderTable(filtered);
        });

        // Modal Close
        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('playerModal').style.display = 'none';
        });

        window.addEventListener('click', (e) => {
            if (e.target.id === 'playerModal') {
                document.getElementById('playerModal').style.display = 'none';
            }
        });

        // === INITIALIZATION ===
        weeklyData[1] = parseCSV(week1CSV);
        updateWeekButtons();
        updateDashboard();
    </script>
</body>
</html>
